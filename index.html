<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Submarine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="record tech &amp; life">
<meta property="og:type" content="website">
<meta property="og:title" content="Submarine">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Submarine">
<meta property="og:description" content="record tech &amp; life">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Submarine">
<meta name="twitter:description" content="record tech &amp; life">
  
    <link rel="alternate" href="/atom.xml" title="Submarine" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Submarine</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">chinese submarine</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/15/hello-world/" class="article-date">
  <time datetime="2019-02-15T07:46:10.000Z" itemprop="datePublished">2019-02-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/15/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/15/hello-world/" data-id="cjs7p2wvd0005ng5mmdewr32t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-tutoial-of-hexo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/15/tutoial-of-hexo/" class="article-date">
  <time datetime="2019-02-15T06:41:24.000Z" itemprop="datePublished">2019-02-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/15/tutoial-of-hexo/">利用Hexo+Github搭建个人免费博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本篇blog将记录个人静态博客的搭建方法：</p>
<ul>
<li>Github静态博客是什么，为什么选择Hexo？</li>
<li>Hexo搭建过程</li>
<li>Hexo使用方法</li>
</ul>
<h1 id="GitHub静态博客是什么，为什么选择Hexo？"><a href="#GitHub静态博客是什么，为什么选择Hexo？" class="headerlink" title="GitHub静态博客是什么，为什么选择Hexo？"></a>GitHub静态博客是什么，为什么选择Hexo？</h1><p>GitHub作为全球最大的程序员交友网站，是一个代码托管平台和开发者社区，开发者可以在Github上创建自己的开源项目并与其他开发者协作编码，同时它也提供了很多服务，其中Pages就是其中一个服务，它提供了免费的托管空间可以用来存放静态博客站点的数据，使用GitHub Pages技术搭建静态博客站点的好处有：</p>
<ul>
<li>多达1G的免费空间。</li>
<li>每月100GB的流量。</li>
<li>利用GitHub的数据存储备份功能，保证数据的安全。</li>
</ul>
<p>具体的介绍可以参考<a href="https://help.github.com/articles/what-is-github-pages/" target="_blank" rel="noopener">GitHub Pages</a>.</p>
<p>在<a href="https://help.github.com/articles/what-is-github-pages/" target="_blank" rel="noopener">Hexo</a>之前GitHub内置支持的静态网页生成引擎是Jekyll，参考<a href="https://www.jianshu.com/p/b0cae7168352" target="_blank" rel="noopener">三脚猫</a>相比较Jekyll而言，Hexo更容易入手，也更方便配置，顾本人更倾向于使用Hexo。另外Hexo也支持多线备份，可以同步到多个git仓库中，实现境内境外双线解析镜像，不过该功能还未体验。</p>
<h1 id="Hexo搭建过程"><a href="#Hexo搭建过程" class="headerlink" title="Hexo搭建过程"></a>Hexo搭建过程</h1><p>本人是mac系统，参考<a href="https://www.jianshu.com/p/e99ed60390a8" target="_blank" rel="noopener">全民博客时代的到来——20分钟简要教程</a>,一步一步下来，将下列工具准备齐全：</p>
<ul>
<li>git</li>
<li>npm</li>
<li>hexo</li>
</ul>
<p>在部署hexo过程中可能会遇到一些错误，根据npm提示或者google一些基本就可以解决了。</p>
<p>关于Hexo源代码的保存问题，可以参考<a href="https://www.jianshu.com/p/3c827e38a852" target="_blank" rel="noopener">保存Hexo博客源码到Github上</a>，创建一个新的分支，将代码存入新的分支中，保留master给GitHub Pages引擎用作渲染用。<br>在实际操作中，该文章中的一些git方法可以根据实际情况进行调整，这里需要掌握一些git的基本语法。</p>
<h1 id="Hexo使用方法"><a href="#Hexo使用方法" class="headerlink" title="Hexo使用方法"></a>Hexo使用方法</h1><p>参考Hexo<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">帮助</a></p>
<h2 id="文档结构"><a href="#文档结构" class="headerlink" title="文档结构"></a>文档结构</h2><p>安装完Hexo后的目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br><span class="line">└── public</span><br></pre></td></tr></table></figure>
<h3 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h3><p>用于记录网站的配置信息</p>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>node包的信息</p>
<h3 id="scaffolds"><a href="#scaffolds" class="headerlink" title="scaffolds"></a>scaffolds</h3><p><strong>模版</strong> 文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p>
<h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><p>存放用户markdown文件的地方，除 _posts 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 public 文件夹，而其他文件会被拷贝过去。</p>
<p>可以建立一个_drafts文件夹，存放草稿文件。</p>
<h3 id="public"><a href="#public" class="headerlink" title="public"></a>public</h3><p>发布的文件，最终这些文件将上传到GitHub Page中进行同步。</p>
<h2 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h2><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/15/tutoial-of-hexo/" data-id="cjs7p2wvh000ang5ms6sq4jla" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-QT项目性能调优小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/30/QT项目性能调优小记/" class="article-date">
  <time datetime="2016-05-30T14:53:00.000Z" itemprop="datePublished">2016-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/30/QT项目性能调优小记/">QT项目性能调优小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近的项目用到了QT 5.5，项目在运行过程中出现了一段时间CPU占用率持续25%，并频繁断网的情况，遂决定对项目性能进行优化。</p>
<p>优化工具也是VS2010自带的性能分析工具，具体的使用方法参见：<a href="http://www.cnblogs.com/smark/archive/2011/10/12/2208039.html" title="http://www.cnblogs.com/smark/archive/2011/10/12/2208039.html" target="_blank" rel="noopener">http://www.cnblogs.com/smark/archive/2011/10/12/2208039.html</a></p>
<p>其中可以选择&ldquo;just my code&rdquo;过滤出自己编写的代码。</p>
<div>通过性能分析工具可以找到占用CPU时间较多的函数，然后按照占有时间多少进行优化-&gt;再分析-&gt;再优化的步骤，多次优化后，将CPU占用率降到了2%以下。下面将对性能优化提升较大的几个优化步骤进行记录：<br><br>### 1.优化字符串格式化方法。<br><br>项目中有将QByteArray中的二进制数如&rdquo;123&rdquo;格式化成&rdquo;31, 32, 33&rdquo;的功能，使用的代码如下：<br><br><div class="cnblogs_code" onclick="cnblogs_code_show('63d02e54-7da6-44c4-91ca-5361cce251e8')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><br><div id="cnblogs_code_open_63d02e54-7da6-44c4-91ca-5361cce251e8" class="cnblogs_code_hide"><br><pre><span style="color: #008080;"> 1</span> QByteArray msg =<span style="color: #000000;"> xxx<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #000000;">QString  str;<br></span><span style="color: #008080;"> 4</span><br><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (quint8 b, msg)<br></span><span style="color: #008080;"> 6</span><br><span style="color: #008080;"> 7</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>     str.append(QString().sprintf(&ldquo;%<span style="color: #000000;">02X&rdquo;, b));<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span> }</pre><br></div><br><span class="cnblogs_code_collapse">View Code</span></div>

<p>&nbsp;</p>
<p>当msg中包含6，7w个字符时，在lz酷睿2代i5的机器上，这段代码需要执行4到5s，因为其中的QString会调用new函数6，7w此，对性能影响极大。优化后的代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('0f450e02-c7a4-4d97-90d4-418b856249ed')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><br><div id="cnblogs_code_open_0f450e02-c7a4-4d97-90d4-418b856249ed" class="cnblogs_code_hide"><br><pre><span style="color: #008080;"> 1</span> QString  buildString(<span style="color: #0000ff;">const</span> QByteArray&amp;<span style="color: #000000;"> ba)<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 4</span><br><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">char</span> ascii[] = {&lsquo;<span style="color: #800080;">0</span>&rsquo;, &lsquo;<span style="color: #800080;">1</span>&rsquo;, &lsquo;<span style="color: #800080;">2</span>&rsquo;,&lsquo;<span style="color: #800080;">3</span>&rsquo;,&lsquo;<span style="color: #800080;">4</span>&rsquo;,&lsquo;<span style="color: #800080;">5</span>&rsquo;,&lsquo;<span style="color: #800080;">6</span>&rsquo;,&lsquo;<span style="color: #800080;">7</span>&rsquo;,&lsquo;<span style="color: #800080;">8</span>&rsquo;,&lsquo;<span style="color: #800080;">9</span><span style="color: #000000;">&rsquo;,&lsquo;A&rsquo;,&lsquo;B&rsquo;,&lsquo;C&rsquo;,&lsquo;D&rsquo;,&lsquo;E&rsquo;,&lsquo;F&rsquo;};<br></span><span style="color: #008080;"> 6</span><br><span style="color: #008080;"> 7</span> <span style="color: #000000;">QString buf;<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span> buf.resize(ba.length() * <span style="color: #800080;">3</span><span style="color: #000000;">);<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span> <span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span><span style="color: #000000;">;<br></span><span style="color: #008080;">12</span><br><span style="color: #008080;">13</span> <span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (quint8 b, ba)<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">{<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>     buf[i] = ascii[b &gt;&gt; <span style="color: #800080;">4</span><span style="color: #000000;">];<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span>     buf[i + <span style="color: #800080;">1</span>] =ascii[b &amp; <span style="color: #800080;">0xF</span><span style="color: #000000;">];<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     buf[i + <span style="color: #800080;">2</span>] =<span style="color: #000000;"> &lsquo;, &rsquo;;<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span><br><span style="color: #008080;">25</span>     i += <span style="color: #800080;">3</span><span style="color: #000000;">;<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span> <span style="color: #0000ff;">if</span> (i &gt; <span style="color: #800080;">0</span><span style="color: #000000;">)<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span>     i &ndash;= <span style="color: #800080;">3</span><span style="color: #000000;">;<br></span><span style="color: #008080;">32</span><br><span style="color: #008080;">33</span> buf[i] = &lsquo;\<span style="color: #800080;">0</span><span style="color: #000000;">&rsquo;;<br></span><span style="color: #008080;">34</span><br><span style="color: #008080;">35</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> buf;<br></span><span style="color: #008080;">36</span><br><span style="color: #008080;">37</span> }</pre><br></div><br><span class="cnblogs_code_collapse">View Code</span></div>

<p>&nbsp;</p>
<p>重新运行后，CPU耗时120ms左右，性能提升了几十倍。</p>
<h3 id="2-优化界面刷新"><a href="#2-优化界面刷新" class="headerlink" title="2.优化界面刷新"></a>2.优化界面刷新</h3><p>在界面功能中有一处表格显示的功能，显示接收到的数据，在原始的代码中，当接收到一条数据，填充到表格上时，就调用一次表格scrollTo方法，当1s接收到2，3百条数据时，就会调用2，3此scrollTo方法，直接导致了界面频繁更新。</p>
<p>优化的方法是，考虑到人眼的观察能力，将刷新频率即scrollTo的函数调用固定为1s一次，减少了2，3百此的界面重绘，降低了CUP负载。</p>
<h3 id="3-优化更新时戳功能"><a href="#3-优化更新时戳功能" class="headerlink" title="3.优化更新时戳功能"></a>3.优化更新时戳功能</h3><p>项目中有一处更新时戳的功能，记录某些状态是否已经超时，原始代码中通过QDateTime记录时戳，当数据到来时会调用QDateTime：：currentDateTime更新时戳，当有大量数据到来时会频繁更新时戳，通过性能分析发现此处调用总CPU使用率的7%。考虑该时戳只需要统计时间间隔，遂优化后改用time.h中的clock函数打时戳，该函数返回至程序启动的毫秒数。再次进行性能分析显示此处调用降到CPU使用率的0.23%，性能提升明显。</p>
<h3 id="4-优化数据库操作"><a href="#4-优化数据库操作" class="headerlink" title="4.优化数据库操作"></a>4.优化数据库操作</h3><p>项目中有一处数据库记录update操作，将QByteArray更新到数据库中，程序中使用了QT中的储存过程API，将QByteArray变量绑定到QSqlQuery对象上，参考代码如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('f8890f31-2b9f-473d-9907-c0158c526a6f')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><br><div id="cnblogs_code_open_f8890f31-2b9f-473d-9907-c0158c526a6f" class="cnblogs_code_hide"><br><pre><span style="color: #008080;">1</span> <span style="color: #000000;">QSqlQuery query(db);<br></span><span style="color: #008080;">2</span><br><span style="color: #008080;">3</span> <span style="color: #000000;">QByteArray data;<br></span><span style="color: #008080;">4</span><br><span style="color: #008080;">5</span> query.prepare(&ldquo;update table <span style="color: #0000ff;">set</span> data = ? <span style="color: #0000ff;">where</span> id = ?<span style="color: #000000;">&rdquo;);<br></span><span style="color: #008080;">6</span><br><span style="color: #008080;">7</span> query.bindValue(<span style="color: #800080;">0</span><span style="color: #000000;">, data);<br></span><span style="color: #008080;">8</span><br><span style="color: #008080;">9</span> query.bindValue(<span style="color: #800080;">1</span>, id);</pre><br></div><br><span class="cnblogs_code_collapse">View Code</span></div>

<p>&nbsp;</p>
<p>其中data中包含6，7w个数据，其中发现程序在query.bindValue(data)上耗时最多，打印日志发现该data中的内容必定为可显示的ascii，遂将代码改为</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('3d33a1ac-403c-47db-9500-b62323370e27')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><br><div id="cnblogs_code_open_3d33a1ac-403c-47db-9500-b62323370e27" class="cnblogs_code_hide"><br><pre><span style="color: #008080;">1</span> query.bindValue(<span style="color: #800080;">0</span>, QString(data));</pre><br></div><br><span class="cnblogs_code_collapse">View Code</span></div>

<p>&nbsp;</p>
<p>减少了QByteArray转换成QString的时间。</p>
<h3 id="5-其他"><a href="#5-其他" class="headerlink" title="5.其他"></a>5.其他</h3><p>其他优化还包括数据结构的调整，包括将2，3百条数据的数组改成map结构储存等。</p>
<p>&nbsp;</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>当然对软件的优化还是用遵循相应的原则，比如不要过早优化，在项目的初期以代码的稳定性，可读性，可扩展性为主要目标，只有当代码的性能不能满足需求时再进行适当的优化。因为往往对代码的优化会牺牲以上三个特效，所以在软件开发过程中，经常需要平衡这些特性。</p>
<p> </p></div><p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/30/QT项目性能调优小记/" data-id="cjs7p2wva0002ng5m1wjxwyei" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Windows下HG服务器的搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/28/Windows下HG服务器的搭建/" class="article-date">
  <time datetime="2015-08-28T15:41:00.000Z" itemprop="datePublished">2015-08-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/28/Windows下HG服务器的搭建/">Windows下HG服务器的搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-环境和所需工具安装"><a href="#1-环境和所需工具安装" class="headerlink" title="1.环境和所需工具安装"></a>1.环境和所需工具安装</h3><p>1. 安装python-2.7.9.exe</p>
<p>2. 安装mercurial-3.2.3.win32-py2.7.exe</p>
<p>3. 安装mercurial-3.2.3-x86.msi</p>
<p>4. 安装tortoisehg-3.3.2-x64或者tortoisehg-3.3.2-x86</p>
<p>5. 安装windows iis</p>
<h3 id="2-操作步骤"><a href="#2-操作步骤" class="headerlink" title="2.操作步骤"></a>2.操作步骤</h3><p>1. 搭建网站，新建文件夹D:/hgweb</p>
<p>2. 在 IIS 中新建一个网站，名称是 hgweb，物理路径指向上一步的D:/hgweb</p>
<p>3. 在 IIS 中选择刚才新建的网站，右侧的功能视图中选择 &ldquo;处理程序映射&rdquo;，如下图</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339437033088.gif" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339444377946.gif" alt="clip_image002" title="clip_image002"></a></p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339447811518.gif" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339451562332.gif" alt="clip_image004" title="clip_image004"></a></p>
<p>IIS 7.0以上的写法</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339454065875.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339456877661.jpg" alt="clip_image005" title="clip_image005"></a></p>
<p>IIS 6.0的写法</p>
<p>4. 在D:\hgweb下新建一个文本文件, 重命名为test.cgi (注意连同扩展名一起修改) , 编辑其内容如下:</p>
<p>print ‘Status: 200 OK’</p>
<p>print ‘Content-Type: text/html’</p>
<p>print</p>
<p>print ‘&lt;html&gt;&lt;body&gt;&lt;h1&gt;It Works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;’</p>
<p>保存, 然后在IIS中浏览test.cgi:</p>
<p>url: <a href="http://localhost/hg/test.cgi" target="_blank" rel="noopener">http://localhost/hg/test.cgi</a></p>
<p>界面:</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339462506532.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339465944806.jpg" alt="clip_image006" title="clip_image006"></a></p>
<p>如果能看到上述界面, 说明初期配置成功,继续.</p>
<p>如果提示HTTP 错误 404.2 - Not Found</p>
<p>由于 Web 服务器上的&ldquo;ISAPI 和 CGI 限制&rdquo;列表设置，无法提供您请求的页面</p>
<p>打开IIS管理器, 定位到服务器级别, 在其功能列表中找到ISAPI and CGI restrictions, 如图:</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339469534148.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339472199163.jpg" alt="clip_image007" title="clip_image007"></a></p>
<p>双击打开, 里面必须存在如下图所示的行:</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339476404992.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339479226778.jpg" alt="clip_image008" title="clip_image008"></a></p>
<p>如果不存在则按点击右侧的&rdquo;add&rdquo;, 按下图填写:</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339482033863.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339485153893.jpg" alt="clip_image009" title="clip_image009"></a></p>
<p>如果已存在, 但是被禁用, 将其启用即可.</p>
<p>完成后重试打开test.cgi, 应该可以看到it works字样.</p>
<p>5. 在D:\hgweb目录下新建一个文本文件, 重命名为hgweb.cgi, 编辑其内容为以下几句话:</p>
<table border="1" cellspacing="0" cellpadding="0"><br><tbody><br><tr><br><td valign="top" width="568"><br><br>#!/usr/bin/env python<br><br>#<br><br># An example hgweb CGI script, edit as necessary<br><br># See also <a href="http://mercurial.selenic.com/wiki/PublishingRepositories" target="_blank" rel="noopener">http://mercurial.selenic.com/wiki/PublishingRepositories</a><br><br># Path to repo or hgweb config to serve (see ‘hg help hgweb’)<br><br>config = “D:/hgweb/hgweb.config”<br><br># Uncomment and adjust if Mercurial is not installed system-wide:<br><br>#import sys; sys.path.insert(0, “/path/to/python/lib”)<br><br># Uncomment to send python tracebacks to the browser if an error occurs:<br><br>#import cgitb; cgitb.enable()<br><br>from mercurial import demandimport; demandimport.enable()<br><br>from mercurial.hgweb import hgweb, wsgicgi<br><br>application = hgweb(config)<br><br>wsgicgi.launch(application)<br><br></td><br></tr><br></tbody><br></table>

<p>然后再在D:\Mercurial下新建一个文本文件, 重命名为hgweb.config, 不需要写入任何内容, 即可尝试浏览<a href="http://localhost/hg/hgweb.cgi" target="_blank" rel="noopener">http://localhost:8080 /hgweb.cgi</a> . 应该能看到如下界面:</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339488904707.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339491408250.jpg" alt="clip_image010" title="clip_image010"></a></p>
<p>6. 修改hgweb.config</p>
<table border="1" cellspacing="0" cellpadding="0"><br><tbody><br><tr><br><td valign="top" width="568"><br><br>[paths]<br><br>/Repositories/ = E:/myweb/<em><br><br>[web]<br><br>baseurl = /hgweb.cgi<br><br>allow_push = </em><br><br>push_ssl = false<br><br></td><br></tr><br></tbody><br></table>

<p>7. 创建代码仓库</p>
<p>在D:/hgweb下面创建test文件夹，在文件夹中执行创建hg create</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339493902793.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339496563107.jpg" alt="clip_image012" title="clip_image012"></a></p>
<p>再次访问hgweb.cgi，可以看到如下图的画面：</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339499066650.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339501878436.jpg" alt="clip_image014" title="clip_image014"></a></p>
<p>8. 同步</p>
<p>在要同步的电脑上输入hg clone</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339504846993.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339507507307.jpg" alt="clip_image016" title="clip_image016"></a></p>
<p>9. 提交代码</p>
<p>修改文件后，在设置中将用户名设置为提交用户名</p>
<p><a href="http://images0.cnblogs.com/blog/28698/201508/282339510945580.jpg" target="_blank" rel="noopener"><img src="http://images0.cnblogs.com/blog/28698/201508/282339513752665.jpg" alt="clip_image018" title="clip_image018"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/08/28/Windows下HG服务器的搭建/" data-id="cjs7p2wvh0009ng5muzql97ae" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-svn-tp-link-花生壳搭建外网服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/08/10/svn-tp-link-花生壳搭建外网服务器/" class="article-date">
  <time datetime="2011-08-10T14:59:00.000Z" itemprop="datePublished">2011-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/08/10/svn-tp-link-花生壳搭建外网服务器/">svn+tp-link+花生壳搭建外网服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="nbsp"><a href="#nbsp" class="headerlink" title="&nbsp;"></a>&nbsp;</h3><h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h3><p>1.下载svn客户端和svn服务器</p>
<p>可以去<a href="http://subversion.apache.org/packages.html" target="_blank" rel="noopener">http://subversion.apache.org/packages.html</a> 找到自己平台的客户端和服务器。</p>
<p>因为笔者的平台是windows，所以选择了<a href="http://tortoisesvn.net/" target="_blank" rel="noopener">TortoiseSVN</a>和<a href="http://sourceforge.net/projects/win32svn/" target="_blank" rel="noopener">Win32Svn</a>。</p>
<p>2.安装<a href="http://www.oray.com/peanuthull/" target="_blank" rel="noopener">花生壳</a></p>
<p>去官网下载花生壳软件，并申请护照，就可以得到一个二级域名，这里就不累述了。</p>
<h3 id="2-网络的搭建"><a href="#2-网络的搭建" class="headerlink" title="2.网络的搭建"></a>2.网络的搭建</h3><p>由于笔者的网络是通过路由器联网，所以需要将路由的端口映射到内网的ip。针对tp-link路由，具体的步骤是：</p>
<p>1.进入管理员页面。</p>
<p>2.设置IP与MAC地址绑定。当然这项也可以不设，不过因为内外IP会变，所以可能每次都要设置，很麻烦。</p>
<p>3.设置虚拟服务器。将端口号映射到自己的ip地址。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/201108/201108102254256746.png" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/201108/201108102254263582.png" alt="image" title="image"></a></p>
<p>此处设置端口号为3690 是因为svnserve默认使用的是3690端口。</p>
<p>4.通过花生壳设置DDNS，填入之前申请到的花生壳用户名和地址。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/201108/201108102254301758.png" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/201108/201108102254321069.png" alt="image" title="image"></a></p>
<p>NOTE：如果登录不了，一般有两个解决方法：1.刷新路由的韧体。2.选择另外一个服务提供者。</p>
<p>5.登入花生壳</p>
<p>在本机登录花生壳。如果看到花生壳软件的右下方有一个ip地址和自己路由的ip地址一致的话，那么就表明配置成功了。如果不一样，可能需要等待一会，因为DDNS的设置需要一些时间。</p>
<p>*</p>
<h3 id="3-svn的配置"><a href="#3-svn的配置" class="headerlink" title="3.svn的配置"></a>3.svn的配置</h3><p>1.创建代码库</p>
<p>可以通过两种方式：</p>
<p>(a).安装完<a href="http://tortoisesvn.net/" target="_blank" rel="noopener">TortoiseSVN</a>后，在鼠标右键的快捷方式下，就会有一个create repository here的选项，在一个空文件夹下，执行此条命令就会自动创建一个repository。</p>
<p>(b).在<a href="http://sourceforge.net/projects/win32svn/" target="_blank" rel="noopener">Win32Svn</a>安装目录的bin文件夹下，找到svnadmin可执行档，键入：</p>
<blockquote>
<p>svnadmin create &lt;<em>folder path</em>&gt;</p>
</blockquote>
<p>关于代码库更详细的配置方式，可以参考：<a href="http://blog.163.com/cp7618@yeah/blog/static/70234777201108105751174/" target="_blank" rel="noopener">http://blog.163.com/cp7618@yeah/blog/static/70234777201108105751174/</a></p>
<p>2.导入项目</p>
<p>具体的步骤可以参考《Subversion 1.6 权威指南》。</p>
<h3 id="4-运行svn"><a href="#4-运行svn" class="headerlink" title="4.运行svn"></a>4.运行svn</h3><p>在<a href="http://sourceforge.net/projects/win32svn/" target="_blank" rel="noopener">Win32Svn</a>安装目录的bin文件夹下，找到svnserve，键入：</p>
<blockquote>
<p><span color="#4b4b4b" style="color: #4b4b4b;">svnserve &ndash;d &ndash;r &lt;repository path&gt; </span>–listen-port 3690</p>
</blockquote>
<h3 id="5-远程访问"><a href="#5-远程访问" class="headerlink" title="5.远程访问"></a>5.远程访问</h3><p>在远程的PC上，打开<a href="http://tortoisesvn.net/" target="_blank" rel="noopener">TortoiseSVN</a>，输入svn://&lt;花生壳提供的免费域名&gt;即可访问到共享的项目。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2011/08/10/svn-tp-link-花生壳搭建外网服务器/" data-id="cjs7p2wvm000dng5m87dl7zgt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-udev介绍" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/07/21/udev介绍/" class="article-date">
  <time datetime="2011-07-21T03:38:00.000Z" itemprop="datePublished">2011-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/21/udev介绍/">udev介绍</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>如果你使用Linux比较长时间了，那你就知道，在对待设备文件这块，Linux改变了几次策 略。在Linux早期，设备文件仅仅是是一些带有适当的属性集的普通文件，它由mknod命令创建，文件存放在/dev目录下。后来，采用了devfs, 一个基于内核的动态设备文件系统，他首次出现在2.3.46内核中。Mandrake，Gentoo等Linux分发版本采用了这种方式。devfs创建 的设备文件是动态的。但是devfs有一些严重的限制，从2.6.13版本后移走了。目前取代他的便是文本要提到的udev－－一个用户空间程序。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>目前很多的Linux分发版本采纳了udev的方式，因为它在Linux设备访问，特别是那些对设备有极端需求的站点（比如需要控制上千个硬盘）和热插拔设备（比如USB摄像头和MP3播放器）上解决了几个问题。下面我我们来看看如何管理udev设备。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>实际上，对于那些为磁盘，终端设备等准备的标准配置文件而言，你不需要修改什么。但是，你需要了解udev配置来使用新的或者外来设备，如果不修改配置， 这些设备可能无法访问，或者说Linux可能会采用不恰当的名字，属组或权限来创建这些设备文件。你可能也想知道如何修改RS－232串口，音频设备等文 件的属组或者权限。这点在实际的Linux实施中是会遇到的。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p><strong>为什么使用udev</strong></p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>在此之前的设备文件管理方法（静态文件和devfs）有几个缺点：</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*不确定的设备映射。特别是那些动态设备，比如USB设备，设备文件到实际设备的映射并不可靠和确定。举一个例子：如果你有两个USB打印机。一个可能称 为/dev/usb/lp0,另外一个便是/dev/usb/lp1。但是到底哪个是哪个并不清楚，lp0,lp1和实际的设备没有一一对应的关系，因为 他可能因为发现设备的顺序，打印机本身关闭等原因而导致这种映射并不确定。理想的方式应该是：两个打印机应该采用基于他们的序列号或者其他标识信息的唯一 设备文件来映射。但是静态文件和devfs都无法做到这点。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*没有足够的主/辅设备号。我们知道，每一个设备文件是有两个8位的数字：一个是主设备号 ，另外一个是辅设备号来分配的。这两个8位的数字加上设备类型（块设备或者字符设备）来唯一标识一个设备。不幸的是，关联这些身边的的数字并不足够。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*/dev目录下文件太多。一个系统采用静态设备文件关联的方式，那么这个目录下的文件必然是足够多。而同时你又不知道在你的系统上到底有那些设备文件是激活的。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*命名不够灵活。尽管devfs解决了以前的一些问题，但是它自身又带来了一些问题。其中一个就是命名不够灵活；你别想非常简单的就能修改设备文件的名字。缺省的devfs命令机制本身也很奇怪，他需要修改大量的配置文件和程序。;</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*内核内存使用，devfs特有的另外一个问题是，作为内核驱动模块，devfs需要消耗大量的内存，特别当系统上有大量的设备时（比如上面我们提到的系统一个上有好几千磁盘时）</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>udev的目标是想解决上面提到的这些问题，他通采用用户空间(user-space)工具来管理/dev/目录树，他和文件系统分开。知道如何改变缺省配置能让你之大如何定制自己的系统，比如创建设备字符连接，改变设备文件属组，权限等。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p><strong>udev配置文件</strong></p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>主要的udev配置文件是/etc/udev/udev.conf。这个文件通常很短，他可能只是包含几行#开头的注释，然后有几行选项：</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>udev_root<span>=</span><strong>“</strong>/dev/<strong>“
</strong>udev_rules<span>=</span><strong>“</strong>/etc/udev/rules.d/<strong>“
</strong>udev_log<span>=</span><strong>“</strong>err<strong>“</strong></p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>上面的第二行非常重要，因为他表示udev规则存储的目录，这个目录存储的是以.rules结束的文件。每一个文件处理一系列规则来帮助udev分配名字给设备文件以保证能被内核识别。&nbsp;<br>你的/etc/udev/rules.d下面可能有好几个udev规则文件，这些文件一部分是udev包安装的，另外一部分则是可能是别的硬件或者软件包 生成的。比如在Fedora Core 5系统上，sane-backends包就会安装60-libsane.rules文件，另外initscripts包会安装60-net.rules文 件。这些规则文件的文件名通常是两个数字开头，它表示系统应用该规则的顺序。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>规则文件里的规则有一系列的键/值对组成，键/值对之间用逗号(,)分割。每一个键或者是用户匹配键，或者是一个赋值键。匹配键确定规则是否被应用，而赋 值键表示分配某值给该键。这些值将影响udev创建的设备文件。赋值键可以处理一个多值列表。匹配键和赋值键操作符解释见下表：<br>&lt;pre&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; udev 键/值对操作符<br>操作符&nbsp;&nbsp;&nbsp;&nbsp; 匹配或赋值t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 解释<br>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－<br>&nbsp;&nbsp;&nbsp; ==&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 匹配&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 相等比较<br>&nbsp;&nbsp;&nbsp; !=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 匹配&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 不等比较<br>&nbsp;&nbsp;&nbsp; =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 赋值&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 分配一个特定的值给该键，他可以覆盖之前的赋值。<br>&nbsp;&nbsp;&nbsp; +=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 赋值&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 追加特定的值给已经存在的键<br>&nbsp;&nbsp;&nbsp; :=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 赋值&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 分配一个特定的值给该键，后面的规则不可能覆盖它。&nbsp;<br>&lt;/pre&gt;<br>这有点类似我们常见的编程语言，比如C语言。只是这里的键一次可以处理多个值。有一些键在udev规则文件里经常出现，这些键的值可以使用通配符(<em>,?,甚至范围，比如[0-9])，这些常用键列举如下：<br>&lt;pre&gt;<br>常用udev键<br>键&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 含义<br>ACTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一个时间活动的名字，比如add，当设备增加的时候<br>KERNEL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在内核里看到的设备名字，比如sd</em>表示任意SCSI磁盘设备<br>DEVPATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 内核设备录进，比如/devices/*<br>SUBSYSTEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 子系统名字，比如sound,net<br>BUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 总线的名字，比如IDE,USB<br>DRIVER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设备驱动的名字，比如ide-cdrom<br>ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 独立于内核名字的设备名字<br>SYSFS{ value}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sysfs属性值，他可以表示任意<br>ENV{ key}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 环境变量，可以表示任意<br>PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可执行的外部程序，如果程序返回0值，该键则认为为真(true)<br>RESULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上一个PROGRAM调用返回的标准输出。<br>NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据这个规则创建的设备文件的文件名。注意：仅仅第一行的NAME描述是有效的，后面的均忽略。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果你想使用使用两个以上的名字来访问一个设备的话，可以考虑SYMLINK键。<br>SYMLINK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据规则创建的字符连接名<br>OWNER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设备文件的属组<br>GROUP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设备文件所在的组。<br>MODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设备文件的权限，采用8进制<br>RUN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 为设备而执行的程序列表<br>LABEL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在配置文件里为内部控制而采用的名字标签(下下面的GOTO服务)<br>GOTO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 跳到匹配的规则（通过LABEL来标识），有点类似程序语言中的GOTO<br>IMPORT{ type}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 导入一个文件或者一个程序执行后而生成的规则集到当前文件<br>WAIT_FOR_SYSFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 等待一个特定的设备文件的创建。主要是用作时序和依赖问题。<br>PTIONS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 特定的选项： last_rule 对这类设备终端规则执行； ignore_device 忽略当前规则； ignore_remove 忽略接下来的并移走请求。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; all_partitions 为所有的磁盘分区创建设备文件。<br>&lt;/pre&gt;<br>我们给出一个列子来解释如何使用这些键。下面的例子来自Fedora Core 5系统的标准配置文件。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<div class="msgborder" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; line-height: 28px; padding: 0px;"><br><pre>KERNEL=<strong>=”***</strong>“<strong>,&nbsp;OWNER=</strong>“<strong>root</strong>“<strong>&nbsp;GROUP=</strong>“<strong>root</strong>“<strong>,&nbsp;MODE=</strong>“<strong>0600</strong>“<strong><br>KERNEL=</strong>=”<strong>tty</strong>“<strong>,&nbsp;NAME=</strong>“<strong>%k</strong>“<strong>,&nbsp;GROUP=</strong>“<strong>tty</strong>“<strong>,&nbsp;MODE=</strong>“<strong>0666</strong>“<strong>,&nbsp;OPTIONS=</strong>“<strong>last_rule</strong>“<strong><br>KERNEL=</strong>=”<strong>scd[0-9]*</strong>“<strong>,&nbsp;SYMLINK+=</strong>“<strong>cdrom&nbsp;cdrom-%k</strong>“<strong><br>KERNEL=</strong>=”<strong>hd[a-z]</strong>“<strong>,&nbsp;BUS=</strong>=”<strong>ide</strong>“<strong>,&nbsp;SYSFS{removable}</strong>==”<strong>1</strong>“<strong>,&nbsp;SYSFS{device/media}</strong>==”<strong>cdrom</strong>“<strong>,&nbsp;SYMLINK+=</strong>“<strong>cdrom&nbsp;cdrom-%k</strong>“<strong><br>ACTION=</strong>=”<strong>add</strong>“<strong>,&nbsp;SUBSYSTEM=</strong>=”<strong>scsi_device</strong>“<strong>,&nbsp;RUN+=</strong>“<strong>/sbin/modprobe&nbsp;sg</strong>“**</pre><br></div>

<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"><br>上面的例子给出了5个规则，每一个都是KERNEL或者ACTION键开头：</span></span></span></p>
<p><em>第一个规则是缺省的，他匹配任意被内核识别到的设备，然后设定这些设备的属组是root，组是root，访问权限模式是0600(-rw——-)。这也是一个安全的缺省设置保证所有的设备在默认情况下只有root可以读写。
</em>第二个规则也是比较典型的规则了。它匹配终端设备(tty)，然后设置新的权限为0600，所在的组是tty。它也设置了一个特别的设备文件名:%K。在这里例子里，%k代表设备的内核名字。那也就意味着内核识别出这些设备是什么名字，就创建什么样的设备文件名。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p><em>第三行开始的KERNEL==”scd[0-9]</em>“,表示 SCSI CD-ROM 驱动. 它创建一对设备符号连接：cdrom和cdrom-%k。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*第四行，开始的 KERNEL==”hd[a-z]”, 表示ATA CDROM驱动器。这个规则创建和上面的规则相同的符号连接。ATA CDROM驱动器需要sysfs值以来区别别的ATA设备，因为SCSI CDROM可以被内核唯一识别。.</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>*第五行以 ACTION==”add”开始，它告诉udev增加 /sbin/modprobe sg 到命令列表，当任意SCSI设备增加到系统后，这些命令将执行。其效果就是计算机应该会增加sg内核模块来侦测新的SCSI设备。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>当然，上面仅仅是一小部分例子，如果你的系统采用了udev方式，那你应该可以看到更多的规则。如果你想修改设备的权限或者创建信的符号连接，那么你需要熟读这些规则，特别是要仔细注意你修改的那些与之相关的设备。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p><strong>修改你的udev配置</strong></p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>在修改udev配置之前，我们一定要仔细，通常的考虑是：你最好不要修改系统预置的那些规则，特别不要指定影响非常广泛的配置，比如上面例子中的第一行。不正确的配置可能会导致严重的系统问题或者系统根本就无法这个正确的访问设备。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<p>而我们正确的做法应该是在/etc/udev/rules.d/下创建一个信的规则文件。确定你给出的文件的后缀是rules文件名给出的数字序列应该比 标准配置文件高。比如，你可以创建一个名为99-my-udev.rules的规则文件。在你的规则文件中，你可以指定任何你想修改的配置，比如，假设你 修改修改floppy设备的所在组，还准备创建一个信的符号连接/dev/floppy，那你可以这么写：</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<div class="msgborder" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; line-height: 28px; padding: 0px;"><br><pre>KERNEL=<strong>=”</strong>fd[0-9]<strong>*”</strong>,&nbsp;GROUP=<strong>“</strong>users<strong>“</strong>,&nbsp;&nbsp;&nbsp;SYMLINK+=<strong>“</strong>floppy<strong>“</strong>&nbsp;</pre><br></div>

<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"><br>有些发行版本，比如Fedora，采用了外部脚本来修改某些特定设备的属组，组关系和权限。因此上面的改动可能并不见得生效。如果你遇到了这个问题，你就需要跟踪和修改这个脚本来达到你的目的。或者你可以修改PROGRAM或RUN键的值来做到这点。</span></span></span></p>
<p>某些规则的修改可能需要更深的挖掘。比如，你可能想在一个设备上使用sysfs信息来唯一标识一个设备。这些信息最好通过udevinfo命令来获取。</p>
<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"></span></span></span></p>
<div class="msgborder" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; line-height: 28px; padding: 0px;"><br><pre>$&nbsp;udevinfo&nbsp;&ndash;a&nbsp;&ndash;p&nbsp;$(udevinfo&nbsp;&ndash;q&nbsp;path&nbsp;&nbsp;&nbsp;&ndash;n&nbsp;/dev/hda)</pre><br></div>

<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"><br>上 面的命令两次使用udevinfo：一次是返回sysfs设备路径(他通常和我们看到的Linux设备文件名所在路径－－/dev/hda－－不同)；第 二次才是查询这个设备路径，结果将是非常常的syfs信息汇总。你可以找到最够的信息来唯一标志你的设备，你可以采用适当的替换udev配置文件中的 SYSFS选项。下面的结果就是上面的命令输出</span></span></span></p>
<div class="msgborder" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; line-height: 28px; padding: 0px;"><br><pre><strong>[</strong>root@localhost&nbsp;rules.d<strong>]</strong>#&nbsp;udevinfo&nbsp;-a&nbsp;-p&nbsp;$(udevinfo&nbsp;-q&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-n&nbsp;&nbsp;&nbsp;/dev/hda1)</pre><br><br>Udevinfo&nbsp;starts&nbsp;with&nbsp;the&nbsp;device&nbsp;specified&nbsp;by&nbsp;the&nbsp;devpath&nbsp;and&nbsp;then<br>walks&nbsp;up&nbsp;the&nbsp;chain&nbsp;of&nbsp;parent&nbsp;devices.&nbsp;It&nbsp;prints&nbsp;<strong>for</strong>&nbsp;every&nbsp;device<br>found,&nbsp;all&nbsp;possible&nbsp;attributes&nbsp;<strong>in</strong>&nbsp;the&nbsp;udev&nbsp;rules&nbsp;key&nbsp;format.<br>A&nbsp;rule&nbsp;to&nbsp;match,&nbsp;can&nbsp;be&nbsp;composed&nbsp;by&nbsp;the&nbsp;attributes&nbsp;of&nbsp;the&nbsp;device<br>and&nbsp;the&nbsp;attributes&nbsp;from&nbsp;one&nbsp;single&nbsp;parent&nbsp;device.<br><br>&nbsp;&nbsp;&nbsp;looking&nbsp;at&nbsp;device&nbsp;<strong>‘</strong>/block/hda/hda1<strong>‘</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;KERNEL=<strong>=”</strong>hda1<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;SUBSYSTEM=<strong>=”</strong>block<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;DRIVER=<strong>=””</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTR{stat}<strong>==”</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1133&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2268&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTR{size}<strong>==”</strong>208782<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTR{start}<strong>==”</strong>63<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTR{dev}<strong>==”</strong>3:1<strong>“</strong><br><br>&nbsp;&nbsp;&nbsp;looking&nbsp;at&nbsp;parent&nbsp;device&nbsp;<strong>‘</strong>/block/hda<strong>‘</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;KERNELS=<strong>=”</strong>hda<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;SUBSYSTEMS=<strong>=”</strong>block<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;DRIVERS=<strong>=””</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{stat}<strong>==”</strong>&nbsp;&nbsp;&nbsp;&nbsp;28905&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18814&nbsp;&nbsp;&nbsp;1234781&nbsp;&nbsp;&nbsp;&nbsp;302540&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;34087&nbsp;&nbsp;&nbsp;&nbsp;133247&nbsp;&nbsp;&nbsp;&nbsp;849708&nbsp;&nbsp;&nbsp;&nbsp;981336&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;218340&nbsp;&nbsp;&nbsp;1283968<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{size}<strong>==”</strong>117210240<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{removable}<strong>==”</strong>0<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{range}<strong>==”</strong>64<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{dev}<strong>==”</strong>3:0<strong>“</strong><br><br>&nbsp;&nbsp;&nbsp;looking&nbsp;at&nbsp;parent&nbsp;device&nbsp;<strong>‘</strong>/devices/pci0000:00/0000:00:1f.1/ide0/0.0<strong>‘</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;KERNELS=<strong>=”</strong>0.0<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;SUBSYSTEMS=<strong>=”</strong>ide<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;DRIVERS=<strong>=”</strong>ide-disk<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{modalias}<strong>==”</strong>ide:m-disk<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{drivename}<strong>==”</strong>hda<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{media}<strong>==”</strong>disk<strong>“</strong><br><br>&nbsp;&nbsp;&nbsp;looking&nbsp;at&nbsp;parent&nbsp;device&nbsp;<strong>‘</strong>/devices/pci0000:00/0000:00:1f.1/ide0<strong>‘</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;KERNELS=<strong>=”</strong>ide0<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;SUBSYSTEMS=<strong>=””</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;DRIVERS=<strong>=””</strong><br><br>&nbsp;&nbsp;&nbsp;looking&nbsp;at&nbsp;parent&nbsp;device&nbsp;<strong>‘</strong>/devices/pci0000:00/0000:00:1f.1<strong>‘</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;KERNELS=<strong>=”</strong>0000:00:1f.1<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;SUBSYSTEMS=<strong>=”</strong>pci<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;DRIVERS=<strong>=”</strong>PIIX_IDE<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{broken_parity_status}<strong>==”</strong>0<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{enable}<strong>==”</strong>1<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{modalias}<strong>==”</strong>pci:v00008086d000024CAsv0000144Dsd0000C009bc01sc01i8a<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{local_cpus}<strong>==”</strong>1<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{irq}<strong>==”</strong>11<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{class}<strong>==”</strong>0x01018a<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{subsystem_device}<strong>==”</strong>0xc009<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{subsystem_vendor}<strong>==”</strong>0x144d<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{device}<strong>==”</strong>0x24ca<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTRS{vendor}<strong>==”</strong>0x8086<strong>“</strong><br><br>&nbsp;&nbsp;&nbsp;looking&nbsp;at&nbsp;parent&nbsp;device&nbsp;<strong>‘</strong>/devices/pci0000:00<strong>‘</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;KERNELS=<strong>=”</strong>pci0000:00<strong>“</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;SUBSYSTEMS=<strong>=””</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;DRIVERS=<strong>=””</strong><br><br></div>

<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"><br>举 一个例子：假设你想修改USB扫描仪的配置。通过一系列的尝试，你已经为这个扫描仪标识了Linux设备文件(每次打开扫描仪时，名字都会变)。你可以使 用上面的命令替换这个正确的Linux设备文件名，然后定位输出的采用SYSFS{idVendor}行和SYSFS{idProduct}行。最后你可 以使用这些信息来为这个扫描仪创建新的选项。</span></span></span></p>
<div class="msgborder" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; line-height: 28px; padding: 0px;"><br><pre>SYSFS{idVendor}<strong>==”</strong>0686<strong>“</strong>,&nbsp;<strong>\</strong><br>SYSFS{idProduct}<strong>==”</strong>400e<strong>“</strong>,&nbsp;<strong>\</strong><br>SYMLINK+=<strong>“</strong>scanner<strong>“</strong>,&nbsp;MODE=<strong>“</strong>0664<strong>“</strong>,&nbsp;<strong>\</strong><br>group=<strong>“</strong>scanner<strong>“</strong></pre><br></div>

<p><span face="Arial" style="font-family: Arial;"><span class="Apple-style-span" style="line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><span class="Apple-style-span" style="color: #080000; font-family: Georgia, 'Times New Roman', serif; font-size: 19px; line-height: 28px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"><br>上面的例子表示将扫描仪的组设置为scanner，访问权限设置为0664,同时创建一个/dev/scanner的符号连接。</span></span></span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2011/07/21/udev介绍/" data-id="cjs7p2wvn000eng5mqhn2ebpf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-极大极小博弈树的简洁（附Tic-Tac-Toe源码）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/01/26/极大极小博弈树的简洁（附Tic-Tac-Toe源码）/" class="article-date">
  <time datetime="2011-01-26T13:46:00.000Z" itemprop="datePublished">2011-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/01/26/极大极小博弈树的简洁（附Tic-Tac-Toe源码）/">极大极小博弈树的简洁（附Tic-Tac-Toe源码）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong><span size="4" style="font-size: medium;">简介</span></strong></p>
<p>极大极小博弈树(<a href="http://en.wikipedia.org/wiki/Minimax" target="_blank" rel="noopener">Minimax Game Tree</a>)用于编写电脑之间的游戏程序，这类程序由两个游戏者轮流，每次执行一个步骤。当然，所有可能的步骤构成了一个树的结构。例如下面的图就是一个MGT，它表示了<a href="http://en.wikipedia.org/wiki/Tic-tac-toe" target="_blank" rel="noopener">Tic-Tac-Toe</a>游戏的前两步所有可能的步骤。</p>
<p><img src="http://www.aihorizon.com/images/essays/minimax-tictac.gif" alt></p>
<p>在每一层中的节点通常代表不同游戏者的选择，这两个游戏者通常被称作马克思（MAX）和米恩（Min）。</p>
<p>例如如果第二层是Max turn，则第三层就是Min turn，第二层的每个节点就是Max的choice，它们之间是或的关系，第三层的每个节点就是Min的choice，它们之间是与的关系。根据这个树，Max要做出的选择就让下次Min做出的任意选择都最小，即Minimax这个词的含义，极小化对手的最大收益。所以它不同于<a href="http://en.wikipedia.org/wiki/Minimax#Maximin" target="_blank" rel="noopener">Maximin</a>最大化自己的收益。</p>
<p>因为往往一局要下到最后才能分出胜负，而<a href="http://en.wikipedia.org/wiki/Game_tree" target="_blank" rel="noopener">Game Tree</a>上nodes的增长是以指数方式的，比如深蓝（Deep Blue）可以搜索12步，假设各方每步都有10种选择，那么一次的搜索量也有1万亿次，所以对于普通的电脑能够搜索到4步也有1万次了，所以就需要一个评分系统，对局面进行打分，考虑到是双人对战，则评分从负无穷到正无穷。所以马克思就是要找到一个最大的分数，而米恩就是要找到一个最小的分数。</p>
<p><strong><span size="4" style="font-size: medium;">&nbsp;</span></strong>&nbsp;</p>
<p><strong><span size="4" style="font-size: medium;">例子</span></strong></p>
<p>下面用一个例子来说明，Tic-Tac-Toe游戏。</p>
<p>其中&lsquo;o&rsquo;代表PC，&lsquo;x&rsquo;代表玩家。</p>
<p>其中有三个主要的函数：</p>
<p>int minSearch( char _board[9] ) </p>
<p>int maxSearch( char _board[9] )</p>
<p>int gameState(char _board[9])</p>
<p>分别扮演max和min的角色，寻找最大和最小值，以及一个评分函数。</p>
<p>下面重点说说这个游戏的核心部分，gameState评分函数：</p>
<p>连三&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 100分</p>
<p>双连二&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 50分</p>
<p>平局&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0分</p>
<p>不分胜负&nbsp;&nbsp;&nbsp;&nbsp; 1</p>
<p>其中如果评分时不分胜负则还会继续搜索，直到找到其他三种状态。</p>
<p><strong>implementation</strong></p>
<div style="font-size: 8pt; margin: 20px 0px 10px; overflow: auto; width: 97.5%; cursor: text; direction: ltr; max-height: 200px; line-height: 12pt; font-family: 'Courier New', courier, monospace; background-color: #f4f4f4; text-align: left; border: silver 1px solid; padding: 4px;" id="codeSnippetWrapper"><br><div style="font-size: 8pt; overflow: visible; width: 100%; color: black; direction: ltr; line-height: 12pt; font-family: 'Courier New', courier, monospace; background-color: #f4f4f4; text-align: left; border-style: none; padding: 0px;" id="codeSnippet"><br><pre><span style="color: #606060;" id="lnum1">   1:</span> <span style="color: #0000ff;">int</span> gameState(<span style="color: #0000ff;">char</span> _board[9])</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum2">   2:</span> {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum3">   3:</span>     <span style="color: #0000ff;">int</span> state;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum4">   4:</span>     <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> table[][3] = </pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum5">   5:</span>     {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum6">   6:</span>         {0, 1, 2},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum7">   7:</span>         {3, 4, 5},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum8">   8:</span>         {6, 7, 8},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum9">   9:</span>         {0, 3, 6},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum10">  10:</span>         {1, 4, 7},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum11">  11:</span>         {2, 5, 8},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum12">  12:</span>         {0, 4, 8},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum13">  13:</span>         {2, 4, 6},</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum14">  14:</span>     };</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum15">  15:</span>     <span style="color: #0000ff;">char</span> chess = _board[0];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum16">  16:</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">char</span> i = 1; i &lt; 9; ++i)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum17">  17:</span>     {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum18">  18:</span>         chess &amp;= _board[i];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum19">  19:</span>     }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum20">  20:</span>     <span style="color: #0000ff;">bool</span> isFull = 0 != chess;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum21">  21:</span>     <span style="color: #0000ff;">bool</span> isFind = false;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum22">  22:</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; <span style="color: #0000ff;">sizeof</span>(table) / <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">int</span>[3]); ++i)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum23">  23:</span>     {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum24">  24:</span>         chess = _board[table[i][0]];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum25">  25:</span>         <span style="color: #0000ff;">int</span> j;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum26">  26:</span>         <span style="color: #0000ff;">for</span> (j = 1; j &lt; 3; ++j)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum27">  27:</span>             <span style="color: #0000ff;">if</span> (_board[table[i][j]] != chess)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum28">  28:</span>                 <span style="color: #0000ff;">break</span>;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum29">  29:</span>         <span style="color: #0000ff;">if</span> (chess != empty &amp;&amp; j == 3)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum30">  30:</span>         {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum31">  31:</span>             isFind = true;        </pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum32">  32:</span>             <span style="color: #0000ff;">break</span>;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum33">  33:</span>         }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum34">  34:</span>     }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum35">  35:</span>     <span style="color: #0000ff;">if</span> (isFind)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum36">  36:</span>         <span style="color: #008000;">//got win or lose</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum37">  37:</span>         state = chess == o ? WIN : LOSE;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum38">  38:</span>     <span style="color: #0000ff;">else</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum39">  39:</span>     {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum40">  40:</span>         <span style="color: #0000ff;">if</span> (isFull)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum41">  41:</span>             <span style="color: #008000;">//all position has been set without win or lose</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum42">  42:</span>             <span style="color: #0000ff;">return</span> DRAW;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum43">  43:</span>         <span style="color: #0000ff;">else</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum44">  44:</span>         {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum45">  45:</span>             <span style="color: #008000;">//finds[0] -&gt; ‘o’, finds[1] -&gt; ‘x’</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum46">  46:</span>             <span style="color: #0000ff;">int</span> finds[2] = {0, };</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum47">  47:</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; <span style="color: #0000ff;">sizeof</span>(table) / <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">int</span>[3]); ++i)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum48">  48:</span>             {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum49">  49:</span>                 <span style="color: #0000ff;">bool</span> findEmpty = false;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum50">  50:</span>                 chess = 0xff;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum51">  51:</span>                 <span style="color: #0000ff;">int</span> j;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum52">  52:</span>                 <span style="color: #0000ff;">for</span> (j = 0; j &lt; 3; ++j)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum53">  53:</span>                     <span style="color: #0000ff;">if</span> (_board[table[i][j]] == empty &amp;&amp; !findEmpty)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum54">  54:</span>                         findEmpty = true;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum55">  55:</span>                     <span style="color: #0000ff;">else</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum56">  56:</span>                         chess &amp;= _board[table[i][j]];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum57">  57:</span>                 <span style="color: #0000ff;">if</span> ((chess == o || chess == x) &amp;&amp; findEmpty)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum58">  58:</span>                 {</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum59">  59:</span>                     isFind = true;        </pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum60">  60:</span>                     <span style="color: #0000ff;">if</span> (o == chess)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum61">  61:</span>                         ++finds[0];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum62">  62:</span>                     <span style="color: #0000ff;">else</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum63">  63:</span>                         ++finds[1];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum64">  64:</span>                 }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum65">  65:</span>             }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum66">  66:</span>             <span style="color: #0000ff;">if</span> (finds[0] &gt; 1 &amp;&amp; finds[1] &lt; 1)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum67">  67:</span>                 <span style="color: #008000;">//2 ‘o’ has been founded twice in row, column or diagonal direction</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum68">  68:</span>                 state = -(INFINITY / 2) <em> finds[0];</em></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum69">  69:</span>             <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (finds[1] &gt; 1 &amp;&amp; finds[0] &lt; 1)</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum70">  70:</span>                 <span style="color: #008000;">//2 ‘x’ has been founded twice in row, column or diagonal direction</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum71">  71:</span>                 state = INFINITY / 2  finds[1];</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum72">  72:</span>             <span style="color: #0000ff;">else</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum73">  73:</span>                 <span style="color: #008000;">//need to search more.</span></pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum74">  74:</span>                 state = INPROGRESS;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum75">  75:</span>         }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum76">  76:</span>     }</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum77">  77:</span>     <span style="color: #0000ff;">return</span> state;</pre><br><!--CRLF--><br><pre><span style="color: #606060;" id="lnum78">  78:</span> }</pre><br><!--CRLF--></div><br></div>

<p>&nbsp;</p>
<p>最后附上源码：<a href="http://files.cnblogs.com/chinese-zmm/Tic-Tac-Toe.7z" target="_blank" rel="noopener">http://files.cnblogs.com/chinese-zmm/Tic-Tac-Toe.7z</a></p>
<p>&nbsp;</p>
<p><strong><span size="4" style="font-size: medium;">Reference</span></strong></p>
<p><a href="http://en.wikipedia.org/wiki/Minimax" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Minimax</a></p>
<p><a href="http://www.cnblogs.com/goodness/archive/2010/05/27/1745756.html" target="_blank" rel="noopener">http://www.cnblogs.com/goodness/archive/2010/05/27/1745756.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2011/01/26/极大极小博弈树的简洁（附Tic-Tac-Toe源码）/" data-id="cjs7p2wvs000kng5mw18gf1b3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-程序优化小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/01/19/程序优化小记/" class="article-date">
  <time datetime="2011-01-19T12:40:00.000Z" itemprop="datePublished">2011-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/01/19/程序优化小记/">程序优化小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近做给一块蓝牙芯片做了一个decode的功能，数据是用RLE（<a href="http://en.wikipedia.org/wiki/Run-length_encoding" title="http://en.wikipedia.org/wiki/Run-length_encoding" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Run-length_encoding</a>）流程算法压缩的。为什么选用RLE算法，因为蓝牙芯片自身memory的局限性，最大只能获得不到2K的内存，还是不连续，而解压出的数据有2K多，所以需要一种能够边解压边发送的算法，查看现在流行的几种算法：霍夫曼算法，RLE算法，查表算法。</p>
<p>&nbsp;</p>
<table cellspacing="0" cellpadding="2" width="400" border="0"><br><tbody><br><tr><br><td valign="top" width="100">&nbsp;</td><br><td valign="top" width="100">压缩率</td><br><td valign="top" width="100">实现复杂度</td><br><td valign="top" width="100">内存占用量</td><br></tr><br><tr><br><td valign="top" width="100">霍夫曼算法</td><br><td valign="top" width="100">小</td><br><td valign="top" width="100">中</td><br><td valign="top" width="100">中</td><br></tr><br><tr><br><td valign="top" width="100">RLE算法</td><br><td valign="top" width="100">中</td><br><td valign="top" width="100">小</td><br><td valign="top" width="100">小</td><br></tr><br><tr><br><td valign="top" width="100">查表算法</td><br><td valign="top" width="100">大</td><br><td valign="top" width="100">大</td><br><td valign="top" width="100">大（一般几十K）</td><br></tr><br></tbody><br></table>

<p>&nbsp;</p>
<p>由于查表算法的内存占用量一般需要几十K，所以所以首先排除，而且比较霍夫曼算法和RLE算法，RLE算法在压缩率，实现复杂度，内存占用量三个方面都占有优势，所以最终选择RLE作为压缩和解码的方法。</p>
<p>花了几天时间实现了改算法，今天对其进行了性能测试，发现解压目标数据需要200多ms，遂决定对其进行优化。</p>
<p><span color="#808080" style="color: #808080;"><strong>step1</strong>，还原行解压函数，减少一百多次的函数调用，但是实验的结果是反而增加了100多ms，猜测可能是有远指针调用，遂放弃。</span></p>
<p><strong>step2</strong>，将行解压函数中，对堆内存的访问换成对栈上数据的访问，实验下来时间减小到了70-80ms，性能提升了一倍多。</p>
<p><strong>step3</strong>，由于采用的RLE算法是经过改进过的，n + 1行的数据是和n行数据异或过，所以增加相同数据的几率，比如有三行数据时1010 1010，理论上是不能压缩的，当时经过异或，后面两行数据都变成了0000 0000，便可以采用RLE算法进行压缩。所以根据这一特性，在step3做的优化是，比较解压出的值，如果是0，则不需要和上一行的数据进行异或（因为任何数和零异或都不变）。改进后可以将时间减小到30-40ms，又提升了一倍多。</p>
<p><strong>step4</strong>，在step3的基础，在行解压算法中，如果检测到行的剩余部分都是0，则直接跳过该行剩下的部分。改进后时间减小到了十几个ms。</p>
<p>所以进过step2-4，性能提升了10倍多。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2011/01/19/程序优化小记/" data-id="cjs7p2wvt000lng5mmgh9uo9x" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Beating-the-Average-为什么要学习Lisp-转" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/12/13/Beating-the-Average-为什么要学习Lisp-转/" class="article-date">
  <time datetime="2010-12-13T10:29:00.000Z" itemprop="datePublished">2010-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/13/Beating-the-Average-为什么要学习Lisp-转/">Beating the Average------为什么要学习Lisp[转]</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span><span>出类拔萃</span></span></p>
<p>by Paul Graham</p>
<p>April 2001, rev. April 2003</p>
<p>（这篇文章改自<span>2001</span>年给<span>Franz</span>开发者论坛的演讲）</p>
<p><span>1995</span>年夏天，我和我的朋友<span>Robert Morris</span>创办了一个公司叫<span>Viaweb.&nbsp;</span>我们的计划是写一个在线商店的建站软件。当时这个软件的新颖之处是它在我们的服务器端运行，用网页作为用户界面。</p>
<p>当然，很多人当年也有同样的想法，但就我所知，<span>Viaweb</span>是第一款基于<span>web</span>的应用。我们很喜欢这个新想法，并以此为公司命名：<span>Viaweb</span>，因为我们的软件不是桌面软件而是通过网络来运行的。</p>
<p>关于这个软件，另一件特别之处就是它主要用<span>Lisp</span>写就。它是面向大众用户的<span>Lisp</span>程序的先锋，在此之前<span>Lisp</span>几乎都是用在大学和实验室的象牙塔里。<span>[1]</span></p>
<p><strong><span>The Secret Weapon</span></strong></p>
<p><span>秘密武器</span></p>
<p><span>Eric Raymond</span>写过一篇文章<span>&ldquo;</span>如何成为黑客<span>&rdquo;</span>，文中他教导黑客学前班的同学如何选择语言。他建议以<span>Python</span>和<span>Java</span>起步－因为容易学。严肃的黑客要修改<span>Unix</span>就得学<span>C</span>语言。最后，真正严肃的黑客应该考虑学习<span>Lisp:</span></p>
<p><span>&nbsp;&ldquo;</span>悟道时那种深刻的醍醐灌顶的感受是<span>Lisp</span>值得学习的一个原因；这个体验会让你在后面的岁月里成为更好的程序员－即使你<span>&nbsp;&nbsp;</span>不常用<span>Lisp</span>写程序。<span>&rdquo;</span></p>
<p>这和常听到的学习拉丁语的论调很类似。学了不会帮你找到工作（语言学教授除外），但它会训练提高你的大脑，让你在用诸如英语之类的语言写作时能够得心应手。</p>
<p>但是，等一下。这个比喻并不普遍适用。学习拉丁语找不着工作是因为没人说拉丁语。如果你用拉丁语写作，没人能理解你。但是<span>Lisp</span>是计算机语言，计算机可不挑剔程序员用什么语言。</p>
<p>如果像他说的，<span>Lisp</span>能让你成为更好的程序员，为啥不用呢？如果一个画家弄了一杆能让他下笔犹如神的画笔，在我看来，他画啥画都想用的，不是吗？我不是要取笑<span>Eric Raymond</span>。总的来讲，他的建议很好。他关于<span>Lisp</span>的说法基本是传统观点。但是这个传统观点自相矛盾：<span>Lisp</span>会让你成为更好的程序员，但你不会去用它。</p>
<p>为什么不呢？毕竟编程语言只是工具。如果<span>Lisp</span>写的程序更好的话，你就应该用它。如果用它写得烂，那谁还稀罕呢？</p>
<p>这不只是理论上的问题。软件行业竞争残酷－优胜劣汰。其他条件相同，软件写的又快又好公司会把对手挤垮。当你开始创业时，会对这一点深有体会。创业公司常处于要么盆满钵满要么一穷二白的位置。你最终要么赚翻，要么潦倒。如果你对技术押错宝了，竞争对手就会来灭掉你。</p>
<p><span>Robert</span>和我都精于<span>Lisp</span>，我们没有理由不相信自己的直觉而弃用<span>Lisp.&nbsp;</span>我们知道其他人都在用<span>C++</span>和<span>Perl</span>写软件。我们也知道这没啥大不了的。如果你选择那样的技术，就要在<span>Windows</span>上跑。选择技术时，必须忽略其他人在用什么，只考虑什么能工作得最好。</p>
<p>这在创业公司里更为适用。大公司里，你可以像其他所有大公司一样做事。但是创业公司里，你不能亦步亦趋。我不认为很多人意识到这一点了（即使是创业公司里的家伙们）。</p>
<p>大公司每年平均增长<span>10%</span>。所以你要是掌管一个大公司的话，你按照大公司的通用做事方式，你也就种瓜得瓜，种豆得豆－得到<span>10%</span>的增长。</p>
<p>创业公司里的情况也一样。如果你按照大多数创业公司的方式去做事，你也就只能期望业绩达到平均水平。这里的问题在于，平均水平意味着你要关门大吉。创业公司的成活率是大大低于<span>50%</span>的。所以，如果你开公司，最好有点与众不同。否则，麻烦就大了。</p>
<p><span>1995</span>年那会，我们知道一个竞争者尚未参透的秘密（现在也有好多蒙在鼓里呢）：如果你的软件在服务器端运行，就可以用任何你想用的语言。要是写桌面应用，很强势的一个观点就是要用操作系统的语言写应用。十年前，写应用这意味着用<span>C</span>语言写。但是，对于基于<span>Web</span>的软件，而你又有语言和操作系统的源码时，你可以用任何想用的语言。</p>
<p>然而，语言选择的自由是把双刃剑。现在你可以选了，你得思考选哪一个。那些拒绝变化的鸵鸟公司危险了：它们的对手可没有把头埋进沙子。</p>
<p>你会选哪个语言呢？我们选择<span>Lisp.&nbsp;</span>很重要的一点就是，这个市场上快速开发很重要。我们都白手起家，一个公司要是能比对手更早的做完新特性就很有优势。我们知道<span>Lisp</span>用于快速开发相当合适，而基于服务器的应用会放大这个优势－因为软件写完就可以立即发布。</p>
<p>如果其他公司不想用<span>Lisp,&nbsp;</span>真好。这在技术上会让我们有一个优势，能帮上忙的来者不拒。当我们创立<span>Viaweb</span>时，我们没有商业经验，不懂得市场推广，招聘员工，融资或者吸引用户。我们几个甚至都没工作过。我们唯一玩的转的就是写软件。我们寄希望于此。软件开发方面的任何优势，我们都不会放过。</p>
<p>你可以说采用<span>Lisp</span>是一个试验。我们的算盘是这样打的：如果我们用<span>Lisp</span>，我们功能会开发的比对手快，也可以做一些他们做不到的事情。<span>Lisp</span>很高层，我们就不需要大的开发组，我们的开销就很小。如果行得通，我们就能提供物美价廉的产品，还能盈利。最终，赢得所有用户，我们的对手则失掉用户最终关门。这就是我们当时希望的过程。</p>
<p>试验的结果如何？居然行得通。我们最终遇见了很多竞争者，<span>20</span>～<span>30</span>个吧，但没有一个能和我们针尖对麦芒。我们服务器上跑着一个<span>&ldquo;</span>所见即所得<span>&rdquo;</span>的在线商店编辑器，用起来却和桌面应用没啥差别。我们的对手们用的是<span>CGI</span>脚本。功能上我们总能先他们一步。有时，绝望中的对手想增加几个我们没有的功能。但是<span>Lisp</span>的开发周期很快，我们可以在他们发布软文宣传的一两天之内就复制一个新功能。当记者们读到他们的公关稿然后打电话给我们来问时，我们也有这个功能了。</p>
<p>我们的竞争对手也许觉得我们有什么秘密武器－能够读到他们脑子里的计划。实际上我们没有，比他们想的要简单。没人泄密他们的新功能，我们只是比任何人预期的开发速度更快而已。</p>
<p>我九岁时看过一部<span>The Day of the Jackal,&nbsp;</span>由<span>Frederick Forsyth</span>执导<span>.&nbsp;</span>主角是个刺客，要去刺杀法国总统。他必须通过警察，上到一个公寓能够俯瞰总统的行车路线。他乔装成一个跛老头，警察根本没有注意到他。</p>
<p>我们的秘密武器也差不多。我们用一个怪异的人工智能语言写软件，语法难看，充斥着括号。很多年以来，对<span>Lisp</span>的这种描述让我很不自在。现在，却成了我们的优势。商业上，拥有一项对手根本不懂的技术是无价的，正如战争一样，出其不意和厉兵秣马一样重要。</p>
<p>嗯，我有点窘：开发<span>Viaweb</span>时，公开场合我对<span>Lisp</span>只字未提。我们不向媒体说，如果你在网站上搜，也就只能找到我简历里提到的两本书。这是有意为之。如果他们不知道或者不关心我们用什么开发，我也乐于保持现状。<span>[2]</span></p>
<p>理解我们技术最好的是我们的客户。他们不关心<span>Viaweb</span>用什么写的，但是他们注意到软件跑得很好。几分钟就能建好一个漂亮的在线商店。然后，口碑就传开了，用户越来越多。<span>1997</span>年底时，我们有<span>500</span>个用户。六个月后，<span>Yahoo</span>买我们时，有了<span>1070</span>个用户。今天，成了<span>Yahoo Store</span>的<span>Viaweb</span>还统治着市场，是<span>Yahoo</span>产品线中很能盈利的一员。那些由<span>Viaweb</span>建成的商店成了<span>Yahoo Shopping</span>的基础。我<span>1999</span>年离开<span>Yahoo</span>，我不知道用户数量的具体数字，但是最近一次听到的是大约<span>20</span>，<span>000.</span></p>
<p><strong><span>The Blub Paradox</span></strong></p>
<p><strong><span>Blub</span></strong><span>困境</span></p>
<p><span>Lisp</span>到底强在哪儿？如果<span>Lisp</span>真那么棒，为啥没人用呢？听起来文绉绉的问题，实际上答案很直接。<span>Lisp</span>很棒不是因为某些痴迷者才能看到的品质，而是因为它就是所有语言中最强大的。没有普及的原因是选择编程语言不仅仅是个技术问题，而且是思维习惯－再没有比思维习惯改变得更慢得东西了。当然，这两个答案都需要解释。</p>
<p>我以一个不那么惊世骇俗的论断开始：编程语言的能力各有千秋。</p>
<p>高级语言比机器语言强大－这是个不争的事实。如今大多数程序员都赞成<span>&rdquo;</span>通常不要用机器语言写程序<span>&ldquo;</span>的观点。相反，你应当用高级语言，然后用编译器把程序编成机器语言。这个想法已经为硬件设计所采纳：自<span>80</span>年代起，指令集就专为编译器设计而不那么考虑我们程序员了。</p>
<p>人人都知道你的程序要是全用机器语言写就是个错误。但是另外一个原则却不为人熟知：如果你要从一堆语言里挑一个出来（其他条件都相同的情况下），要是不选择最强大的－这也是个错误。<span>[3]</span></p>
<p>这个原则也有很多例外。如果你的程序要和另外一个用某种语言写的程序打交道，那么通常新程序采用同样的语言是个好选择。如果你的程序只是要干点简单的活，比如数据处理或者位操作之类的，你可以用稍微低级一点的语言，还能带来速度上的优势。如果你写一个试验原型，你最好找库函数能满足要求的随便什么语言。但是大体来讲，对于应用软件，你需要用最强大的（也不太慢的）语言，其他的选择都是错误－这一定程度上和用机器语言写程序是一码事。</p>
<p>你知道机器语言很低级。但是，至少某种社会共识认为高级语言通常被认为是一样强大的。但事实并非如此。<span>&ldquo;</span>高级语言<span>&rdquo;</span>这个技术词汇实际上没有表明任何确定的东西。并没有一个位于机器语言和高级语言之间的分水岭。所有语言都位于一个由不同抽象能力构成的谱系<span>[4]</span>之中：从最强大的语言到机器语言，位置反映着语言本身的能力的差别。</p>
<p>拿<span>Cobol</span>来说，它是个高级语言－因为它能被编译成机器语言。真有人会跳出来辩护说<span>Cobol</span>和<span>Python</span>一样强吗？它要比<span>Python</span>更接近机器语言。</p>
<p>或者<span>Perl4</span>又如何呢？<span>Perl4</span>到<span>Perl5</span>之间，词法闭包被加进来了。大多数<span>Perl</span>黑客都同意<span>Perl5</span>比<span>Perl4</span>更强了。但是，一旦你同意这一点，你也就同意了一个高级语言比另一个更强大。直接的推论就是，除了特殊情况，你应当用最强大的语言。</p>
<p>然而现实中这个想法很少能实现它的结论。过了一定的年龄，程序员很少再会主动的更换语言了。他们手上碰巧用起来的随便什么语言，都被奉为圭臬。</p>
<p>程序员对于喜好的语言偏爱有加，不能自拔。我不打算伤任何人的感情，所以解释观点时，我用一个虚构的语言：<span>Blub</span>。<span>Blub</span>位于抽象谱系的中间，它不是最高级的语言，但也比<span>Cobol</span>和机器语言强。</p>
<p>实际上，我们虚构的<span>Blub</span>程序员不会用机器码或者<span>Cobol</span>：当然他们不会去写机器码－那是编译器该干的事情。对于<span>Cobol</span>，他们纳闷那些人是怎么用这语言干活的－<span>&nbsp;Cobol</span>连<span>x</span>功能都没有（<span>x</span>是一个<span>Blub</span>的功能）。</p>
<p>只要我们的<span>Blub</span>程序员朝下看，他就知道在朝下看－比<span>Blub</span>弱的语言一眼就能看出来，因为它们缺少一些<span>Blub</span>的功能。但是如果向上看，他不会意识到。他认为所看到的都是些怪异的语言。他也许会觉得看到的语言都和<span>Blub</span>差不多，只是花哨的东西太多。<span>Blub</span>对他就够好了－因为，他用<span>Blub</span>思考。</p>
<p>当我们切换到使用更高级的语言的程序员的视角，我们会发现他朝下会看到<span>Blub</span>：你怎么能用<span>Blub</span>干活呢？它连<span>y</span>功能都没有哎。</p>
<p>推理一下，只有理解最强大的语言的程序员才能一览众山，看到所有语言能力间的差别。（这也许就是<span>Eric Raymond</span>说<span>Lisp</span>能让你成为一个更好的程序员的意思。）你不能相信其他人的观点，因为<span>Blub</span>困境：他们对自己碰巧用上的语言很满意，因为这语言描绘了他们思考程序的方式。</p>
<p>我从自己的经验里知道这一点，高中时我用<span>Basic</span>写程序。这语言甚至都不支持递归。现在难以想象写程序不用递归。可那时，我可不稀罕。我用<span>Basic</span>思考，我写得很顺，我所触及皆以掌握。</p>
<p><span>Eric Raymond</span>所推荐的<span>5</span>种语言位于能力谱系的不同位置。它们的相对位置如何讨论起来比较敏感。我要说的是，我认为<span>Lisp</span>最高。要支持我的观点，我要告诉你一样其它<span>4</span>种语言都没有的东西：离了宏，你咋能编程呢？<span>[5]</span></p>
<p>很多语言都有叫做宏的东西。但是<span>Lisp</span>的宏独树一帜。信不信由你，宏和括号联系紧密。<span>Lisp</span>的设计者把那一堆括号加进来可不是为了标新立异。对于<span>Blub</span>程序员，<span>Lisp</span>看起来很怪。但是那些括号事出有因。它们是<span>Lisp</span>与其它语言本质区别的外在表现。</p>
<p><span>Lisp</span>代码由<span>Lisp</span>数据对象构成。不是在像<span>&rdquo;</span>源码文件由字符构成<span>&ldquo;</span>或者<span>&rdquo;</span>字符串也是该语言支持的数据类型之一<span>&ldquo;</span>这样的浅显的层次上：在由解析器读进内存后，<span>Lisp</span>代码就由你能遍历的数据结构构成了。</p>
<p>如果你了解编译器的工作原理，其实解析器干的活不多：要说<span>Lisp</span>的语法奇怪，还不如说<span>Lisp</span>没有语法。你写程序实际上是在写语法树－而其它语言需要编译器生成这种内部表示。你的程序完全可以存取这些语法树。你可以写程序去操作它。在<span>Lisp</span>里，这些程序叫做宏。它们是写程序的程序。</p>
<p>写程序的程序？你哪天才能用得到啊？如果你用<span>Cobol</span>思考，不常用。而用<span>Lisp</span>思考的话，答案就是：天天都用。这里要是我能举个例子说明就好了。但是这样对于不懂<span>Lisp</span>的人就是在废话了；要是从头到尾讲明白这里篇幅也不够，在<span>Ansi Common Lisp</span>里我的进度很快，但也到<span>160</span>页才开始讲宏。</p>
<p>但我想给一点有说服力的论据。<span>Viaweb</span>的编辑器代码里有<span>20</span>～<span>25%</span>的宏。宏比普通的<span>Lisp</span>程序难写，不该用的时候用就是画蛇添足。所以我们代码里的每个宏都有用。这意味着<span>20</span>～<span>25%</span>的代码是其它语言没法容易做到的。然而，挑剔的<span>Blub</span>程序员也许会找找我所声称的<span>Lisp</span>的神秘力量，这一堆宏应该能让他们迷惑不已。我们写这些宏不是为了自娱自乐－我们是个小创业公司，我们必须疯狂写程序，这样才能与竞争对手之间构筑技术上的壁垒。</p>
<p>怀疑的人会说这有什么联系吗？我们代码里的一大块是在做其它语言很难做到的事情，发布的软件做了很多竞争对手的软件没法做到的事情。也许这其中有联系。我鼓励你顺着这条线索再走走。拄着拐杖的跛老头也许还有更多去了解。</p>
<p><strong><span>Aikido for Startups</span></strong></p>
<p><span>创业公司的合气道</span></p>
<p>但是我不期望能让任何人（过了<span>25</span>岁）去学<span>Lisp</span>。这篇文章的目的不是要改变谁的思想，而是让那些有兴趣用<span>Lisp</span>的人更加确信－这些人知道<span>Lisp</span>很强大，但是因为它应用不广泛而有所顾虑。在竞争中，这是个优势。如果你的竞争对手不了解，<span>Lisp</span>的力量会加倍。</p>
<p>如果你想在创业公司里用<span>Lisp</span>，不用担心它不流行。你应当期望保持现状。事实也如此。程序设计语言的天性就是让人们乐于用它。计算机硬件的发展比个人习惯的发展快得多，程序设计的实践通常比处理器的进步落后<span>10</span>～<span>20</span>年。在<span>MIT</span>，他们<span>60’</span>就开始用高级语言写程序了，但是很多公司到了<span>80’</span>还在用机器语言。我打赌，很多人会一直用机器语言写下去，直到有一天，处理器换成了<span>RISC</span>指令集－就像急着下班的酒吧服务员急着关门一样，端掉这些人的饭碗。</p>
<p>通常，技术进步很快。但是程序设计语言不同：它不只是技术，它是程序员思考的工具。语言是技术和信仰的混合体<span>[6]</span>。于是，位于中间的语言（也就是中级程序员用的那些语言）动得跟冰山一样慢。<span>60’</span>由<span>Lisp</span>引入的垃圾回收功能，现在开始被接受。词法闭包，由<span>Lisp</span>在<span>70’</span>引入的，现在其它语言还没有广泛采纳。<span>60’</span>中<span>Lisp</span>引入的宏，现在还是处女地。</p>
<p>很明显，中间的语言族有着巨大的惯性。我不认为你能和这个力量对抗。相反，你要向合气道的选手学习：以彼之道，还治彼身。</p>
<p>如果你在大公司工作，这不太容易。你很难说你的服秃顶上司同意用<span>Lisp</span>写东西，他刚才才读到另一种语言新鲜出炉（就像<span>Ada</span>二十年前那样），正要征服世界。但是你要是为创业公司工作，没有秃顶老板干涉，你就能像我们那样化解<span>Blub</span>困境，转为自己的优势：你可以用那些黏糊在中间语言的竞争者不能采用的技术。</p>
<p>如果你为创业公司工作，这儿有个估量对手的妙招：读读他们的招聘职位列表。他们网站上其它的东西无非是些股票图片和乏味的说明，但是招聘职位却必须反映他们要找的人，否则会引来一堆无关的求职者。</p>
<p>在<span>Viaweb</span>工作的时候，我读了不少职位描述。大约每个月都有一个新的竞争对手加入这个行当。检查了他们的在线<span>Demo</span>后，我做的第一件事就是看看他们的招聘页。过了几年，我就知道要当心哪家。工作描述里要是<span>IT</span>类的成分越多，这家公司就越不构成威胁。对我们最安全的就是那些要求<span>Oracle</span>经验的，永远都不用担心他们。他们要是招聘<span>C++</span>或者<span>Java</span>开发者，也不用担心。但是要是找的是<span>Perl</span>或者<span>Python</span>程序员，就有点威胁了－这公司至少在技术方面是由真正的黑客掌管的。要是当初我看见一家招<span>Lisp</span>黑客的，我一定会忧心忡忡的。</p>
<p>－－－－－</p>
<p>注：</p>
<p><span>[1] Viaweb</span>一开始有两块：编辑器（用<span>Lisp</span>写的，客户用来建站）和订单系统（用<span>C</span>写的，处理订单）。第一版主要是<span>Lisp,</span>因为订单系统很小。后来增加了两个模块：<span>C</span>写的图片生成器以及<span>Perl</span>写的结算工具。</p>
<p><span>2003</span>年一月，<span>Yahoo</span>发布了新的编辑器，用<span>C++</span>和<span>Perl</span>写的。也很难讲这程序就不再是用<span>Lisp</span>写的了：因为要把它翻译成<span>C++</span>，他们先得写一个<span>Lisp</span>解释器－页面生成模板的代码据我所知还是<span>Lisp</span>的。（参考<span>Greenspun’s Tenth Rule</span>。）</p>
<p><span>[2] Robert Morris</span>说我没必要那么保密。因为即使竞争对手知道我们用<span>Lisp</span>，他们也不会理解原因的：<span>&rdquo;</span>如果他们足够聪明，那他们应当已经在用<span>Lisp</span>了。<span>&ldquo;</span></p>
<p><span>[3]&nbsp;</span>所有语言在图灵相等这一层上是一样强大的。但是这和程序员的意思不一样。（没人想在图灵机上写程序。）程序员在意的语言的能力也许不能形式化的定义，但一种解释就是，你想要在弱的语言里的要某种强语言的功能，就只能用弱语言去写一个解释器。如果<span>A</span>语言由一个操作可以把字符串里的空格移走，而<span>B</span>语言没有，这并不意味着<span>B</span>语言弱，因为你可以写个函数来完成这件事。但是要是<span>A</span>支持递归，而<span>B</span>不支持，这你就不好写个库函数来完成了。</p>
<p><span>[4]&nbsp;</span>对<span>Nerd</span>们的注解：可能是个格，顶尖；形状不重要，这里至少有个偏序关系。</p>
<p><span>[5]&nbsp;</span>把宏当作一个单独的功能有点误导。实践中，宏的作用通常由其它一些<span>Lisp</span>特性比如词法闭包以及<span>rest</span>参数大大加强。</p>
<p><span>[6]&nbsp;</span>这样，比较编程语言要么挑起信仰口水战要么就只能在绝对中立的教材里，这只能是人类学的工作了。想追求平静，保护自己的所有的人会避免这个话题。但是，这问题只是一半和信仰相关；还有值得研究的东西，特别是你要设计一个新语言时。</p>
<p>译注：</p>
<p>[1] 翻译时中英混排，完成时提取中文可以用grep:&nbsp;</p>
<p>&nbsp;</p>
<p>from:<a href="http://article.yeeyan.org/view/11304/49653" target="_blank" rel="noopener">http://article.yeeyan.org/view/11304/49653</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/12/13/Beating-the-Average-为什么要学习Lisp-转/" data-id="cjs7p2wuw0000ng5m44h9x5je" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-巧用qmake工具生成专业的makefile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/12/11/巧用qmake工具生成专业的makefile/" class="article-date">
  <time datetime="2010-12-11T03:58:00.000Z" itemprop="datePublished">2010-12-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/11/巧用qmake工具生成专业的makefile/">巧用qmake工具生成专业的makefile</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>问题描述</strong></p>
<p>一般来说在Linux下编程写个测试程序，都需要制作一个makefile文件，但是如果自己手动编写每个还是比较麻烦，而且看上去也不太专业。而如果用autoconf工具生成也还是需要加入一些手动操作，也不是很方便。</p>
<p><strong>解决方法</strong></p>
<p>利用QT程序里的qmake工具，qmake工具是QT 开发环境中的工具，它可以根据文件夹下的文件生成.pro文件，这个文件类似于vs的.vcproject，然后再根据这个.pro文件生成makefile文件。</p>
<p><strong>操作步骤</strong></p>
<p>安装qmake工具</p>
<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">&nbsp;</span></span></p>
<div class="cnblogs_code"><br><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">sudo apt</span><span style="color: #000000;">-</span><span style="color: #0000ff;">get</span><span style="color: #000000;"> install qt4</span><span style="color: #000000;">-</span><span style="color: #000000;">qmake</span></div><br></div>

<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">在src文件夹下执行</span></span></p>
<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">&nbsp;</span></span></p>
<div class="cnblogs_code"><br><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">qmake </span><span style="color: #000000;">-</span><span style="color: #000000;">project </span><span style="color: #000000;">–</span><span style="color: #000000;">生成.pro文件<br>qmake                  </span><span style="color: #000000;">–</span><span style="color: #000000;">根据.pro文件生成makefile<br>make</span></div><br></div>

<p>&nbsp;</p>
<p><strong><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">注意</span></span></strong></p>
<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">由于qmake是QT的工具，所以它会在.pro中加入qt的几个默认库，如果你不想下载这些库，可以在.pro文件中添加加下面两句，去除对默认库的引用。</span></span></p>
<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">&nbsp;</span></span></p>
<div class="cnblogs_code"><br><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">CONFIG </span><span style="color: #000000;">-=</span><span style="color: #000000;"> qt<br>QT </span><span style="color: #000000;">-=</span><span style="color: #000000;"> gui core</span></div><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;">最后附上pro文件的配置文档：</span></span></p>
<p><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12pt;"><span style="font-size: 13px; line-height: 19px; white-space: pre;"><a href="http://doc.qt.nokia.com/4.6/qmake-variable-reference.html" target="_blank" rel="noopener">http://doc.qt.nokia.com/4.6/qmake-variable-reference.html</a><br></span></span></p>
<p>当然如果要生成复杂的makefile文件还是要通过autoconf类似的工具：</p>
<p><a href="http://www.chinaunix.net/jh/4/782832.html" target="_blank" rel="noopener">http://www.chinaunix.net/jh/4/782832.html</a></p>
<p>&nbsp;</p>
<p>虽然这篇文章内容比较简单，但是应该能给大家编写测试代码带来一些方便，所以就发到首页了，希望能给大家带来帮助。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/12/11/巧用qmake工具生成专业的makefile/" data-id="cjs7p2wvr000jng5mprr8hbpx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">八月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">七月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">一月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">十二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">十月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">八月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">五月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">四月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">一月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">十月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">八月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">四月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">三月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">二月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/04/">四月 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">一月 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/15/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/02/15/tutoial-of-hexo/">利用Hexo+Github搭建个人免费博客</a>
          </li>
        
          <li>
            <a href="/2016/05/30/QT项目性能调优小记/">QT项目性能调优小记</a>
          </li>
        
          <li>
            <a href="/2015/08/28/Windows下HG服务器的搭建/">Windows下HG服务器的搭建</a>
          </li>
        
          <li>
            <a href="/2011/08/10/svn-tp-link-花生壳搭建外网服务器/">svn+tp-link+花生壳搭建外网服务器</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 三闻鱼<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>