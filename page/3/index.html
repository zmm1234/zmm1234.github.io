<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Submarine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="record tech &amp; life">
<meta property="og:type" content="website">
<meta property="og:title" content="Submarine">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Submarine">
<meta property="og:description" content="record tech &amp; life">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Submarine">
<meta name="twitter:description" content="record tech &amp; life">
  
    <link rel="alternate" href="/atom.xml" title="Submarine" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Submarine</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">chinese submarine</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-TimeZoneChange事件的捕获" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/08/08/TimeZoneChange事件的捕获/" class="article-date">
  <time datetime="2009-08-08T05:03:00.000Z" itemprop="datePublished">2009-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/08/08/TimeZoneChange事件的捕获/">TimeZoneChange事件的捕获</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>需求：在c#中要捕获TimeZone变化的事件。 </p>
<p>经过简单的分析发现，c#中没有直接捕获TimeZone Change的事件，但是通过google搜索时，发现一个SystemEvents类提供了许多系统属性变化的时间，其中有一个就是TimeChange事件。考虑到TimeZone带来的附加效果就是Time的变化，所以在此利用了TimeChange事件，来捕获TimeZoneChange事件，具体的代码如下： </p>
<p>&nbsp;</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_130054">Code</span><span id="Code_Open_Text_130054" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">sealed</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">class</span><span style="color: #000000">&nbsp;TimeEvents<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_39_939_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_39_939_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">static</span><span style="color: #000000">&nbsp;TimeZoneInfo&nbsp;PreviousTimeZone;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">static</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">event</span><span style="color: #000000">&nbsp;EventHandler&nbsp;TimeZoneChangedEvent;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">static</span><span style="color: #000000">&nbsp;TimeEvents()<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_194_327_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_194_327_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PreviousTimeZone&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;TimeZoneInfo.Local;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft.Win32.SystemEvents.TimeChanged&nbsp;</span><span style="color: #000000">+=</span><span style="color: #000000">&nbsp;OnTimeChanged;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">private</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">static</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">void</span><span style="color: #000000">&nbsp;OnTimeChanged(</span><span style="color: #0000ff">object</span><span style="color: #000000">&nbsp;sender,&nbsp;EventArgs&nbsp;e)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_407_717_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_407_717_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Globalization.CultureInfo.CurrentCulture.ClearCachedData();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeZoneInfo.ClearCachedData();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">if</span><span style="color: #000000">&nbsp;(TimeZoneInfo.Local&nbsp;</span><span style="color: #000000">!=</span><span style="color: #000000">&nbsp;PreviousTimeZone)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_600_707_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_600_707_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnTimeZoneChanged();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PreviousTimeZone&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;TimeZoneInfo.Local;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">private</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">static</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">void</span><span style="color: #000000">&nbsp;OnTimeZoneChanged()<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_775_933_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_775_933_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">if</span><span style="color: #000000">&nbsp;(</span><span style="color: #0000ff">null</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">!=</span><span style="color: #000000">&nbsp;TimeZoneChangedEvent)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_835_923_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_835_923_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeZoneChangedEvent(</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;TimeEvents(),&nbsp;EventArgs.Empty);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></span></div>

<p>Remarks： </p>
<p>由于TimeZoneInfo对象使用了缓存机制，即它会将获得的TimeZoneInfo缓存起来，在用户请求当前时区属性（Local）时，直接返回缓存的TimeZone，而不重新获取新的TimeZone，所以在获取新的TimeZone属性时，需要先清空Culture和TImeZone的缓存，如下所示： </p>
<p>&nbsp;</p>
<div class="cnblogs_code"><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;System.Globalization.CultureInfo.CurrentCulture.ClearCachedData();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeZoneInfo.ClearCachedData();</span></div>

<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/08/08/TimeZoneChange事件的捕获/" data-id="cjs7p2wve0006ng5mlnxlqu41" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-浏览器扩展系列————透明浏览器窗口的实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/26/浏览器扩展系列————透明浏览器窗口的实现/" class="article-date">
  <time datetime="2009-04-26T11:44:00.000Z" itemprop="datePublished">2009-04-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/26/浏览器扩展系列————透明浏览器窗口的实现/">浏览器扩展系列————透明浏览器窗口的实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-family: 宋体">首先先看一下效果图：</span></p>
<p><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/%E6%88%AA%E5%9B%BE.jpg" alt></p>
<p><span style="font-family: 宋体">&nbsp;&nbsp;&nbsp; </span><span style="font-family: 宋体">本实现是基于WPF，VS版本2008 SP1。</span></p>
<p><span style="font-family: 宋体">&nbsp;&nbsp;&nbsp; </span><span style="font-family: 宋体">先说一下在Winform中的实现方法：很简单通过设置窗体的opacity来实现，或者还可以设置TransparentKey来实现某种颜色透明。但是在WPF中则如何实现呢？</span></p>
<p><span style="font-family: 宋体">通过设置窗体的opacity，那么得到结果就是webbrowser整体消失了。因为这里面涉及到WPF中&#8220;空域&#8221;的问题，相关的文章如下：</span></p>
<p><span style="font-family: 宋体"><a href="http://blogs.msdn.com/changov/archive/2009/01/19/webbrowser-control-on-transparent-wpf-window.aspx" target="_blank" rel="noopener">http://blogs.msdn.com/changov/archive/2009/01/19/webbrowser-control-on-transparent-wpf-window.aspx</a></span></p>
<p><span style="font-family: 宋体">&nbsp;&nbsp;&nbsp; </span><span style="font-family: 宋体">由此看来通过直接设置透明度的方法是不行了，那么回到原来的问题，&#8220;将浏览器窗体背景成透明&#8221;，其实这里的透明只是一个视觉上的感觉，就是浏览器中网页的背景和整个窗体的背景想融合就可以。看到这里，各位看官可能已经想到了，将浏览器中页面的背景绘制成被浏览器控件所覆盖出的背景就可以了。确实，我的实现也是依照这种思路走的。</span></p>
<p><span style="font-family: 宋体">&nbsp;&nbsp;&nbsp; </span><span style="font-family: 宋体">这里主要用到了两个技术：</span></p>
<p><span style="font-family: Wingdings">l&nbsp;</span><span style="font-family: 宋体">Mshtml</span><span style="font-family: 宋体">操作网页中元素，通过给body标签添加行为来实现背景的绘制。</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_171324">Code</span><span id="Code_Open_Text_171324" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt><span style="color: #000000">[ComVisible(</span><span style="color: #0000ff">true</span><span style="color: #000000">),&nbsp;Guid(</span><span style="color: #800000">“</span><span style="color: #800000">0015EC28-C85F-49a8-9B1A-DC91E6345274</span><span style="color: #800000">“</span><span style="color: #000000">),<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;ClassInterface(ClassInterfaceType.AutoDispatch)]<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">class</span><span style="color: #000000">&nbsp;MyGadgetBodyBehavior&nbsp;:&nbsp;IElementBehavior,&nbsp;IHTMLPainter<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_193_385_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_193_385_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">delegate</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">void</span><span style="color: #000000">&nbsp;SizeChangedEventHandler(SizeChangedEventArgs&nbsp;e);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">event</span><span style="color: #000000">&nbsp;SizeChangedEventHandler&nbsp;onSizeChangedEvent;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">private</span><span style="color: #000000">&nbsp;AppScreenSnapHelper&nbsp;snapHelper;</span></span></span></div>

<p>&nbsp;</p>
<p>下面是绘制部分的代码</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_171446">Code</span><span id="Code_Open_Text_171446" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">void</span><span style="color: #000000">&nbsp;Draw(RECT&nbsp;rcBounds,&nbsp;RECT&nbsp;rcUpdates,&nbsp;</span><span style="color: #0000ff">int</span><span style="color: #000000">&nbsp;lDrawFlags,&nbsp;IntPtr&nbsp;hdc,&nbsp;IntPtr&nbsp;pvDrawObject)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_106_1488_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_106_1488_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Graphics&nbsp;g&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;Graphics.FromHdc(hdc);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bitmap&nbsp;buffer&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;Bitmap(width,&nbsp;height);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Graphics&nbsp;gBuffer&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;Graphics.FromImage(buffer);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AppScreenSnapHelper.Image&nbsp;image&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;snapHelper.GetScreenSnap();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBuffer.DrawImage(image.Bitmap,&nbsp;</span><span style="color: #800080">0</span><span style="color: #000000">,&nbsp;</span><span style="color: #800080">0</span><span style="color: #000000">);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image.Dispose();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">string</span><span style="color: #000000">&nbsp;imageSrc&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;((IHTMLElement2)body).currentStyle.backgroundImage;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">if</span><span style="color: #000000">&nbsp;(</span><span style="color: #000000">!</span><span style="color: #0000ff">string</span><span style="color: #000000">.IsNullOrEmpty(imageSrc))<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_569_1084_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_569_1084_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match&nbsp;match&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;Regex.Match(imageSrc,&nbsp;</span><span style="color: #800000">@”</span><span style="color: #800000">url(“”file:///(?&lt;path&gt;.*)””)</span><span style="color: #800000">“</span><span style="color: #000000">);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">if</span><span style="color: #000000">&nbsp;(match.Success)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_712_1070_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_712_1070_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imageSrc&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;match.Groups[</span><span style="color: #800000">“</span><span style="color: #800000">path</span><span style="color: #800000">“</span><span style="color: #000000">].Value;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">using</span><span style="color: #000000">&nbsp;(Bitmap&nbsp;bitmap&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;Bitmap(imageSrc))<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_858_1052_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_858_1052_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">object</span><span style="color: #000000">&nbsp;obj&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;((IHTMLElement2)body).currentStyle.marginLeft;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBuffer.DrawImage(bitmap,&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;Rectangle(</span><span style="color: #800080">0</span><span style="color: #000000">,&nbsp;</span><span style="color: #800080">0</span><span style="color: #000000">,&nbsp;width,&nbsp;height));<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.DrawImage(buffer,&nbsp;rcUpdates.left,&nbsp;rcUpdates.top,<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;Rectangle(rcUpdates.left&nbsp;</span><span style="color: #000000">-</span><span style="color: #000000">&nbsp;rcBounds.left,<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcUpdates.top&nbsp;</span><span style="color: #000000">-</span><span style="color: #000000">&nbsp;rcBounds.top,&nbsp;rcUpdates.right&nbsp;</span><span style="color: #000000">-</span><span style="color: #000000">&nbsp;rcUpdates.left,<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcUpdates.bottom&nbsp;</span><span style="color: #000000">-</span><span style="color: #000000">&nbsp;rcUpdates.top),&nbsp;GraphicsUnit.Pixel);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer.Dispose();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBuffer.Dispose();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.Dispose();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></span></div>

<p>&nbsp;</p>
<p>l&nbsp;<span style="font-size: 10pt; font-family: 宋体">RenderTargetBitmap</span><span style="font-size: 10pt; font-family: 宋体">类用来给应用程序截图：</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_171631">Code</span><span id="Code_Open_Text_171631" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt><span style="color: #0000ff">internal</span><span style="color: #000000">&nbsp;Image&nbsp;GetScreenSnap(</span><span style="color: #0000ff">bool</span><span style="color: #000000">&nbsp;isForceRefresh)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_58_963_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_58_963_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">if</span><span style="color: #000000">&nbsp;(CheckPositionAndSize()&nbsp;</span><span style="color: #000000">&amp;&amp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">!</span><span style="color: #000000">isForceRefresh)<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_131_182_Closed_Text" style="border-right: #808080 1px solid; border-top: #808080 1px solid; display: none; border-left: #808080 1px solid; border-bottom: #808080 1px solid; background-color: #ffffff"><img src="http://www.cnblogs.com/Images/dot.gif" alt></span><span id="Codehighlighter1_131_182_Open_Text"><span style="color: #000000">{<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">return</span><span style="color: #000000">&nbsp;screenImage;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000"><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;control.Visibility&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;Visibility.Hidden;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RenderTargetBitmap&nbsp;bitmap&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;RenderTargetBitmap((</span><span style="color: #0000ff">int</span><span style="color: #000000">)parentWindow.Width,<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000ff">int</span><span style="color: #000000">)parentWindow.Width,&nbsp;</span><span style="color: #800080">96</span><span style="color: #000000">,&nbsp;</span><span style="color: #800080">96</span><span style="color: #000000">,&nbsp;PixelFormats.Pbgra32);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitmap.Render(parentWindow);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitmapSource&nbsp;bitmapSource&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;bitmap.CloneCurrentValue();<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bitmap&nbsp;newBitmap&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;ConvertSourceImageToBitmap(bitmapSource);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newBitmap&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;ClipBitmap(newBitmap,&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;System.Drawing.Rectangle((</span><span style="color: #0000ff">int</span><span style="color: #000000">)oldPoint.X,&nbsp;(</span><span style="color: #0000ff">int</span><span style="color: #000000">)oldPoint.Y,<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((</span><span style="color: #0000ff">int</span><span style="color: #000000">)control.Width&nbsp;</span><span style="color: #000000">==</span><span style="color: #000000">&nbsp;</span><span style="color: #800080">0</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">?</span><span style="color: #000000">&nbsp;</span><span style="color: #800080">1</span><span style="color: #000000">&nbsp;:&nbsp;(</span><span style="color: #0000ff">int</span><span style="color: #000000">)control.Width),&nbsp;((</span><span style="color: #0000ff">int</span><span style="color: #000000">)control.Height)&nbsp;</span><span style="color: #000000">==</span><span style="color: #000000">&nbsp;</span><span style="color: #800080">0</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">?</span><span style="color: #000000">&nbsp;</span><span style="color: #800080">1</span><span style="color: #000000">&nbsp;:&nbsp;(</span><span style="color: #0000ff">int</span><span style="color: #000000">)control.Height));<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt><br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;control.Visibility&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;Visibility.Visible;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screenImage&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;Image(newBitmap,&nbsp;imagePtr);<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff">return</span><span style="color: #000000">&nbsp;screenImage;<br><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" alt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></span></div>

<p>在截图的时候这里使用了一个技巧就是，先将控件隐藏，然后截图，最后恢复控件的显示。&nbsp;</p>
<p>最后说一下本实现的一些缺陷：</p>
<ol>
<li>&nbsp;如果将应用程序的背景设置为透明，则浏览器的背景将呈现白色，因为本实现使用的是应用程序的背景来进行截图，如果应用程序背景被透明，则截图得到的也是一张透明的图片，绘制到页面上后并不能达到透明的效果。如果想在这种情况下实现透明，可以考虑对桌面背景进行截图。</li>
<li>如果网页过大出现滚动条，那么网页中未呈现的部分并不能透明，因为截图只能作用于已经显示的部分。所以本实现用于显示本地控制好大小的html页面有比较好的效果。</li>
</ol>
<p>具体项目下载如下：</p>
<p><a href="http://files.cnblogs.com/chinese-zmm/TransportWebBrowserDemo.rar" target="_blank" rel="noopener">/Files/chinese-zmm/TransportWebBrowserDemo.rar</a>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/04/26/浏览器扩展系列————透明浏览器窗口的实现/" data-id="cjs7p2ww9000qng5mx9jk2del" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-浏览器扩展系列————异步可插入协议（pluggable-protocol）的实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/03/28/浏览器扩展系列————异步可插入协议（pluggable-protocol）的实现/" class="article-date">
  <time datetime="2009-03-28T10:42:00.000Z" itemprop="datePublished">2009-03-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/03/28/浏览器扩展系列————异步可插入协议（pluggable-protocol）的实现/">浏览器扩展系列————异步可插入协议（pluggable protocol）的实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;&nbsp; &nbsp; &nbsp;IE中有很多我们比较熟悉的协议，如http,https,mailto,ftp等。当然你也可以实现自己定义的协议，稍微谈一下这里所说的协议，从我的理解来说这里的协议只有当你的网页引用某个资源时才会调用，而不是随便在某个属性的值前面加上某个协议的名称就可以了。常见的协议调用如img的src属性中，很多元素style中的background-image属性中，还有a标签的href属性中。</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; 言归正传，前面说到的实现自定义协议就用到了一种IE下异步可插入协议的技术。</p>
<p>&nbsp;&nbsp; &nbsp; &nbsp; 从分类上来说，这种异步可插入协议的技术还分为两种：</p>
<ul>
<li>永久的异步可插入协议，就像http，https，mailto这种不论在ie中或是其它用到浏览器控件中使用。</li>
<li>临时的异步可插入协议，只能用在某个进程内，用完可以擦除。</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;&nbsp; &nbsp; 更详细介绍异步可插入协议的资源有<a href="http://www.cppblog.com/bigsml/archive/2008/03/23/45145.html" target="_blank" rel="noopener">http://www.cppblog.com/bigsml/archive/2008/03/23/45145.html</a>。</p>
<p>&nbsp;&nbsp; &nbsp; 因为网上介绍永久的异步可插入协议的资源还很多，如codeproject上的：</p>
<blockquote>
<p><a href="http://www.cppblog.com/bigsml/archive/2008/03/23/45145.html" target="_blank" rel="noopener">http://www.cppblog.com/bigsml/archive/2008/03/23/45145.html</a><br><a href="http://www.codeproject.com/KB/aspnet/AspxProtocol.aspx" target="_blank" rel="noopener">http://www.codeproject.com/KB/aspnet/AspxProtocol.aspx</a></p>
</blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;这篇就主要谈谈如何实现临时的异步可插入协议的方法。</p>
<p>&nbsp;</p>
<p>下面谈下具体的实现。</p>
<p>在本实现中主要用到了下面这几个接口：</p>
<ul>
<li><span style="font-size:12pt"><strong>IInternetProtocol
</strong></span></li>
<li><span style="font-size:12pt"><strong>IInternetProtocolRoot
</strong></span></li>
<li><span style="font-size:12pt"><strong>IInternetSession
</strong></span></li>
<li><div><span style="font-size:12pt"><strong>IInternetProtocolInfo
</strong></span></div>

<p>&nbsp;</p>
</li>
</ul>
<p><strong>IInternetProtocol</strong>接口</p>
<p>它有四个方法：</p>
<div><br><table style="border-collapse: collapse; background-image: initial; background-repeat: initial; background-attachment: initial; background-color: #eeeeee; " border="0"><br>    <colgroup><col style="width:101px"><col style="width:483px"></colgroup><br>    <tbody valign="top"><br>        <tr><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">LockRequest</span>&nbsp;<br><br>            </td><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">Locks the requested resource so that the IInternetProtocolRoot::Terminate method can be called, and the remaining data can be read. </span><br><br>            </td><br>        </tr><br>        <tr><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">Read</span>&nbsp;<br><br>            </td><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">Reads data that the pluggable protocol handler gets. </span>&nbsp;<br><br>            </td><br>        </tr><br>        <tr><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">Seek</span>&nbsp;<br><br>            </td><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">Moves the current seek offset.</span>&nbsp;<br><br>            </td><br>        </tr><br>        <tr><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">UnlockRequest</span>&nbsp;<br><br>            </td><br>            <td style="padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; "><br><br><span style="font-family:Cambria">Frees any resources associated with a lock. </span><br><br>            </td><br>        </tr><br>    </tbody></table><br>    </div>

<p>主要用于下载资源，将处理后的资源传递给IE进行显示。</p>
<pre><code>&amp;nbsp;
</code></pre><p><strong>IInternetProtocolRoot</strong>接口</p>
<pre><code>&lt;div&gt;
&lt;table style=&quot;border-collapse: collapse; background-image: initial; background-repeat: initial; background-attachment: initial; background-color: #eeeeee; &quot; border=&quot;0&quot;&gt;
    &lt;colgroup&gt;&lt;col style=&quot;width:74px&quot;&gt;&lt;col style=&quot;width:510px&quot;&gt;&lt;/colgroup&gt;
    &lt;tbody valign=&quot;top&quot;&gt;
        &lt;tr&gt;
            &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Abort</span>&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Cancels an operation that is in progress. </span>&nbsp;</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Continue</span>&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Enables the pluggable protocol handler to continue processing data on the apartment thread. </span>&nbsp;</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Resume</span>&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Not currently implemented. </span>&nbsp;</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Start</span>&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Starts the operation. </span></p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Suspend</span>&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Not implemented.</span>&nbsp;</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Terminate</span>&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p><span style="font-size:12pt">Releases the resources used by the pluggable protocol handler. </span>&nbsp;</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
</code></pre><p>主要用于解析资源，准备待下载的资源。</p>
<pre><code>&amp;nbsp;
</code></pre><p><strong>IInternetSession</strong>接口</p>
<p>它包括9个方法，根据需要我们只用到了下面两个方法：</p>
<pre><code>&lt;div&gt;
&lt;table style=&quot;border-collapse: collapse; background-image: initial; background-repeat: initial; background-attachment: initial; background-color: #eeeeee; &quot; border=&quot;0&quot;&gt;
    &lt;colgroup&gt;&lt;col style=&quot;width:140px&quot;&gt;&lt;col style=&quot;width:444px&quot;&gt;&lt;/colgroup&gt;
    &lt;tbody valign=&quot;top&quot;&gt;
        &lt;tr&gt;
            &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>RegisterNameSpace</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>Registers a temporary pluggable namespace handler on the current process.</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>UnregisterNameSpace&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>Unregisters a temporary pluggable namespace handler.&nbsp;</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
</code></pre><p>实现临时可插入协议的注册和取消。</p>
<pre><code>&amp;nbsp;
</code></pre><p><strong>IInternetProtocolInfo</strong>接口<strong>
            </strong></p>
<p>它包括4个方法。</p>
<pre><code>&lt;div&gt;
&lt;table style=&quot;border-collapse: collapse; background-image: initial; background-repeat: initial; background-attachment: initial; background-color: #eeeeee; &quot; border=&quot;0&quot;&gt;
    &lt;colgroup&gt;&lt;col style=&quot;width:79px&quot;&gt;&lt;col style=&quot;width:327px&quot;&gt;&lt;/colgroup&gt;
    &lt;tbody valign=&quot;top&quot;&gt;
        &lt;tr&gt;
            &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>CombineUrl&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>Combines a base URL and relative URL into a full URL. &nbsp;</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>CompareUrl&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>Compares two URLs and determines if they are equal. </p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>ParseUrl&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>Parses a URL. &nbsp;</p>
<pre><code>    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>QueryInfo&nbsp;</p>
<pre><code>&lt;/td&gt;
&lt;td style=&quot;padding-top: 2px; padding-left: 2px; padding-bottom: 2px; padding-right: 2px; &quot;&gt;
</code></pre><p>Gets information related to the specified URL. &nbsp;</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
</code></pre><p>主要提供了对于Url的处理。</p>
<pre><code>&amp;nbsp;
</code></pre><p>此外，在构造IInternetSession的时候还用到了一个外部方法：</p>
<p><span style="font-family:新宋体; font-size:10pt">[<span style="color:#2b91af">DllImport</span>(<span style="color:#a31515">“urlmon.dll”</span>)]<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><span style="color:blue">private</span><br>                <span style="color:blue">static</span><br>                <span style="color:blue">extern</span><br>                <span style="color:blue">void</span> CoInternetGetSession(<span style="color:blue">int</span> sessionMode,<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:blue">out</span><br>                <span style="color:#2b91af">IInternetSession</span> session, <span style="color:blue">int</span> reserved);<br>                </span></p>
<pre><code>&amp;nbsp;
</code></pre><p>预备的知识介绍完，下面就是具体实现了。</p>
<p>一般方法是在一个类中实现<strong>IInternetProtocol，IInternetProtocolRoot，IInternetProtocolInfo</strong>三个接口，然后通过IInternetSession接口的<span style="font-family:新宋体; font-size:10pt">RegisterNameSpace方法</span>来注册这个自定义协议，用完这后再调用UnregisterNameSpace方法来注销这个自定义协议。</p>
<p>关于IE和<strong>IInternetProtocol，IInternetProtocolRoot，IInternetProtocolInfo</strong>三个接口的调用流程可以参考msdn上的介绍,中文版的翻译可以参考：</p>
<p><a href="http://www.cnblogs.com/volnet/archive/2008/03/28/About_Asynchronous_Pluggable_Protocols.html" target="_blank" rel="noopener">http://www.cnblogs.com/volnet/archive/2008/03/28/About_Asynchronous_Pluggable_Protocols.html</a></p>
<pre><code>&amp;nbsp;
</code></pre><p>首先通过CoInternetGetSession方法得到一个IInternetSession对象，然后注册自定义的协议：</p>
<p><span style="font-family:新宋体; font-size:10pt"><span style="color:#2b91af">IInternetSession</span> session;<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">CoInternetGetSession(0, <span style="color:blue">out</span> session, 0);<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><span style="color:#2b91af">Guid</span> guid = <span style="color:blue">new</span><br>                <span style="color:#2b91af">Guid</span>(<span style="color:#a31515">“79EAC9E4-BAF9-11CE-8C82-00AA004BA90B”</span>);<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">session.RegisterNameSpace(<span style="color:blue">new</span><br>                <span style="color:#2b91af">ClassFactory</span>(), <span style="color:blue">ref</span> guid, ProcotolName, 0, <span style="color:blue">null</span>, 0);<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">在注册的时候要传入一个实现了IClassFactory接口的对象，下面是对次接口的实现：<br>                </span></p>
<p><span style="color:green; font-family:新宋体; font-size:10pt">// Interface IClassFactory is here to provide a C# definition of the<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:green">// COM IClassFactory interface.<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt">    [<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:#2b91af">ComImport</span>, <span style="color:green">// This interface originated from COM.<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:#2b91af">ComVisible</span>(<span style="color:blue">true</span>), <span style="color:green">// It is not hard to imagine that this interface must not be exposed to COM.<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:#2b91af">InterfaceType</span>(<span style="color:#2b91af">ComInterfaceType</span>.InterfaceIsIUnknown), <span style="color:green">// Indicate that this interface is not IDispatch-based.<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:#2b91af">Guid</span>(<span style="color:#a31515">“00000001-0000-0000-C000-000000000046”</span>)  <span style="color:green">// This GUID is the actual GUID of IClassFactory.<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt">    ]<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:blue">public</span><br>                <span style="color:blue">interface</span><br>                <span style="color:#2b91af">IClassFactory<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt">    {<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:blue">void</span> CreateInstance(<span style="color:#2b91af">IntPtr</span> pUnkOuter, <span style="color:blue">ref</span><br>                <span style="color:#2b91af">Guid</span> riid, <span style="color:blue">out</span><br>                <span style="color:#2b91af">IntPtr</span> ppvObject);<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">}<br>                </span></p>
<pre><code>&amp;nbsp;
</code></pre><p><span style="font-family:新宋体; font-size:10pt">[<span style="color:#2b91af">ComVisible</span>(<span style="color:blue">true</span>)]<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:blue">public</span><br>                <span style="color:blue">class</span><br>                <span style="color:#2b91af">ClassFactory</span> : <span style="color:#2b91af">IClassFactory<br>                </span></span></p>
<p><span style="font-family:新宋体; font-size:10pt">    {<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><span style="color:blue">        #region</span> IClassFactory Implementations<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt"><br>                <span style="color:blue">public</span><br>                <span style="color:blue">void</span> CreateInstance(<span style="color:#2b91af">IntPtr</span> pUnkOuter, <span style="color:blue">ref</span><br>                <span style="color:#2b91af">Guid</span> riid, <span style="color:blue">out</span><br>                <span style="color:#2b91af">IntPtr</span> ppvObject)<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">        {<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">            ppvObject = <span style="color:#2b91af">Marshal</span>.GetComInterfaceForObject(<span style="color:blue">new</span><br>                <span style="color:#2b91af">MyImageProtocol</span>(), <span style="color:blue">typeof</span>(<span style="color:#2b91af">IInternetProtocolInfo</span>));<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">        }<br>                </span></p>
<p><span style="color:blue; font-family:新宋体; font-size:10pt">        #endregion<br>                </span></p>
<p><span style="font-family:新宋体; font-size:10pt">}<br>                </span></p>
<pre><code>&amp;nbsp;
</code></pre><p>一下至于<strong>IInternetProtocol，IInternetProtocolRoot，IInternetProtocolInfo</strong>三个接口实现，大家可以参考上面提到的<a href="http://www.cnblogs.com/volnet/archive/2008/03/28/About_Asynchronous_Pluggable_Protocols.html" target="_blank" rel="noopener">http://www.cnblogs.com/volnet/archive/2008/03/28/About_Asynchronous_Pluggable_Protocols.html</a>这篇文章。不过要注意的就是这个实现的第二个协议似乎有bug，在实验一次后，可能将IE搞崩溃了，所以实验时要谨慎，不行就用regasm /u命令将dll注销了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/03/28/浏览器扩展系列————异步可插入协议（pluggable-protocol）的实现/" data-id="cjs7p2ww6000ong5mivy79b5g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-浏览器扩展系列————给MSTHML添加内置脚本对象【包括自定义事件】" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/03/02/浏览器扩展系列————给MSTHML添加内置脚本对象【包括自定义事件】/" class="article-date">
  <time datetime="2009-03-02T05:35:00.000Z" itemprop="datePublished">2009-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/03/02/浏览器扩展系列————给MSTHML添加内置脚本对象【包括自定义事件】/">浏览器扩展系列————给MSTHML添加内置脚本对象【包括自定义事件】</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-size:12.0pt;font-family:宋体;mso-ascii-font-family:
Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">使用场合：</span><span lang="EN-US" style="font-size:12.0pt">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US"><span style="mso-tab-count:1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">在程序中使用</span><span lang="EN-US">WebBrowser</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">或相关的控件如：</span><span lang="EN-US">axWebBrowser</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">等。打开本地的</span><span lang="EN-US">html</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">文件时，可以在</span><span lang="EN-US">html</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">的脚本中使用自己在</span><span lang="EN-US">.net</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">中定义的类，实现与</span><span lang="EN-US">Internet<br>Explorer server</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">的互操作。此外也可以在充分利用</span><span lang="EN-US">html</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">在设计界面方面高效，简单的同时，也可以实现一些复杂的特性。</span></p>
<p><span style="font-size:12.0pt;font-family:宋体;mso-ascii-font-family:
Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">实现：</span><span lang="EN-US" style="font-size:12.0pt">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<font color="#0000FF" face="新宋体" size="3"><span style="font-size: 13px;"><br></span></font><br><font color="#0000FF" face="新宋体" size="3"><div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span id="Code_Closed_Text_133128" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_133128" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">class</span><span style="color: #000000;">&nbsp;ScriptEvent<br><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">System.__ComObject&nbsp;对象</span><span style="color: #008000;"><br><br></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">private</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;eventObject;<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;EventObect<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">get</span><span style="color: #000000;">&nbsp;{&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">this</span><span style="color: #000000;">.eventObject;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">set</span><span style="color: #000000;">&nbsp;{&nbsp;</span><span style="color: #0000FF;">this</span><span style="color: #000000;">.eventObject&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;value;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;Execute()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">if</span><span style="color: #000000;">&nbsp;(</span><span style="color: #0000FF;">null</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">==</span><span style="color: #000000;">&nbsp;eventObject)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">null</span><span style="color: #000000;">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">JScript.dll中FunctionInstance接口的Guid</span><span style="color: #008000;"><br><br></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Guid&nbsp;fun_gid&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;Guid(</span><span style="color: #800000;">“</span><span style="color: #800000;">{3EEF9758-35FC-11D1-8CE4-00C04FC2B093}</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;functionInstance&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;Type.GetTypeFromCLSID(fun_gid);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;rev;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rev&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;functionInstance.InvokeMember(</span><span style="color: #800000;">“</span><span style="color: #800000;">call</span><span style="color: #800000;">“</span><span style="color: #000000;">,&nbsp;BindingFlags.InvokeMethod&nbsp;</span><span style="color: #000000;">|</span><span style="color: #000000;">&nbsp;BindingFlags.NonPublic,&nbsp;</span><span style="color: #0000FF;">null</span><span style="color: #000000;">,&nbsp;eventObject,&nbsp;</span><span style="color: #0000FF;">null</span><span style="color: #000000;">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;rev;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span></span></div><br></font>

<p>&nbsp;</p>
<p><span lang="EN-US">ScriptEvent</span><span style="font-family:
宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri;
mso-hansi-theme-font:minor-latin">类实现了对脚本事件的封装。</span></p>
<p><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">具体使用如下：</span></p>
<font face="新宋体" size="3"><span style="font-size: 13px;"><br></span></font><br><font face="新宋体" size="3"><div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span id="Code_Closed_Text_133138" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_133138" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000;">[ComVisibleAttribute(</span><span style="color: #0000FF;">true</span><span style="color: #000000;">)]<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">class</span><span style="color: #000000;">&nbsp;ScriptObject<br><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">private</span><span style="color: #000000;">&nbsp;Window&nbsp;window;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">private</span><span style="color: #000000;">&nbsp;ScriptEvent&nbsp;onClickEvent;<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;ScriptObject(Window&nbsp;window)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">this</span><span style="color: #000000;">.window&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;window;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onClickEvent&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;ScriptEvent();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">string</span><span style="color: #000000;">&nbsp;WindowTitle<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">get</span><span style="color: #000000;">&nbsp;{&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;window.Title;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">double</span><span style="color: #000000;">&nbsp;Add2(</span><span style="color: #0000FF;">double</span><span style="color: #000000;">&nbsp;num1,&nbsp;</span><span style="color: #0000FF;">double</span><span style="color: #000000;">&nbsp;num2)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;num1&nbsp;</span><span style="color: #000000;">+</span><span style="color: #000000;">&nbsp;num2;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;onClick<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">get</span><span style="color: #000000;">&nbsp;{&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;onClickEvent.EventObect;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">set</span><span style="color: #000000;">&nbsp;{&nbsp;onClickEvent.EventObect&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;value;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">void</span><span style="color: #000000;">&nbsp;OnClick()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onClickEvent.Execute();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span></span></div><br></font>

<p>&nbsp;</p>
<h1 id="lt-span-lang-”EN-US”-style-”font-size-10-0pt-mso-bidi-font-size"><a href="#lt-span-lang-”EN-US”-style-”font-size-10-0pt-mso-bidi-font-size" class="headerlink" title="&lt;span lang=”EN-US” style=”font-size:10.0pt;mso-bidi-font-size:"></a>&lt;span lang=”EN-US” style=”font-size:10.0pt;mso-bidi-font-size:</h1><p>18.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:<br>&quot;Times New Roman&quot;;color:#010001;font-weight:normal;mso-bidi-font-weight:bold;<br>mso-no-proof:yes”&gt;onClick<span style="font-size:10.0pt;mso-bidi-font-size:
18.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:
&quot;Times New Roman&quot;;color:#010001;font-weight:normal;mso-bidi-font-weight:bold;
mso-no-proof:yes">属性对应与<span lang="EN-US">Javascript</span>脚本中</span><span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:18.0pt;font-family:新宋体;
mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:#2B91AF;mso-no-proof:yes">ScriptObject</span><span style="font-size:10.0pt;
mso-bidi-font-size:18.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:#010001;font-weight:normal;
mso-bidi-font-weight:bold;mso-no-proof:yes">类的<span lang="EN-US">onClick</span>事件。在脚本中可以把一个<span lang="EN-US">function</span>实例赋给此类的<span lang="EN-US">onClick</span>属性。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">因为在</span><span lang="EN-US">javascript</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">中事件并不等同于</span><span lang="EN-US">.net</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">中的事件，具体来说就是</span><span lang="EN-US">javascript</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin">中不允许绑定多个事件，所以可以一个事件实现为一个函数对象，通过用</span><span lang="EN-US">com viewer</span><span style="font-family:宋体;mso-ascii-font-family:
Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">查看</span><span lang="EN-US">System32</span><span style="font-family:宋体;mso-ascii-font-family:
Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">下的</span><span lang="EN-US">Jscript.dll</span><span style="font-family:宋体;mso-ascii-font-family:
Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">可以看到，此对象对应于其中的</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:green;mso-no-proof:yes">FunctionInstance</span><span style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:black;mso-themecolor:text1;
mso-no-proof:yes">接口，所以在此就使用了反射构造了这个接口，然后调用其真正的脚本函数。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:black;mso-themecolor:text1;
mso-no-proof:yes">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:black;mso-themecolor:text1;
mso-ansi-language:EN-US;mso-fareast-language:ZH-CN;mso-bidi-language:AR-SA;
mso-no-proof:yes">具体代码下载<a href="http://files.cnblogs.com/chinese-zmm/ScriptObjectDemo.rar" target="_blank" rel="noopener">http://files.cnblogs.com/chinese-zmm/ScriptObjectDemo.rar</a>。</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/03/02/浏览器扩展系列————给MSTHML添加内置脚本对象【包括自定义事件】/" data-id="cjs7p2wvu000mng5mc03uo5jp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-浏览器扩展系列————在WPF中定制WebBrowser快捷菜单" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/02/23/浏览器扩展系列————在WPF中定制WebBrowser快捷菜单/" class="article-date">
  <time datetime="2009-02-23T04:44:00.000Z" itemprop="datePublished">2009-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/02/23/浏览器扩展系列————在WPF中定制WebBrowser快捷菜单/">浏览器扩展系列————在WPF中定制WebBrowser快捷菜单</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">关于如何定制菜单可以参考</span><span lang="EN-US">codeproject</span><span style="font-family:宋体;mso-ascii-font-family:
Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">上的这篇文章：</span><span lang="EN-US"><a href="http://www.codeproject.com/KB/books/0764549146_8.aspx?fid=13574&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=26#xx0xx" target="_blank" rel="noopener">http://www.codeproject.com/KB/books/0764549146_8.aspx?fid=13574&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;fr=26#xx0xx</a></span></p>
<p><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin">本文主要讲述如何在这篇文章中的</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:#010001;mso-font-kerning:0pt;
mso-no-proof:yes">ShowContextMenu</span><span style="font-size:10.0pt;
font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:
&quot;Times New Roman&quot;;color:#010001;mso-font-kerning:0pt;mso-no-proof:yes">方法中弹出自己的ContextMenu。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:
&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;color:#010001;
mso-font-kerning:0pt;mso-no-proof:yes">先来看看在<span lang="EN-US">WinForm</span>中是如何实现的：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<font color="#0000FF" face="'Courier New'" size="3"><span style="font-size: 12px;"><br></span></font><br><font color="#0000FF" face="'Courier New'" size="3"><div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span id="Code_Closed_Text_123703" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_123703" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">void</span><span style="color: #000000;">&nbsp;ShowContextMenu(<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsHtmlCustomization.ContextMenuTarget&nbsp;dwContext,<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">ref</span><span style="color: #000000;">&nbsp;MsHtmlCustomization.POINT&nbsp;pPoint,<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsHtmlCustomization.IOleCommandTarget&nbsp;pCommandTarget,<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;HTMLTagElement)<br><br>{<br><br>&nbsp;&nbsp;Point&nbsp;p&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;Point(pPoint.x,&nbsp;pPoint.y);<br><br>&nbsp;&nbsp;p&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;PointToClient(p);<br><br>&nbsp;&nbsp;myCustomContextMenu.Show(</span><span style="color: #0000FF;">this</span><span style="color: #000000;">,&nbsp;p);&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">myCustomContextMenu是一个System.Windows.Forms.ContextMenu对象。</span><span style="color: #008000;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;&nbsp;</span><span style="color: #0000FF;">const</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;Ok&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br><br>&nbsp;&nbsp;</span><span style="color: #0000FF;">throw</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;COMException(</span><span style="color: #800000;">“”</span><span style="color: #000000;">,&nbsp;Ok);&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;return&nbsp;HRESULT&nbsp;=&nbsp;S_OK,&nbsp;so&nbsp;MsHtml<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;doesn&#8217;t&nbsp;display&nbsp;its&nbsp;own&nbsp;menu</span><span style="color: #008000;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;<br><br></span></span></div><br></font>

<p>&nbsp;</p>
<p><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin;
mso-ansi-language:CS">先来看看网上一般的实现方法：</span><span lang="CS" style="mso-ansi-language:
CS">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="CS" style="font-size:10.0pt;font-family:新宋体;
mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:black;mso-themecolor:text1;mso-font-kerning:0pt;mso-ansi-language:CS;
mso-no-proof:yes">myHostBrowser.ContextMenu.PlacementTarget = this;</span><span lang="CS" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:#00B050;mso-font-kerning:0pt;
mso-ansi-language:CS;mso-no-proof:yes">//this</span><span style="font-size:
10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:
&quot;Times New Roman&quot;;color:#00B050;mso-font-kerning:0pt;mso-ansi-language:CS;
mso-no-proof:yes">即自己的<span lang="CS">Windows</span>对象，它实现了<span lang="CS">IDocHostUIHandler</span>接口。</span><span lang="CS" style="mso-ansi-language:CS">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="CS" style="font-size:10.0pt;font-family:新宋体;
mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:black;mso-themecolor:text1;mso-font-kerning:0pt;mso-ansi-language:CS;
mso-no-proof:yes">myHostBrowser.ContextMenu.IsOpen = true;&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin;
color:black;mso-themecolor:text1;mso-ansi-language:CS">通过此方法可以实现自己控制弹出菜单，比如在某个控件上左击弹出快捷菜单的功能。但是针对这里的</span><span lang="CS" style="color:black;mso-themecolor:text1;mso-ansi-language:CS">WebBrowser</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;
mso-ansi-language:CS">控件来说情况就有些不同了，应为</span><span lang="CS" style="color:black;
mso-themecolor:text1;mso-ansi-language:CS">WebBrowser</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;
mso-ansi-language:CS">是对系统的</span><span lang="CS" style="color:black;mso-themecolor:
text1;mso-ansi-language:CS">Internet explorer</span><span style="font-family:
宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri;
mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;mso-ansi-language:
CS">对象进行了封装，使其处理所有的事件，所以介于</span><span lang="CS" style="color:black;mso-themecolor:
text1;mso-ansi-language:CS">WinForm</span><span style="font-family:宋体;
mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri;
mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;mso-ansi-language:
CS">和</span><span lang="CS" style="color:black;mso-themecolor:text1;mso-ansi-language:
CS">WPF</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin;
color:black;mso-themecolor:text1;mso-ansi-language:CS">对</span><span lang="CS" style="color:black;mso-themecolor:text1;mso-ansi-language:CS">ContextMenu</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;
mso-ansi-language:CS">对象实现的不同，比如</span><span lang="CS" style="color:black;
mso-themecolor:text1;mso-ansi-language:CS">WinForm</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;
mso-ansi-language:CS">实现</span><span lang="CS" style="color:black;mso-themecolor:
text1;mso-ansi-language:CS">ContextMenu</span><span style="font-family:宋体;
mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri;
mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;mso-ansi-language:
CS">对象的</span><span lang="CS" style="color:black;mso-themecolor:text1;mso-ansi-language:
CS">Show</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin;
color:black;mso-themecolor:text1;mso-ansi-language:CS">方法时，它把菜单的显示委托给了底层的</span><span lang="CS" style="color:black;mso-themecolor:text1;mso-ansi-language:CS">Usr32</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin;color:black;mso-themecolor:text1;
mso-ansi-language:CS">函数：</span><span lang="CS" style="color:black;mso-themecolor:
text1;mso-ansi-language:CS">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;
color:#0000CC;mso-font-kerning:0pt">[</span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.DllImportAttribute/.ctor(String" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">DllImport</span></a> “System.Runtime.InteropServices.DllImportAttribute.DllImportAttribute(string);”)</span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">(“user32.dll”, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.DllImportAttribute/CharSet:System.Runtime.InteropServices.CharSet" title="CharSet System.Runtime.InteropServices.DllImportAttribute.CharSet;" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">CharSet</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">=</span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.CharSet" title="System.Runtime.InteropServices.CharSet" target="_blank" rel="noopener"><span style="font-size:9.0pt;
font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:0pt">CharSet</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;
color:#0000CC;mso-font-kerning:0pt">.</span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.CharSet/Auto" title="CharSet System.Runtime.InteropServices.CharSet.Auto;" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">Auto</span></a></span><span lang="EN-US" style="font-size:
9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:
0pt">, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.DllImportAttribute/ExactSpelling:Boolean" title="bool System.Runtime.InteropServices.DllImportAttribute.ExactSpelling;" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">ExactSpelling</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">=true)]&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;
mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:0pt">public static<br>extern </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Boolean" title="System.Boolean" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:
宋体;color:#0000CC;mso-font-kerning:0pt">bool</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt"> </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.SafeNativeMethods/TrackPopupMenuEx(System.Runtime.InteropServices.HandleRef,Int32,Int32,Int32,System.Runtime.InteropServices.HandleRef,System.Windows.Forms.NativeMethods.TPMPARAMS" target="_blank" rel="noopener"><strong><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">TrackPopupMenuEx</span></strong></a>:Boolean)</span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">(</span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.HandleRef" title="System.Runtime.InteropServices.HandleRef" target="_blank" rel="noopener"><span style="font-size:9.0pt;
font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:0pt">HandleRef</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;
color:#0000CC;mso-font-kerning:0pt"> hmenu, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Int32" title="System.Int32" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:
宋体;color:#0000CC;mso-font-kerning:0pt">int</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt"> fuFlags, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Int32" title="System.Int32" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:
宋体;color:#0000CC;mso-font-kerning:0pt">int</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt"> x, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Int32" title="System.Int32" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:
宋体;color:#0000CC;mso-font-kerning:0pt">int</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt"> y, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.Runtime.InteropServices.HandleRef" title="System.Runtime.InteropServices.HandleRef" target="_blank" rel="noopener"><span style="font-size:9.0pt;
font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:0pt">HandleRef</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;
color:#0000CC;mso-font-kerning:0pt"> hwnd, </span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.NativeMethods" target="_blank" rel="noopener"><span style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">NativeMethods</span></a></span><span lang="EN-US" style="font-size:9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;
mso-font-kerning:0pt">.</span><span lang="EN-US"><a href="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://System.Windows.Forms:2.0.0.0:b77a5c561934e089/System.Windows.Forms.NativeMethods.TPMPARAMS" title="System.Windows.Forms.NativeMethods+TPMPARAMS" target="_blank" rel="noopener"><span style="font-size:
9.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:
0pt">TPMPARAMS</span></a></span><span lang="EN-US" style="font-size:9.0pt;
font-family:宋体;mso-bidi-font-family:宋体;color:#0000CC;mso-font-kerning:0pt"><br>tpm);&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="mso-bidi-font-size:10.5pt;font-family:宋体;
mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri;
mso-hansi-theme-font:minor-latin;mso-ansi-language:CS">而</span><span lang="CS" style="mso-bidi-font-size:10.5pt;mso-ansi-language:CS">WPF</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin;
mso-ansi-language:CS">实现的</span><span lang="CS" style="mso-bidi-font-size:10.5pt;
mso-ansi-language:CS">ContextMenu</span><span style="mso-bidi-font-size:10.5pt;
font-family:宋体;mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri;mso-hansi-theme-font:minor-latin;mso-ansi-language:CS">则采用了新的方法，所以在网上可以看到不少讲解利用</span><span lang="CS" style="mso-bidi-font-size:10.5pt;mso-ansi-language:CS">ContextMenu</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:Calibri;
mso-ascii-theme-font:minor-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri;mso-hansi-theme-font:minor-latin;
mso-ansi-language:CS">实现嵌入许多控件的方法，以丰富其功能的文章。</span><span lang="CS" style="mso-bidi-font-size:10.5pt;mso-ansi-language:CS">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="mso-bidi-font-size:10.5pt;font-family:宋体;
mso-ascii-font-family:Calibri;mso-ascii-theme-font:minor-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri;
mso-hansi-theme-font:minor-latin;mso-ansi-language:CS">所以造成的结果就是在</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">ShowContextMenu</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">中弹出</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">WPF</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">的</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">ContextMenu</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">时，第一次可以弹出正确的菜单，但第二次在</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">WebBrowser</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">中右击时菜单会消失，但</span><span lang="CS" style="font-size:9.0pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">ShowContextMenu</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">将不会被触发。而在第三次右击时菜单才会弹出。</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="mso-bidi-font-size:10.5pt;font-family:宋体;
mso-ascii-font-family:&quot;Courier New&quot;;mso-hansi-font-family:&quot;Courier New&quot;;
mso-bidi-font-family:&quot;Courier New&quot;;color:black;mso-font-kerning:0pt;mso-ansi-language:
CS">那我想到的就是将</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:
&quot;Courier New&quot;;mso-fareast-font-family:宋体;color:black;mso-font-kerning:0pt;
mso-ansi-language:CS">WinForm</span><span style="mso-bidi-font-size:10.5pt;
font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;mso-hansi-font-family:&quot;Courier New&quot;;
mso-bidi-font-family:&quot;Courier New&quot;;color:black;mso-font-kerning:0pt;mso-ansi-language:
CS">中的</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;
mso-fareast-font-family:宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:
CS">ContextMenu</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;
mso-ascii-font-family:&quot;Courier New&quot;;mso-hansi-font-family:&quot;Courier New&quot;;
mso-bidi-font-family:&quot;Courier New&quot;;color:black;mso-font-kerning:0pt;mso-ansi-language:
CS">嵌入到</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;
mso-fareast-font-family:宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:
CS">WPF</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:
&quot;Courier New&quot;;mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">中使用，这是只要解决一个问题即可，就是在</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">Show</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">是传入一个</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">Control</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">对象即可，</span></p>
<p><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">参考</span><span lang="CS" style="mso-bidi-font-size:10.5pt;font-family:&quot;Courier New&quot;;mso-fareast-font-family:
宋体;color:black;mso-font-kerning:0pt;mso-ansi-language:CS">MSDN</span><span style="mso-bidi-font-size:10.5pt;font-family:宋体;mso-ascii-font-family:&quot;Courier New&quot;;
mso-hansi-font-family:&quot;Courier New&quot;;mso-bidi-font-family:&quot;Courier New&quot;;
color:black;mso-font-kerning:0pt;mso-ansi-language:CS">文章：<span style="font-family: Arial; font-weight: bold; ">How<br>to: Enable Visual Styles in a Hybrid Application</span></span></p>
<font face="Arial"><strong>
</strong></font><br><font face="Arial"><strong><div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span id="Code_Closed_Text_123728" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_123728" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000;">&nbsp;<br><br>System.Windows.Forms.TextBox&nbsp;tc;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">private</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">void</span><span style="color: #000000;">&nbsp;Window_Loaded(</span><span style="color: #0000FF;">object</span><span style="color: #000000;">&nbsp;sender,&nbsp;RoutedEventArgs&nbsp;e)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Windows.Forms.Application.EnableVisualStyles();<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;Create&nbsp;a&nbsp;WindowsFormsHost&nbsp;element&nbsp;to&nbsp;host<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;the&nbsp;Windows&nbsp;Forms&nbsp;control.</span><span style="color: #008000;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Windows.Forms.Integration.WindowsFormsHost&nbsp;host&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;System.Windows.Forms.Integration.WindowsFormsHost();<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;Create&nbsp;a&nbsp;Windows&nbsp;Forms&nbsp;tab&nbsp;control.</span><span style="color: #008000;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;System.Windows.Forms.TextBox();</span><span style="color: #008000;">//</span><span style="color: #008000;">此TextBox只是为了显示ContextMenu而构造的一个任意对象。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;Assign&nbsp;the&nbsp;Windows&nbsp;Forms&nbsp;tab&nbsp;control&nbsp;as&nbsp;the&nbsp;hosted&nbsp;control.</span><span style="color: #008000;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host.Child&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;tc;<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;Assign&nbsp;the&nbsp;host&nbsp;element&nbsp;to&nbsp;the&nbsp;parent&nbsp;Grid&nbsp;element.</span><span style="color: #008000;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">this</span><span style="color: #000000;">.grid2.Children.Add(host);<br><br></span></span></div>
</strong></font>

<p>&nbsp;</p>
<p><span style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:
&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;
mso-no-proof:yes">而在<strong><span lang="EN-US">ShowContextMenu</span></strong>中则写上：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:10.0pt;font-family:
新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:#010001;mso-font-kerning:0pt;mso-no-proof:yes">System</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;mso-no-proof:yes">.<span style="color:#010001">Windows</span>.<span style="color:#010001">Forms</span>.<span style="color:#2B91AF">ContextMenu</span> <span style="color:#010001">menu</span><br>= <span style="color:blue">new</span> <span style="color:#010001">System</span>.<span style="color:#010001">Windows</span>.<span style="color:#010001">Forms</span>.<span style="color:#2B91AF">ContextMenu</span>();&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size:10.0pt;font-family:
新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:#010001;mso-font-kerning:0pt;mso-no-proof:yes">menu</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;mso-no-proof:yes">.<span style="color:#010001">MenuItems</span>.<span style="color:#010001">Add</span>(<span style="color:blue">new</span> <span style="color:#010001">System</span>.<span style="color:#010001">Windows</span>.<span style="color:#010001">Forms</span>.<span style="color:#2B91AF">MenuItem</span>(<span style="color:#A31515">“Test”</span>));&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size:10.0pt;font-family:
新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:#010001;mso-font-kerning:0pt;mso-no-proof:yes">System</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;mso-no-proof:yes">.<span style="color:#010001">Drawing</span>.<span style="color:#2B91AF">Point</span> <span style="color:#010001">p</span> = <span style="color:blue">new</span> <span style="color:#010001">System</span>.<span style="color:#010001">Drawing</span>.<span style="color:#2B91AF">Point</span>(<span style="color:#010001">ppt</span>.<span style="color:#010001">x</span>, <span style="color:#010001">ppt</span>.<span style="color:#010001">y</span>);&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size:10.0pt;font-family:
新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:#010001;mso-font-kerning:0pt;mso-no-proof:yes">p</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;mso-no-proof:yes"><br>= <span style="color:#010001">tc</span>.<span style="color:#010001">PointToClient</span>(<span style="color:#010001">p</span>);&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;
mso-hansi-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
color:#010001;mso-font-kerning:0pt;mso-no-proof:yes">menu</span><span lang="EN-US" style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;mso-no-proof:yes">.<span style="color:#010001">Show</span>(<span style="color:#010001">tc</span>, <span style="color:#010001">p</span>);&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size:10.0pt;font-family:新宋体;mso-hansi-font-family:
&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;mso-font-kerning:0pt;
mso-no-proof:yes">即可显示自己的定制的<span lang="EN-US">ContextMenu</span>。</span><span lang="CS" style="mso-bidi-font-size:10.5pt;mso-ansi-language:CS">&lt;o:p&gt;&lt;/o:p&gt;</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/02/23/浏览器扩展系列————在WPF中定制WebBrowser快捷菜单/" data-id="cjs7p2ww3000nng5mhgojd1ko" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-WPF中Dependency属性设置顺序的心得" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/02/10/WPF中Dependency属性设置顺序的心得/" class="article-date">
  <time datetime="2009-02-10T09:51:00.000Z" itemprop="datePublished">2009-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/02/10/WPF中Dependency属性设置顺序的心得/">WPF中Dependency属性设置顺序的心得</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天在学习WPF依赖属性的时候做了一个很经典的例子，即通过XMAL中的Trigger来改变按钮的前景色。具体代码如下：</p>
<p>&#160;</p>
<p>&#160;</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_173859">Code</span><span id="Code_Open_Text_173859" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000">&lt;</span><span style="color: #000000">Button</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OK<br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Button.Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Style&#160;TargetType</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">{x:Type&#160;Button}</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Style.Triggers</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Trigger&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">IsMouseOver</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">True</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Setter&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Foreground</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Blue</span><span style="color: #800000">“</span><span style="color: #000000">&gt;&lt;/</span><span style="color: #000000">Setter</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Trigger</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Style.Triggers</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Button.Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br></span><span style="color: #000000">&lt;/</span><span style="color: #000000">Button</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br></span></span></div>

<p>&#160;</p>
<p>可以很好的实现，将鼠标移至按钮上，然后按钮的前景色变为蓝色的功能。</p>
<p>但是尝试给此按钮设置一个Foreground属性，代码：</p>
<p>&#160;</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_172117">Code</span><span id="Code_Open_Text_172117" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000">&lt;</span><span style="color: #000000">Button&#160;&#160;Foreground</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Black</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OK<br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Button.Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Style&#160;TargetType</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">{x:Type&#160;Button}</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Style.Triggers</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Trigger&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">IsMouseOver</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">True</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Setter&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Foreground</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Blue</span><span style="color: #800000">“</span><span style="color: #000000">&gt;&lt;/</span><span style="color: #000000">Setter</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Trigger</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Style.Triggers</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Button.Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Button</span></span></div>

<p>&#160;</p>
<p>则使Trigger设置前者色的作用失效了。于是这便使我联想到这几天看到的一篇Dependency属性计算顺序的文章</p>
<p>（<a href="http://www.cnblogs.com/YilingLai/archive/2006/12/25/602889.html" target="_blank" rel="noopener">http://www.cnblogs.com/YilingLai/archive/2006/12/25/602889.html</a>）</p>
<p>原来在第一步计算基础值的时，系统是按照下面的优先级来计算Dependency属性的值的：</p>
<p>&#160;</p>
<p>&#160;</p>
<p>&#160;1、Local Value &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</p>
<p>2、Style Triggers &#160; &#160; &#160; &#160; &#160; &#160; &#160;</p>
<p>3、Template Triggers &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;</p>
<p>4、Style Setters&#160;</p>
<p>5、Theme Style Triggers &#160; &#160;</p>
<p>6、Theme Style Setters &#160; &#160;&#160;</p>
<p>7、Property Value Inheritance &#160; &#160; &#160;</p>
<p>8、Default Value</p>
<p>因为<span style="color: #ff0000"><span style="color: #ff0000">Foreground=”Black”<span style="color: #000000">属于Local Value，比Style Triggers的优先级要高，所以在计算过程中</span></span></span></p>
<p>它掩盖了Style Triggers对Foreground属性值的作用。</p>
<p>那么既需要设置Foreground同时也需要通过设置Trigger来改变它怎么做呢？</p>
<p>答案就是如下面代码所示：</p>
<p>&#160;</p>
<p>&#160;</p>
<div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_173533">Code</span><span id="Code_Open_Text_173533" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000">&lt;</span><span style="color: #000000">Window.Resources</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Style&#160;TargetType</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">{x:Type&#160;Button}</span><span style="color: #800000">“</span><span style="color: #000000">&#160;x:Key</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">changeColorStyle</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Style.Triggers</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Trigger&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">IsMouseOver</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">True</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Setter&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Foreground</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Blue</span><span style="color: #800000">“</span><span style="color: #000000">&gt;&lt;/</span><span style="color: #000000">Setter</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Trigger</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Style.Triggers</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Setter&#160;Property</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Foreground</span><span style="color: #800000">“</span><span style="color: #000000">&#160;Value</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">Black</span><span style="color: #800000">“</span><span style="color: #000000">&gt;&lt;/</span><span style="color: #000000">Setter</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Style</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Window.Resources</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">StackPanel</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;</span><span style="color: #000000">Button&#160;Style</span><span style="color: #000000">=</span><span style="color: #800000">“</span><span style="color: #800000">{StaticResource&#160;changeColorStyle}</span><span style="color: #800000">“</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OK<br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">Button</span><span style="color: #000000">&gt;</span><span style="color: #000000"><br><br>&#160;&#160;&#160;&#160;</span><span style="color: #000000">&lt;/</span><span style="color: #000000">StackPanel</span></span></div>

<p>&#160;</p>
<p>将Style提取到Window.Resources中，然后使此Button引用此资源。</p>
<p>因为在计算基础值的顺序时,Style Triggers排在第二，而Style Setter则排在第四的位置上。</p>
<p>&#160;</p>
<p><span style="font-size: 13px"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><span class="cnblogs_code_Collapse" id="Code_Closed_Text_171751" style="display: none">Code</span></span>&#160;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/02/10/WPF中Dependency属性设置顺序的心得/" data-id="cjs7p2wvg0008ng5mf72loe89" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-muder的课件-更新中" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2008/04/23/muder的课件-更新中/" class="article-date">
  <time datetime="2008-04-23T10:00:00.000Z" itemprop="datePublished">2008-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/04/23/muder的课件-更新中/">muder的课件(更新中)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>密码见群邮箱</p>
<p>chapter0-4 part1：</p>
<p><a href="http://www.cnblogs.com/Files/chinese-zmm/Chapter%200-4.part1.rar" target="_blank" rel="noopener">http://www.cnblogs.com/Files/chinese-zmm/Chapter%200-4.part1.rar</a></p>
<p>chapter0-4 part2：</p>
<p><a href="http://www.cnblogs.com/Files/chinese-zmm/Chapter%200-4.part1.rar" target="_blank" rel="noopener">http://www.cnblogs.com/Files/chinese-zmm/Chapter%200-4.part2.rar</a></p>
<p>chapter0-4 part3：</p>
<p><a href="http://www.cnblogs.com/Files/chinese-zmm/Chapter%200-4.part1.rar" target="_blank" rel="noopener">http://www.cnblogs.com/Files/chinese-zmm/Chapter%200-4.part3.rar</a></p>
<p>待续。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2008/04/23/muder的课件-更新中/" data-id="cjs7p2wvf0007ng5mr807n8ef" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-关于随机数的讨论" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2008/01/08/关于随机数的讨论/" class="article-date">
  <time datetime="2008-01-08T04:55:00.000Z" itemprop="datePublished">2008-01-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/01/08/关于随机数的讨论/">关于随机数的讨论</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>写得有点乱，大家耐心点看吧，这都是我得&#8220;谬论&#8221;。 </p>
<p>c中的rand（）函数，能返回0到max int间的一个随机数，我认为在包含这个函数的库中，应该有一个静态变量保存它上一次得到的随机数，然后用这个数得到它的下一个随机数。</p>
<p>而且我认为一个产生随机数的算法，当它确定后，这个随机数序列就应该已经确定了，假设这个随机数序列是1到10的：1，3，5，2，6，9，7，10，4，8。这是一定的即通过给定一个种子，那个随机数的算法利用这个种子如4</p>
<p>则它一定得到下一个随机数8，我想这应该是确定的。</p>
<p>再<br>说说它的伪随机性，如果把真实的随机数算法看成是一个股子，那么如果投出一个4点，那个再投的时候它应该有6中可能，且概率相等。如果投6次，那么应该有<br>6的6此方中组合，即可以认为是6的6次方个随机序列，那个一个随机数算法器相当于，取了这么多随机数序列中的一个。那么从整体上看，再加上你并不能预测<br>一个数的下个个随机数是什么，所以可以认为这个随机序列是随机的的。</p>
<p>再谈谈一个随机数序列的一些特性，就是我认为不可能在两个不同的数上<br>作用这个随机数发生器那么不可能，得到一个相同的数，而且我认为这个序列应该属于离散上的一种特殊的格：链，它具体的定义是对于集合中的任意两个数l1，<br>l2，都有l1&lt; l2,或l2 &lt; l1。这里的小于号表示一种关系。如果用c＋＋的一个成员函数来表示就是，l2.rand(l2)</p>
<p>&nbsp;== l1，当然这个不一定是一种直接的关系，还可能通过一些间接的数如 l3.rand(l2.rand(l2)) == l1;</p>
<p>可以用一个图表来表示</p>
<p>9</p>
<p>/</p>
<p>6</p>
<p>/</p>
<p>2</p>
<p>/</p>
<p>3</p>
<p>/</p>
<p>5</p>
<p>/</p>
<p>1</p>
<p>/</p>
<p>7</p>
<p>/</p>
<p>10</p>
<p>/</p>
<p>4</p>
<p>/</p>
<p>8</p>
<p>如9&gt;8, 9&gt; 6, 4&gt; 8等。</p>
<p>而不可能存在叉就是有，有两个数指向一个数，就是</p>
<p>9</p>
<p>/</p>
<p>6</p>
<p>/</p>
<p>2</p>
<p>/</p>
<p>5&nbsp;&nbsp; 3</p>
<p>/&nbsp;&nbsp; /</p>
<p>1</p>
<p>/</p>
<p>7</p>
<p>/</p>
<p>10</p>
<p>/</p>
<p>4</p>
<p>/</p>
<p>8</p>
<p>5 &gt;1,3 &gt; 1,那么谁指向3呢，如是8以外的数指向它（8是最后的数，一会再讨论），如6那么这个6就有两个指向了2和3，不符合唯一性了。</p>
<p>而如果是8呢？那么就形成了一个3， 1， 7，10，4，8，3的小循环，排除了其他元素所以是不可能的。</p>
<p>&nbsp;再说一下关于存在重复序列的问题，即如果有序列中4，4这个序列，4。rand（4） ＝＝ 4，就会出现4循环永远是4了。</p>
<p>那么再回头看一下，再把回到开始的假设随机数发生器是rand（）函数，能返回0到max int间的一个随机数，</p>
<p>那么它里面就不能有重复的序列，即对于一个数来说它的下一个数一定是一个非自身的数，那么和实际的随机数来说不是就有一个缺陷了吗？</p>
<p>而<br>我昨天说用rand（）%10 +<br>1,得到一个1到10的随机序列，它的间隔比较大，其实我的意思是重它的序列中你可以看到重复数的序列。这是因为如果在rand（）的随机数序列中如果存<br>在45，55，这个子序列，那么就得到了6，6序列有重复的子序列，而如果是35，78，就得到了6，9，可以看出6的下一个数在这种情况下是不确定的这<br>当然是很好的。但是我想如果用直接打印rand（）序列就不可能再出现相同的子序列。</p>
<p>那么会不会是rand（）能产生更大的随机数然后在缩小到现在的这个去间呢，就像上面用rand（）来生成一个1到10的随机序列，象这种比较好的随机序列。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2008/01/08/关于随机数的讨论/" data-id="cjs7p2wvq000hng5mzn9hkpi4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">八月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">七月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">一月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">十二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">十月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">八月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">五月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">四月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">一月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">十月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">八月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">四月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">三月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">二月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/04/">四月 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">一月 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/15/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/02/15/tutoial-of-hexo/">利用Hexo+Github搭建个人免费博客</a>
          </li>
        
          <li>
            <a href="/2016/05/30/QT项目性能调优小记/">QT项目性能调优小记</a>
          </li>
        
          <li>
            <a href="/2015/08/28/Windows下HG服务器的搭建/">Windows下HG服务器的搭建</a>
          </li>
        
          <li>
            <a href="/2011/08/10/svn-tp-link-花生壳搭建外网服务器/">svn+tp-link+花生壳搭建外网服务器</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 三闻鱼<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>