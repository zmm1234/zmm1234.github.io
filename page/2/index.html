<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Submarine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="record tech &amp; life">
<meta property="og:type" content="website">
<meta property="og:title" content="Submarine">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Submarine">
<meta property="og:description" content="record tech &amp; life">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Submarine">
<meta name="twitter:description" content="record tech &amp; life">
  
    <link rel="alternate" href="/atom.xml" title="Submarine" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Submarine</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">chinese submarine</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-QT中拖拽的实现（附示例代码）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/10/10/QT中拖拽的实现（附示例代码）/" class="article-date">
  <time datetime="2010-10-10T10:22:00.000Z" itemprop="datePublished">2010-10-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/10/10/QT中拖拽的实现（附示例代码）/">QT中拖拽的实现（附示例代码）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>QT中的Drag and Drop的详细介绍参见：<a href="http://doc.qt.nokia.com/4.0/dnd.html" target="_blank" rel="noopener">http://doc.qt.nokia.com/4.0/dnd.html</a></p>
<p>下面主要介绍一下Drag and Drop的Demo(<a href="http://u.115.com/file/f5a4c1ed9c" target="_blank" rel="noopener">下载</a>)，先附上一份效果图：</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/QT_F546/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87_2.png" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/QT_F546/%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87_thumb.png" alt="未命名图片" title="未命名图片"></a> </p>
<p>&nbsp;</p>
<p>这是一个拼图的Demo，左边是原图，右边是打散的图，拖动小方格可以实现不同的方格内的图片交换，此外程序还支持手动拖入原图片。</p>
<p>代码中主要的类是一个<strong>DragWidget</strong>。</p>
<p>它实现了以下几个方法。</p>
<ul>
<li>void dragEnterEvent(QDragEnterEvent <em>dragEvent);<br>void dragLeaveEvent(QDragLeaveEvent </em>dragEvent);<br>void dragMoveEvent(QDragMoveEvent <em>dragEvent);<br>void dropEvent(QDropEvent </em>dragEvent);<br>void mousePressEvent(QMouseEvent *mouseEvent);</li>
</ul>
<p>Drag执行的流程是： </p>
<p>Drag是从drag-&gt;exec()开始的，此时将开启进入一个新的事件循环，然后在拖动的过程中会在下面三个事件中交替： </p>
<p>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/QT_F546/DragCircle_2.png" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/QT_F546/DragCircle_thumb.png" alt="DragCircle" title="DragCircle"></a></p>
<p>其中DragEnter是有拖动进入该Widget时触发的，对应的DragLeave则是拖动离开时触发的，而DragMove就是鼠标拖动的时候触发的。</p>
<p>最后当鼠标释放的时候将触发dragEvent，此时将决定拖拽的结果。</p>
<p>回头看一下Drag的触发，和大多数系统一样，一个Drag可能是从控件外触发的，即将外部的数据拖入，也可以是从控件内部触发，即手动生成一个QDrag对象。在示例代码中，这两种方式都会有接触。</p>
<p>&nbsp;</p>
<p>再聊聊拖动的机制，其实拖动就是将一处的数据移动或者复制到另外一处，在QT中拖动所承载的数据使用QMimeData表示的，它可以用来表示许多<strong>Mime Type</strong>的集合。一个Mime Type即有format和data两部分组成，format即指示了如何解析对应的data。更详细的定义可以参考：<a href="http://en.wikipedia.org/wiki/MIME" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/MIME</a>。</p>
<p>&nbsp;</p>
<p>最后简单地介绍一些重要的代码片段</p>
<p>DragWidget中使用三个数组来表示对于的数据：</p>
<blockquote>
<p>QList&lt;QPixmap&gt; mImgList;&nbsp;&nbsp; <span style="color: #ff0000;">//image per block<br></span>QList&lt;QRect&gt;&nbsp;&nbsp; mPieceList; <span style="color: #ff0000;">//position per block</span><br>QList&lt;QPoint&gt;&nbsp; mPosList;&nbsp;&nbsp; <span style="color: #ff0000;">//correct per image</span></p>
</blockquote>
<p>void mousePressEvent(QMouseEvent *mouseEvent);</p>
<p>&nbsp;</p>
<div class="cnblogs_Highlighter"><br><pre class="brush:cpp;collapse:true;">QPoint point = mPosList[find];<br>QPixmap image = mImgList[find];<br>QRect rect = mHighlightRect;<br>mPieceList.removeAt(find);//.remove(mHighlightRect);<br>mImgList.removeAt(find);<br>mPosList.removeAt(find);<br>if (checkMatch(rect, point))<br>     –mInPlace;<br>QByteArray data;<br>QDataStream stream(&amp;data, QIODevice::WriteOnly);<br>stream &lt;&lt; image &lt;&lt; point;<br>QDrag<em> drag = new QDrag(this);<br>QMimeData</em> mimeData = new QMimeData;<br>mimeData-&gt;setData(“application/x-dragitemdata”, data);<br>drag-&gt;setMimeData(mimeData);<br>drag-&gt;setPixmap(image);<br>drag-&gt;setHotSpot(mouseEvent-&gt;pos() - mHighlightRect.topLeft());<br>if (0 == drag-&gt;exec(Qt::MoveAction)){<br></pre><br></div>

<p>&nbsp;</p>
<p>在mousePress的时候开启一个Drag，定义一个自己的Mime Type-&gt;&ldquo;application/x-dragitemdata&rdquo;，将需要的数据打包进去。 </p>
<p>void dropEvent(QDropEvent *dragEvent);</p>
<div class="cnblogs_Highlighter"><br><pre class="brush:cpp;collapse:true;">if (dragEvent-&gt;mimeData()-&gt;hasFormat(“application/x-dragitemdata”))<br>    {<br>        QRect targetRect = targetBlock(dragEvent-&gt;pos());<br>        QByteArray data = dragEvent-&gt;mimeData()-&gt;data(“application/x-dragitemdata”);<br>        QDataStream stream(data);<br>        QPixmap image;<br>        QPoint point;<br>        stream &gt;&gt; image &gt;&gt; point;<br>        mImgList.append(image);<br>        mPieceList.append(targetRect);<br>        mPosList.append(point);<br>        if (checkMatch(targetRect, point))<br>            ++mInPlace;<br></pre><br></div>

<p>&nbsp;</p>
<p>在drop消息中对数据进行解包，并判断是否放置到了合适的位置。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/10/10/QT中拖拽的实现（附示例代码）/" data-id="cjs7p2wv70001ng5mp46lwme5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Tiled-地图编辑器分析（QT平台）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/08/21/Tiled-地图编辑器分析（QT平台）/" class="article-date">
  <time datetime="2010-08-21T01:16:00.000Z" itemprop="datePublished">2010-08-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/21/Tiled-地图编辑器分析（QT平台）/">Tiled 地图编辑器分析（QT平台）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Tiled 是一款地图编辑软件，它的网址是：<a href="http://www.mapeditor.org/" target="_blank" rel="noopener">http://www.mapeditor.org/</a>（ 不过好像要用代理才能访问）。Wiki的网址是：<a href="http://sourceforge.net/apps/mediawiki/tiled/index.php?title=Main_Page" title="Main_Page" target="_blank" rel="noopener">http://sourceforge.net/apps/mediawiki/tiled/index.php?title=Main_Page</a>。它的上一版是用Jave实现，有兴趣的也可以去看一下。</p>
<p>&nbsp;</p>
<h2 id="Tiled现在包含的功能有："><a href="#Tiled现在包含的功能有：" class="headerlink" title="Tiled现在包含的功能有："></a>Tiled现在包含的功能有：</h2><ol>
<li><strong><font color="#000080">General purpose tile map editor with XML-based map format</font></strong>  </li><li>Supports orthogonal and isometric maps  </li><li>Custom objects can be placed with pixel precision  </li><li><strong><font color="#000080">Full undo/redo and copy/paste support</font></strong>  </li><li>Add custom properties to tiles, layers, objects or the map  </li><li>Automatically reloads tilesets when changed externally  </li><li>Resize or offset your tile map later as needed  </li><li>Efficient tile editing tools like stamp and fill brushes  </li><li>Supports input/output plugins to open and save files in custom formats </li>
</ol>
<p>本文将重点描述Tiled的整体结构，以及1, 4功能的实现（本文分析的是它的0.1版）。</p>
<p>&nbsp;</p>
<h2 id="开发环境的搭建"><a href="#开发环境的搭建" class="headerlink" title="开发环境的搭建"></a>开发环境的搭建</h2><p>首先从<a href="http://sourceforge.net/projects/tiled/" target="_blank" rel="noopener">http://sourceforge.net/projects/tiled/</a> 上下载最新的源码。</p>
<p>用<a href="http://qt.nokia.com/products/developer-tools" target="_blank" rel="noopener">Qt Creator</a>打开源码中的pro文件。</p>
<p>下载zlib库，地址：<a href="http://www.zlib.net/" target="_blank" rel="noopener">http://www.zlib.net/</a>。</p>
<p>打开src下面的<strong>src.pro</strong>, 加入对zlib的引用：</p>
<blockquote>
<p>INCLUDEPATH += “D:\Program Files\GnuWin32\include”  </p><p>LIBS += -L”D:\Program Files\GnuWin32\lib” \<br>&nbsp;&nbsp;&nbsp; -lzlib </p>
</blockquote>
<p>点击build，泡杯茶回来便可看到程序的运行画面了，如下所示：  </p><p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/Tiled_81F9/tiled_shotsnap_2.png" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/Tiled_81F9/tiled_shotsnap_thumb.png" alt="tiled_shotsnap" title="tiled_shotsnap"></a>  </p><p><strong>Note：</strong>源代码所在文件夹的路径中不能出现中文，否则编译会出错。</p>
<p>Tiled的使用说明可以参考如下两篇文章：</p>
<p><a href="http://silveiraneto.net/2009/01/11/game-map-edition-using-tiled/" target="_blank" rel="noopener">http://silveiraneto.net/2009/01/11/game-map-edition-using-tiled/</a></p>
<p><a href="http://www.raywenderlich.com/1163/how-to-make-a-tile-based-game-with-cocos2d" target="_blank" rel="noopener">http://www.raywenderlich.com/1163/how-to-make-a-tile-based-game-with-cocos2d</a></p>
<p>&nbsp;</p>
<h2 id="整体结构的介绍"><a href="#整体结构的介绍" class="headerlink" title="整体结构的介绍"></a>整体结构的介绍</h2><p>QT窗口的结构如下所示</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/Tiled_81F9/tiled_view_struct_2.png" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/Tiled_81F9/tiled_view_struct_thumb.png" alt="tiled_view_struct" title="tiled_view_struct"></a> </p>
<p>先说左边三个窗口：</p>
<p>层管理窗口：可以把层次分类进行管理，如建筑物和植物可以定义到不同的层次。</p>
<p>历史管理窗口：可以查看和撤销之前的操作。</p>
<p>色块管理窗口：显示外界导入的tileset，可以添加到客户区中。</p>
<p>这三个窗口利用QT的QDockWidget实现，所以默认具有停靠，移动的功能。</p>
<p>&nbsp;</p>
<p>再说左边的客户区，可以编辑map，这块是利用QT的GraphicsView图形引擎完成的，关于GraphicsView的介绍可以参考：</p>
<p><a href="http://doc.qt.nokia.com/4.6/graphicsview.html" target="_blank" rel="noopener">http://doc.qt.nokia.com/4.6/graphicsview.html</a>，对应到代码中就是MapView。</p>
<p>&nbsp;</p>
<p>下面看一下MainWindow类是如何管理这几个窗口的。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/TiledQT_EC02/Creek_2.jpg" target="_blank" rel="noopener"><img src="http://images.cnblogs.com/cnblogs_com/chinese-zmm/WindowsLiveWriter/TiledQT_EC02/Creek_thumb.jpg" alt="Creek" title="Creek"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/08/21/Tiled-地图编辑器分析（QT平台）/" data-id="cjs7p2wvc0004ng5mdh9y6pbs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-从QDataStream向QByteArray中写入数据时的注意点（QT）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/05/29/从QDataStream向QByteArray中写入数据时的注意点（QT）/" class="article-date">
  <time datetime="2010-05-29T02:19:00.000Z" itemprop="datePublished">2010-05-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/05/29/从QDataStream向QByteArray中写入数据时的注意点（QT）/">从QDataStream向QByteArray中写入数据时的注意点（QT）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近发现从QDataStream向QByteArray中写入数据常常是写不进去的，通过查看QT的源码:</p>
<p>&nbsp;</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('cbfac2d8-c366-48ce-a680-bc72d4ffecee')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><br><div id="cnblogs_code_open_cbfac2d8-c366-48ce-a680-bc72d4ffecee" class="cnblogs_code_hide"><br><pre><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">QDataStream </span><span style="color: #000000;">&amp;</span><span style="color: #0000ff;">operator</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">(QDataStream </span><span style="color: #000000;">&amp;</span><span style="color: #0000ff;">in</span><span style="color: #000000;">, QByteArray </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">ba)<br>{<br>    ba.clear();<br>    quint32 len;<br>    </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> len;<br>    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (len </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0xffffffff</span><span style="color: #000000;">)<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">in</span><span style="color: #000000;">;<br><br>    </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> quint32 Step </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1024</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">1024</span><span style="color: #000000;">;<br>    quint32 allocated </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br><br>    </span><span style="color: #0000ff;">do</span><span style="color: #000000;"> {<br>        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> blockSize </span><span style="color: #000000;">=</span><span style="color: #000000;"> qMin(Step, len </span><span style="color: #000000;">-</span><span style="color: #000000;"> allocated);<br>        ba.resize(allocated </span><span style="color: #000000;">+</span><span style="color: #000000;"> blockSize);<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">in</span><span style="color: #000000;">.readRawData(ba.data() </span><span style="color: #000000;">+</span><span style="color: #000000;"> allocated, blockSize) </span><span style="color: #000000;">!=</span><span style="color: #000000;"> blockSize) {<br>            ba.clear();<br>            </span><span style="color: #0000ff;">in</span><span style="color: #000000;">.setStatus(QDataStream::ReadPastEnd);<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">in</span><span style="color: #000000;">;<br>        }<br>        allocated </span><span style="color: #000000;">+=</span><span style="color: #000000;"> blockSize;<br>    } </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (allocated </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> len);<br><br>    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">in</span><span style="color: #000000;">;<br>}</span></div></pre><br></div><br></div>

<p>&nbsp;</p>
<p>发现原来其中有一句：</p>
<p>&nbsp;</p>
<pre class="brush:cpp">if (in.readRawData(ba.data() + allocated, blockSize) != blockSize) {
</pre>

<p>它检查读入的数据是不是整数个blockSize，如果不是，那么下面它会将QByteArray清空：</p>
<p>&nbsp;</p>
<p><pre class="brush:cpp"> ba.clear();<br></pre></p>
<div></div>

<p>所以如果想从QDataStream读入数据岛QByteArray中，可以采用下面的方法：</p>
<p>&nbsp;</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('2709aad4-16fd-4bda-9a01-9faa7cb0b0f0')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><br><div id="cnblogs_code_open_2709aad4-16fd-4bda-9a01-9faa7cb0b0f0" class="cnblogs_code_hide"><br><pre><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">QDataStream </span><span style="color: #000000;">&amp;</span><span style="color: #0000ff;">operator</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">(QDataStream </span><span style="color: #000000;">&amp;</span><span style="color: #0000ff;">in</span><span style="color: #000000;">, QByteArray </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">ba)<br>{<br>    ba.clear();<br>    quint32 len;<br>    </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> </span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> len;<br>    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (len </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0xffffffff</span><span style="color: #000000;">)<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">in</span><span style="color: #000000;">;<br><br>    </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> quint32 Step </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1024</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">1024</span><span style="color: #000000;">;<br>    quint32 allocated </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br><br>    </span><span style="color: #0000ff;">do</span><span style="color: #000000;"> {<br>        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> blockSize </span><span style="color: #000000;">=</span><span style="color: #000000;"> qMin(Step, len </span><span style="color: #000000;">-</span><span style="color: #000000;"> allocated);<br>        ba.resize(allocated </span><span style="color: #000000;">+</span><span style="color: #000000;"> blockSize);<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">in</span><span style="color: #000000;">.readRawData(ba.data() </span><span style="color: #000000;">+</span><span style="color: #000000;"> allocated, blockSize) </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> blockSize) {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">in</span><span style="color: #000000;">;<br>        }<br>        allocated </span><span style="color: #000000;">+=</span><span style="color: #000000;"> blockSize;<br>    } </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (allocated </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> len);<br><br>    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">in</span><span style="color: #000000;">;<br>}</span></div></pre><br></div><br></div>

<p>&nbsp;</p>
<div></div>

<p>最后回过头来看一下将QByteArray写入QDataStream的方法</p>
<p>&nbsp;</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('80088aa1-2d8a-40d8-9b09-3525e14db84c')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><br><div id="cnblogs_code_open_80088aa1-2d8a-40d8-9b09-3525e14db84c" class="cnblogs_code_hide"><br><pre><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">QDataStream </span><span style="color: #000000;">&amp;</span><span style="color: #0000ff;">operator</span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;">(QDataStream </span><span style="color: #000000;">&amp;</span><span style="color: #0000ff;">out</span><span style="color: #000000;">, </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> QByteArray </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">ba)<br>{<br>    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ba.isNull() </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> </span><span style="color: #0000ff;">out</span><span style="color: #000000;">.version() </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">6</span><span style="color: #000000;">) {<br>        </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;"> (quint32)</span><span style="color: #800080;">0xffffffff</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">out</span><span style="color: #000000;">;<br>    }<br>    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">out</span><span style="color: #000000;">.writeBytes(ba, ba.size());<br>}</span></div></pre><br></div><br></div>

<p>&nbsp;</p>
<p>其实是将QByteArray中所有的数据都写入QDatStream中，并没有扩展QByteArray的大小到blockSize，</p>
<p>所以针对这种情况，我们在使用QDataStream向QByteArray中读写数据的时候，需要手动将QByteArray</p>
<p>扩展到blockSize(1024*1024)大小。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/05/29/从QDataStream向QByteArray中写入数据时的注意点（QT）/" data-id="cjs7p2wvo000fng5mjj12wou6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-如何保持GUI的响应流畅-QT平台" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/05/08/如何保持GUI的响应流畅-QT平台/" class="article-date">
  <time datetime="2010-05-08T03:17:00.000Z" itemprop="datePublished">2010-05-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/05/08/如何保持GUI的响应流畅-QT平台/">如何保持GUI的响应流畅(QT平台)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <pre class="brush: csharp; auto-links: true; collapse: true; first-line: 5; gutter: true; html-script: true; light: true; ruler: true; smart-tabs: true; tab-size: 4; toolbar: true;">&nbsp;</pre>

<h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a><span style="color: #0080ff;">引子</span></h2><p>一般来说耗时较长的操作，分为计算密集型操作和IO密集型操作，对于这两类操作如何提高响应速度呢？ </p>
<p>而从操作的本质上来说，操作又可分为不可分解操作，如在第三方库中耗时较长的操作，以及可分解操作，其中可分解操作又可细分为串行操作和可并行操作，如何针对这几类操作来提高响应速度呢？ </p>
<p>如何将异步的操作，如网络库中异步的读取数据方法，变成同步的操作？ </p>
<p>此外对于多线程，普遍的看法是可以提供程序的运行速度，其实不然，不正确地使用线程常常会使程序变慢，那么在QT中是否可以通过多线程以外的方法来提高响应速度呢？ </p>
<p>下文将一一解答这些问题。 </p>
<p>&nbsp;</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a><span style="color: #0080ff;">正文</span></h2><p>首先什么是对GUI的响应？答：GUI的响应就是系统对于GUI事件的处理速度。 </p>
<p>由于系统处理事件需要一定的时间，所以一般窗口系统都会提供一个事件队列来存储事件。如果把每个事件处理看成一个任务的话，那么事件处理就类似于操作系统对于任务按照优先级进行处理，使得每个任务的平均等待时间最小。那么就可以借鉴一下操作系统中的方法，比如： </p>
<blockquote>
<p>分级，让较长的任务延后执行。 </p>
<p>分时，对于较长的任务，让其执行一段时间后暂停，然后再执行。 </p>
<p>减少每个任务运行的耗时，当然这是最基本的方法。</p>
</blockquote>
<p>&nbsp;</p>
<p>先看第一个分级，当一个事件处理程序知道自己将执行耗时很长的操作时，可以调用<a href="http://doc.trolltech.com/latest/qcoreapplication.html%22%20target=%22_blank#processEvents" target="_blank" rel="noopener">QCoreApplication::processEvents()</a> 方法，等待消息队列中的方法都执行完再执行。当然这是一个最基本的方法，只适用与简单的情况，如果事件队列中的另一程序也调用了该方法则会出现死锁。 </p>
<p>&nbsp;</p>
<p>再看分时，它适用于可分解的操作（包括串行操作和并行操作），只需记录当前任务的执行情况，然后可以再次执行。它的使用流程如下： </p>
<div id="codeSnippetWrapper" style="font-size: 8pt; margin: 20px 0px 10px; overflow: auto; width: 97.5%; cursor: text; direction: ltr; max-height: 200px; line-height: 12pt; font-family: 'Courier New', courier, monospace; background-color: #f4f4f4; text-align: left; border: silver 1px solid; padding: 4px;"><br><div id="codeSnippet" style="font-size: 8pt; overflow: visible; width: 100%; color: black; direction: ltr; line-height: 12pt; font-family: 'Courier New', courier, monospace; background-color: #f4f4f4; text-align: left; border-style: none; padding: 0px;"><br><pre><span id="lnum1" style="color: #606060;">   1:</span> Function EventHandler()</pre><br><!--CRLF--><br><pre><span id="lnum2" style="color: #606060;">   2:</span> {</pre><br><!--CRLF--><br><pre><span id="lnum3" style="color: #606060;">   3:</span>     <span style="color: #008000;">//开始计时</span></pre><br><!--CRLF--><br><pre><span id="lnum4" style="color: #606060;">   4:</span>     While(执行时间 &lt; 用户可接受的响应时间)</pre><br><!--CRLF--><br><pre><span id="lnum5" style="color: #606060;">   5:</span>     {</pre><br><!--CRLF--><br><pre><span id="lnum6" style="color: #606060;">   6:</span>         <span style="color: #008000;">//执行操作</span></pre><br><!--CRLF--><br><pre><span id="lnum7" style="color: #606060;">   7:</span>     }</pre><br><!--CRLF--><br><pre><span id="lnum8" style="color: #606060;">   8:</span>     <span style="color: #008000;">//注册系统空闲事件以继续处理</span></pre><br><!--CRLF--><br><pre><span id="lnum9" style="color: #606060;">   9:</span> }</pre><br><!--CRLF--></div><br></div>

<p>在QT中注册系统空闲事件的方法可以通过QTimer::singleShot(0, this, SLOT(calculate()));将系统空闲信号注册到自己的槽中。或者使用QMetaObject::invokeMethod(this, “calculate”, Qt::QueuedConnection);方法，通过invokeMethod异步的执行某个方法。 </p>
<p>&nbsp;</p>
<p>最后重点看一下如何减少响应的时间，对于数据密集型操作，推荐使用ThreadPool来管理，减少线程上下文切换的时间；而对于IO密集型操作，则自己管理一个thread来实现，而这也是我认为thread最应该使用的情景，即让CPU和外设都处于满负荷运转状态，减少总的操作时间。 </p>
<p>&nbsp;</p>
<p>对于并行操作响应时间的减少，在QT中引入了Qt Concurrent的概念，采用<a href="http://en.wikipedia.org/wiki/MapReduce" target="_blank" rel="noopener">Map/Reduce</a>的方式，具体可以参考QT中的<a href="http://doc.trolltech.com/4.6/threads-qtconcurrent.html" target="_blank" rel="noopener">Concurrent Programming</a>节。 </p>
<p>&nbsp;</p>
<p>最后再解答下如何在QT中将异步操作改成同步操作的方法，这个就属于QT special的内容，一般的读者可以跳过。 </p>
<p>具体的代码如下所示： </p>
<div id="codeSnippetWrapper" style="font-size: 8pt; margin: 20px 0px 10px; overflow: auto; width: 97.5%; cursor: text; direction: ltr; max-height: 200px; line-height: 12pt; font-family: 'Courier New', courier, monospace; background-color: #f4f4f4; text-align: left; border: silver 1px solid; padding: 4px;"><br><div id="codeSnippet" style="font-size: 8pt; overflow: visible; width: 100%; color: black; direction: ltr; line-height: 12pt; font-family: 'Courier New', courier, monospace; background-color: #f4f4f4; text-align: left; border-style: none; padding: 0px;"><br><pre><span id="lnum1" style="color: #606060;">   1:</span> QNetworkAccessManager manager;</pre><br><!--CRLF--><br><pre><span id="lnum2" style="color: #606060;">   2:</span> QEventLoop q;</pre><br><!--CRLF--><br><pre><span id="lnum3" style="color: #606060;">   3:</span> QTimer tT;</pre><br><!--CRLF--><br><pre><span id="lnum4" style="color: #606060;">   4:</span>  </pre><br><!--CRLF--><br><pre><span id="lnum5" style="color: #606060;">   5:</span> tT.setSingleShot(true);</pre><br><!--CRLF--><br><pre><span id="lnum6" style="color: #606060;">   6:</span> connect(&amp;tT, SIGNAL(timeout()), &amp;q, SLOT(quit()));</pre><br><!--CRLF--><br><pre><span id="lnum7" style="color: #606060;">   7:</span> connect(&amp;manager, SIGNAL(finished(QNetworkReply<em>)),</em></pre><br><!--CRLF--><br><pre><span id="lnum8" style="color: #606060;">   8:</span>         &amp;q, SLOT(quit()));</pre><br><!--CRLF--><br><pre><span id="lnum9" style="color: #606060;">   9:</span> QNetworkReply reply = manager.get(QNetworkRequest(QUrl(<span style="color: #006080;">“<a href="http://www.qtcentre.org&quot;" target="_blank" rel="noopener">http://www.qtcentre.org&quot;</a></span>)));</pre><br><!--CRLF--><br><pre><span id="lnum10" style="color: #606060;">  10:</span>  </pre><br><!--CRLF--><br><pre><span id="lnum11" style="color: #606060;">  11:</span> tT.start(5000); <span style="color: #008000;">// 5s timeout</span></pre><br><!--CRLF--><br><pre><span id="lnum12" style="color: #606060;">  12:</span> q.exec();</pre><br><!--CRLF--><br><pre><span id="lnum13" style="color: #606060;">  13:</span>  </pre><br><!--CRLF--><br><pre><span id="lnum14" style="color: #606060;">  14:</span> <span style="color: #0000ff;">if</span>(tT.isActive()){</pre><br><!--CRLF--><br><pre><span id="lnum15" style="color: #606060;">  15:</span>     <span style="color: #008000;">// download complete</span></pre><br><!--CRLF--><br><pre><span id="lnum16" style="color: #606060;">  16:</span>     tT.stop();</pre><br><!--CRLF--><br><pre><span id="lnum17" style="color: #606060;">  17:</span> } <span style="color: #0000ff;">else</span> {</pre><br><!--CRLF--><br><pre><span id="lnum18" style="color: #606060;">  18:</span>     <span style="color: #008000;">// timeout</span></pre><br><!--CRLF--><br><pre><span id="lnum19" style="color: #606060;">  19:</span> }</pre><br><!--CRLF--></div><br></div>

<p>其中主要利用了QEventLoop类，它将创建一个本地的Event loop，然后block，直到接受到finished信号，或者timeout超时信号后才退出，而事件循环则不会被block。 </p>
<p>&nbsp;</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结 "></a><span style="color: #000080;"><span style="color: #0080ff;">总结</span> </span></h2><p>本文分析了影响GUI响应速度的原因，通过类比操作系统对任务的优先级分派方式，探讨了对多种事件类型，提高其响应速度的方法，其中有些方法在其它平台也是通用的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/05/08/如何保持GUI的响应流畅-QT平台/" data-id="cjs7p2wvp000gng5mgcjiaroz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-也谈线程同步变量" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/04/08/也谈线程同步变量/" class="article-date">
  <time datetime="2010-04-08T13:46:00.000Z" itemprop="datePublished">2010-04-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/04/08/也谈线程同步变量/">也谈线程同步变量</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-size: 12pt; color: #333333; font-family: Verdana; ">　　前段时间看了一下<span lang="EN-US" style="font-size: 12pt; color: #333333; font-family: Verdana; ">QT</span></span><span style="font-size: 12pt; color: #333333; font-family: Verdana; ">中的线程同步变量，这里谈谈我的心得，由于线程同步变量在很多系统和平台中都有涉及，所以下文将更多地从它们的共性方面去讨论。废话少说，进入正文。</span><span style="font-family: Arial; font-size: 12pt; "><span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QT</span><span style="font-size: 12pt; font-family: Verdana; ">中主要提供了以下几个同步类：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QSemaphore&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QWaitCondition&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QReadLocker&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QWriteLocker<br></span><span style="font-size: 12pt; font-family: Verdana; ">等。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size: 12pt; font-family: Verdana; ">下面就主要探讨一下前三个同步类。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="mso-bidi-font-size:10.5pt;
font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;
mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast">　</span><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>QMutex类</strong></span><span style="font-size: 12pt; font-family: Verdana; ">的功能比较简单，主要分为<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>Recursive</strong></span></span><span style="font-size: 12pt; font-family: Verdana; ">和<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>N</strong></span><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>on-Recursive</strong></span></span><span style="font-size: 12pt; font-family: Verdana; ">两种方式，<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Recursive</span></span><span style="font-size: 12pt; font-family: Verdana; ">模式即指在同一线程中可以对某个<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">多次加锁，当然也要同等次数的解锁。而<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Non-Recursive</span></span><span style="font-size: 12pt; font-family: Verdana; ">即指<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">只能被<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">lock</span></span><span style="font-size: 12pt; font-family: Verdana; ">一次，否则视为死锁。下面重点介绍一下这两种模式的异同。</span></p>
<p><span style="font-size: 12pt; font-family: Verdana; ">　　在<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Recursive</span></span><span style="font-size: 12pt; font-family: Verdana; ">模式下需要记录第一次对其进行<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">lock</span></span><span style="font-size: 12pt; font-family: Verdana; ">操作的线程<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">id</span></span><span style="font-size: 12pt; font-family: Verdana; ">，即<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">ownership</span></span><span style="font-size: 12pt; font-family: Verdana; ">（它的所属），如果是同一个线程，则对此<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Mutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">再加一次锁，不会<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">block</span></span><span style="font-size: 12pt; font-family: Verdana; ">当前的线程。如果是不同的线程，则需要<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">block</span></span><span style="font-size: 12pt; font-family: Verdana; ">当前的线程，此外对该<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex unlock</span></span><span style="font-size: 12pt; font-family: Verdana; ">的线程必须和<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">lock</span></span><span style="font-size: 12pt; font-family: Verdana; ">的线程相同。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size: 12pt; font-family: Verdana; ">　　在<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Non-Recursive</span></span><span style="font-size: 12pt; font-family: Verdana; ">模式下<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">unlock</span></span><span style="font-size: 12pt; font-family: Verdana; ">的线程则不需要与<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">lock</span></span><span style="font-size: 12pt; font-family: Verdana; ">的线程相同，在这点上有点类似于<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Semaphore</span></span><span style="font-size: 12pt; font-family: Verdana; ">。有的地方说<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Non-Recursive</span></span><span style="font-size: 12pt; font-family: Verdana; ">模式下的<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Mutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">没有记录<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">ownership</span></span><span style="font-size: 12pt; font-family: Verdana; ">，那么</span><span style="font-size: 12pt; color: red; font-family: Verdana; "><em>我猜测</em><span lang="EN-US" style="font-family: Arial; font-size: 12pt; color: red; "><em>Non-Recursive</em></span></span><span style="font-size: 12pt; color: red; font-family: Verdana; "><em>死锁的检测可能就是等待确定的时间，如果超过了该时间没有被解锁则判定为死锁，不知道这种猜测对不对，哪位知道的可以</em><span lang="EN-US" style="font-family: Arial; font-size: 12pt; color: red; "><em>share</em></span></span><span style="font-size: 12pt; color: red; font-family: Verdana; ">_一下_</span><span style="font-size: 12pt; font-family: Verdana; ">。通过查看<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">的代码，发现<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">版本的<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Mutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">记录了线程的<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Ownership</span></span><span style="font-size: 12pt; font-family: Verdana; ">，所以在<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">QMutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">被二次加锁时能够立刻检查出死锁。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="mso-bidi-font-size:10.5pt;
font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;
mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>QSemaphore</strong></span><span style="font-size: 12pt; font-family: Verdana; "><strong>类</strong>提供对多个资源的保护，适用于生产者和消费者的模式。包括<span lang="EN-US">Acquire</span>和<span lang="EN-US">Release</span>方法。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="mso-bidi-font-size:10.5pt;
font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;
mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>QWaitCondition</strong></span><span style="font-size: 12pt; font-family: Verdana; "><strong>类</strong>，有些平台上也叫<span lang="EN-US">Monitor</span>，提供了对多个条件的等待。下面是一个用条件变量实现的生产者和消费者的例子。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<font class="Apple-style-span" face="宋体"></font>

<font class="Apple-style-span" face="宋体"><br><div class="cnblogs_code" onclick="cnblogs_code_show('f74b1796-019d-42d8-bfcf-323b2d4239d3')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse" style="font-size: 12pt; font-family: Verdana; ">代码</span><br><div id="cnblogs_code_open_f74b1796-019d-42d8-bfcf-323b2d4239d3" class="cnblogs_code_hide"><br><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">void</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;Producer::run()<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">{<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;qsrand(QTime(</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">0</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">,</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">0</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">,</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">0</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">).secsTo(QTime::currentTime()));<br><br>&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">for</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;(</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">int</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;i&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">0</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">;&nbsp;i&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&lt;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;DataSize;&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">++</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">i)&nbsp;{<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">lock</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">if</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;(numUsedBytes&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">==</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;BufferSize)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">缓冲区已满则等待</span><span style="color: #008000;"><br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferNotFull.wait(</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&amp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">mutex);<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br><br>&nbsp;<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer[i&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">%</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;BufferSize]&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">“</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">ACGT</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">“</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">[(</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">int</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">)qrand()&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">%</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">4</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">];<br><br>&nbsp;<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">lock</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">++</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">numUsedBytes;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">生产完一个，唤醒因为缓冲区为空而等待的消费者</span><span style="color: #008000;"><br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferNotEmpty.wakeAll();<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">}<br><br></span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">!&nbsp;[2]<br><br>&nbsp;<br><br></span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">!&nbsp;[3]</span><span style="color: #008000;"><br><br></span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">class</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;Consumer&nbsp;:&nbsp;</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">public</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;QThread<br><br></span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">!&nbsp;[3]&nbsp;</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">!&nbsp;[4]</span><span style="color: #008000;"><br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">{<br><br></span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">public</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">void</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;run();<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">};<br><br>&nbsp;<br><br></span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">void</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;Consumer::run()<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">for</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;(</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">int</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;i&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">0</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">;&nbsp;i&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&lt;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;DataSize;&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">++</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">i)&nbsp;{<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">lock</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">if</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;(numUsedBytes&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">==</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080; font-size: 12pt; font-family: Verdana; ">0</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">缓冲区为空，等待</span><span style="color: #008000;"><br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferNotEmpty.wait(</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&amp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">mutex);<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">“</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">%c</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">“</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">,&nbsp;buffer[i&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">%</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;BufferSize]);<br><br>&nbsp;<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-size: 12pt; font-family: Verdana; ">lock</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">–</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">numUsedBytes;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">//</span><span style="color: #008000; font-size: 12pt; font-family: Verdana; ">消费完一个，唤醒因为缓冲区满等待的消费者</span><span style="color: #008000;"><br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferNotFull.wakeAll();<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">“</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">\n</span><span style="color: #800000; font-size: 12pt; font-family: Verdana; ">“</span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">);<br><br></span><span style="color: #000000; font-size: 12pt; font-family: Verdana; ">}</span></div><br></div><br></div><br><br>&nbsp;<br><br></font>

<p>&nbsp;</p>
<p><span style="font-size: 12pt; font-family: Verdana; ">由此看出<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">WaitCondition</span></span><span style="font-size: 12pt; font-family: Verdana; ">是与一个条件联系在一起用的，常见的使用方法如下：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('adcd7cd8-2725-4173-b6cd-f19fc7bbd541')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse" style="font-family: Verdana; ">代码</span><br><div id="cnblogs_code_open_adcd7cd8-2725-4173-b6cd-f19fc7bbd541" class="cnblogs_code_hide"><br><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000; font-family: Verdana; ">While(</span><span style="color: #0000ff; font-family: Verdana; ">true</span><span style="color: #000000; font-family: Verdana; ">)<br></span><span style="color: #000000; font-family: Verdana; "><br>{<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Do_something();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Mutex.</span><span style="color: #0000ff; font-family: Verdana; ">lock</span><span style="color: #000000; font-family: Verdana; ">();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;(condition)<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitCondition.wati(mutex);<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Mutex.unlock();<br></span><span style="color: #000000; font-family: Verdana; "><br>}<br><br></span><span style="color: #000000; font-family: Verdana; "><br>While&nbsp;(</span><span style="color: #0000ff; font-family: Verdana; ">true</span><span style="color: #000000; font-family: Verdana; ">)<br></span><span style="color: #000000; font-family: Verdana; "><br>{<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Do_something();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Mutex.</span><span style="color: #0000ff; font-family: Verdana; ">lock</span><span style="color: #000000; font-family: Verdana; ">();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Chang&nbsp;the&nbsp;condtion;<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;waitCodtion.wake();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;Mutex.unlock();<br></span><span style="color: #000000; font-family: Verdana; "><br>}<br><br></span></div><br></div><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>Note：</strong>WaitCondition</span><span style="font-size: 12pt; font-family: Verdana; ">的<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">wait</span></span><span style="font-size: 12pt; font-family: Verdana; ">的内部实现一般是先<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">unlock</span></span><span style="font-size: 12pt; font-family: Verdana; ">传入的<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">mutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">，然后等待，收到信号后再对<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">mutex</span></span><span style="font-size: 12pt; font-family: Verdana; ">进行<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">lock</span></span><span style="font-size: 12pt; font-family: Verdana; ">操作。这样为编程提供了一些便利，下面将提到。</span></p>
<p><span lang="EN-US" style="mso-bidi-font-size:10.5pt;
font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;
mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; "><strong>Semaphore</strong></span><span style="font-size: 12pt; font-family: Verdana; "><strong>和</strong><span lang="EN-US"><strong>WaitCondition</strong></span><strong>的比较</strong><span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size: 12pt; font-family: Verdana; ">下表总结了两者的不同&nbsp;</span></p>
<table cellpadding="3" border="2" width="80%" style="font-family: Simsun; line-height: normal; font-size: medium; color: #0a0aff; "><br>     <tbody><br>         <tr align="CENTER"><br>             <td bgcolor="#ACFF3F"><strong><em>Semaphores</em></strong></td><br>             <td bgcolor="#9FFF9F"><strong><em>Condition Variables</em></strong></td><br>         </tr><br>         <tr align="LEFT"><br>             <td bgcolor="#ACFF3F"><span style="font-family: Verdana; ">Can be used anywhere in a program, but should not be used in a monitor</span></td><br>             <td bgcolor="#9FFF9F"><span style="font-family: Verdana; ">Can only be used in monitors</span></td><br>         </tr><br>         <tr align="LEFT"><br>             <td bgcolor="#ACFF3F"><font face="Courier" color="#000000"><span style="font-family: Verdana; ">Wait()</span></font><span style="font-family: Verdana; ">&nbsp;does not always block the caller (</span><em>i.e.</em>, when the semaphore counter is greater than zero).</td><br>             <td bgcolor="#9FFF9F"><font face="Courier" color="#000000"><span style="font-family: Verdana; ">Wait()</span></font><span style="font-family: Verdana; ">&nbsp;always blocks the caller.</span></td><br>         </tr><br>         <tr align="LEFT"><br>             <td bgcolor="#ACFF3F"><font face="Courier" color="#000000"><span style="font-family: Verdana; ">Signal()</span></font><span style="font-family: Verdana; ">&nbsp;either releases a blocked thread, if there is one, or increases the semaphore counter.</span></td><br>             <td bgcolor="#9FFF9F"><font face="Courier" color="#000000"><span style="font-family: Verdana; ">Signal()</span></font><span style="font-family: Verdana; ">&nbsp;either releases a blocked thread, if there is one, or the signal is lost as if it never happens.</span></td><br>         </tr><br>         <tr align="LEFT"><br>             <td bgcolor="#ACFF3F"><span style="font-family: Verdana; ">If&nbsp;</span><font face="Courier" color="#000000"><span style="font-family: Verdana; ">Signal()</span></font><span style="font-family: Verdana; ">&nbsp;releases a blocked thread, the caller and the released thread&nbsp;</span><strong><em>both</em></strong>&nbsp;continue.</td><br>             <td bgcolor="#9FFF9F"><span style="font-family: Verdana; ">If&nbsp;</span><font face="Courier" color="#000000"><span style="font-family: Verdana; ">Signal()</span></font><span style="font-family: Verdana; ">&nbsp;releases a blocked thread, the caller yields the monitor (Hoare type) or continues (Mesa Type). Only one of the caller or the released thread can continue, but not both.</span></td><br>         </tr><br>     </tbody><br></table>

<p>&nbsp;<span style="font-size: 12pt; font-family: Verdana; ">总得来说两者是可以互换的，比如</span><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">WaitCondition</span><span style="font-size: 12pt; font-family: Verdana; ">虽然没有记录在它上面等待的个数，但是可以通过与一个整数联用来达到与</span><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Semaphore</span><span style="font-size: 12pt; font-family: Verdana; ">相同，如上面的例子中所示。据说</span><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">WaitCondition</span><span style="font-size: 12pt; font-family: Verdana; ">内部也可以用</span><span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">Semaphore</span><span style="font-size: 12pt; font-family: Verdana; ">来实现的。</span></p>
<p><span style="font-size: 12pt; font-family: Verdana; ">此外在使用<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">WaitCondition</span></span><span style="font-size: 12pt; font-family: Verdana; ">的时候要注意的是<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">WaitCondition</span></span><span style="font-size: 12pt; font-family: Verdana; ">的<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">wake</span></span><span style="font-size: 12pt; font-family: Verdana; ">方法在没有其他线程等待的情况下是不起作用的，所以在使用的时候要格外注意，下面是一个<span lang="EN-US" style="font-size: 12pt; font-family: Verdana; ">qt</span></span><span style="font-size: 12pt; font-family: Verdana; ">中的一个例子：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('3bfdc3fc-8ee2-48d8-a1ab-620d1c5cc7ff')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse" style="font-family: Verdana; ">代码</span><br><div id="cnblogs_code_open_3bfdc3fc-8ee2-48d8-a1ab-620d1c5cc7ff" class="cnblogs_code_hide"><br><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #000000; font-family: Verdana; ">forever&nbsp;{<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-family: Verdana; ">lock</span><span style="color: #000000; font-family: Verdana; ">();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyPressed.wait(</span><span style="color: #000000; font-family: Verdana; ">&amp;</span><span style="color: #000000; font-family: Verdana; ">mutex);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000; font-family: Verdana; ">++</span><span style="color: #000000; font-family: Verdana; ">count;<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br><br>&nbsp;<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_something();<br><br>&nbsp;<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-family: Verdana; ">lock</span><span style="color: #000000; font-family: Verdana; ">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000; font-family: Verdana; ">–</span><span style="color: #000000; font-family: Verdana; ">count;<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;}<br></span><span style="color: #000000; font-family: Verdana; "><br>forever&nbsp;{<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getchar();<br><br>&nbsp;<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-family: Verdana; ">lock</span><span style="color: #000000; font-family: Verdana; ">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000; font-family: Verdana; ">//</span><span style="color: #008000; font-family: Verdana; ">&nbsp;Sleep&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;busy&nbsp;worker&nbsp;threads</span><span style="color: #008000;"><br><br></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff; font-family: Verdana; ">while</span><span style="color: #000000; font-family: Verdana; ">&nbsp;(count&nbsp;</span><span style="color: #000000; font-family: Verdana; ">&gt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080; font-family: Verdana; ">0</span><span style="color: #000000; font-family: Verdana; ">)&nbsp;{<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color: #800080; font-family: Verdana; ">1</span><span style="color: #000000; font-family: Verdana; ">);<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.</span><span style="color: #0000ff; font-family: Verdana; ">lock</span><span style="color: #000000; font-family: Verdana; ">();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyPressed.wakeAll();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutex.unlock();<br></span><span style="color: #000000; font-family: Verdana; "><br>&nbsp;}</span></div><br></div><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: 12pt; font-family: Verdana; ">上面的代码通过添加一个count变量，防止在其他线程还在工作的情况下被唤醒。由于此处的mutex还用来保护count变量的同步，所以如果QWaitCondition在wait操作时没有对其unlock，那么在另一个线程中想对其操作，满足原来的条件的时候就会产生死锁。&nbsp;</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/04/08/也谈线程同步变量/" data-id="cjs7p2wvj000bng5mg3rxj4vg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-windows7到期的问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/02/24/windows7到期的问题/" class="article-date">
  <time datetime="2010-02-24T04:50:00.000Z" itemprop="datePublished">2010-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/02/24/windows7到期的问题/">windows7到期的问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span class="Apple-style-span" style="font-family: Arial, Helvetica, sans-serif; line-height: 24px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-family: verdana, 'courier new'; line-height: 21px; font-size: 10pt; ">最近使用的windows7 RC版经常报the pre-release version of windows 7 ultimate will expire in XX days.</span><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="verdana, 'courier new'" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 21px; font-size: 10pt; ">如果不想重装怎么办呢？</span></font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="verdana, 'courier new'" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 21px; font-size: 10pt; ">google了一下，发现可以通过升级windows7的方法解决这个问题，参考<a href="http://www.mydigitallife.info/2009/07/29/how-to-direct-in-place-upgrade-windows-7-beta-or-rc-prerelease-version-to-windows-7-rtm/" title="How to Direct In-Place Upgrade Windows 7 Beta or RC (Prerelease Version) to Windows 7 RTM" target="_blank" rel="noopener"><span style="font-size: 10pt; ">How to Direct In-Place Upgrade Windows 7 Beta or RC (Prerelease Version) to Windows 7 RTM</span></a></span><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 21px; font-size: 10pt; ">。</span></font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="verdana, 'courier new'" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 21px; font-size: 10pt; ">下载最新的win7版本，将iso中的文件复制出来，修改source/cversion.ini，如：</span></font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="verdana, 'courier new'" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 21px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-family: monospace; line-height: 19px; color: #005577; font-size: 10pt; ">[HostBuild]<br></span><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-family: monospace; line-height: 19px; color: #005577; font-size: 10pt; ">MinClient=7233.0<br></span><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-family: monospace; line-height: 19px; color: #005577; font-size: 10pt; ">MinServer=7100.0</span></span></font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="monospace" size="3" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 19px; font-size: 10pt; ">修改为：</span></font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="monospace" size="3" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 13px; line-height: 19px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: #005577; font-size: 10pt; ">[HostBuild]<br></span><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: #005577; font-size: 10pt; ">MinClient=7000.0<br></span><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: #005577; font-size: 10pt; ">MinServer=7100.0</span></span></font></div><div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><font face="monospace" size="3" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 19px; font-size: 10pt; ">改完后，点击source/setup.exe文件，在安装的过程中选择升级（保证系统盘中有9G以上的空间），时间比较长，无需监视，适合下班后操作。</span></font></div></span></p>
<p>&nbsp;<br></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/02/24/windows7到期的问题/" data-id="cjs7p2wvl000cng5m3hma66vo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-简述FPS的计算方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/02/04/简述FPS的计算方法/" class="article-date">
  <time datetime="2010-02-04T07:05:00.000Z" itemprop="datePublished">2010-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/02/04/简述FPS的计算方法/">简述FPS的计算方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-family:Calibri" lang="en-US"><strong>FPS</strong></span><span style="font-family:SimSun" lang="zh-CN">是</span><span style="font-family:Calibri" lang="en-US">Frame per second</span><span style="font-family:SimSun" lang="zh-CN">的缩写</span><span style="font-family:Calibri" lang="en-US">,</span><span style="font-family:SimSun" lang="zh-CN">即每秒的帧数</span><span style="font-family:Calibri" lang="en-US">.</span><span style="font-family:SimSun" lang="zh-CN">这一术语广泛的应用于计算机图形学，视频采集，游戏等。</span></p>
<p><span style="font-family: SimSun; " lang="zh-CN">这里主要介绍一下视频游戏中的帧率，第一个</span><span style="font-family:Calibri" lang="en-US">First person shooter game</span><span style="font-family:SimSun" lang="zh-CN">的帧率只有大概</span><span style="font-family:Calibri" lang="en-US">6FPS</span><span style="font-family:SimSun" lang="zh-CN">，但是依然很成功。不过随着硬件设备，尤其是显卡性能的加强，现在游戏的帧率一般在</span><span style="font-family:Calibri" lang="en-US">30FPS~100FPS</span><span style="font-family:SimSun" lang="zh-CN">之间。由于每帧图像所消耗的时间不一样，造成帧率是在不断变化的，所以每个游戏都会设定一个最大的帧率，以保证平滑的切换。</span></p>
<p><span style="font-family:SimSun" lang="zh-CN">下面就以一段</span><span style="font-family:Calibri" lang="en-US">QT</span><span style="font-family:SimSun" lang="zh-CN">中的代码介绍一下帧率的计算。</span></p>
<div class="cnblogs_code"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;Timing…</span><span style="color: #008000;"><br></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">static</span><span style="color: #000000;">&nbsp;QTime&nbsp;time;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">static</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;frames&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">static</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">bool</span><span style="color: #000000;">&nbsp;started&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">false</span><span style="color: #000000;">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">if</span><span style="color: #000000;">&nbsp;(</span><span style="color: #000000;">!</span><span style="color: #000000;">started&nbsp;</span><span style="color: #000000;">||</span><span style="color: #000000;">&nbsp;time.elapsed()&nbsp;</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1000</span><span style="color: #000000;">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qreal&nbsp;fps&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;frames&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1000</span><span style="color: #000000;">.&nbsp;</span><span style="color: #000000;">/</span><span style="color: #000000;">&nbsp;time.elapsed();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">if</span><span style="color: #000000;">&nbsp;(fps&nbsp;</span><span style="color: #000000;">==</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_current_fps&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">counting&nbsp;fps…</span><span style="color: #800000;">“</span><span style="color: #000000;">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">else</span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_current_fps&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;QString::fromLatin1(</span><span style="color: #800000;">“</span><span style="color: #800000;">%3&nbsp;FPS</span><span style="color: #800000;">“</span><span style="color: #000000;">).arg((</span><span style="color: #0000FF;">int</span><span style="color: #000000;">)&nbsp;qRound(fps));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.start();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;started&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">true</span><span style="color: #000000;">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frames&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="color: #0000FF;">else</span><span style="color: #000000;">&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000;">++</span><span style="color: #000000;">frames;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.setOpacity(</span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.setFont(QFont(</span><span style="color: #800000;">“</span><span style="color: #800000;">times</span><span style="color: #800000;">“</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">30</span><span style="color: #000000;">));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.fillRect(</span><span style="color: #800080;">5</span><span style="color: #000000;">,&nbsp;height()&nbsp;</span><span style="color: #000000;">-</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">40</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">250</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">40</span><span style="color: #000000;">,&nbsp;Qt::white);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.drawText(</span><span style="color: #800080;">10</span><span style="color: #000000;">,&nbsp;height()&nbsp;</span><span style="color: #000000;">-</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">8</span><span style="color: #000000;">,&nbsp;m_current_fps);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}</span></div></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:SimSun" lang="zh-CN">由于一般实时的游戏都已一个定时器不断地刷新画面，所以每一帧的输出都是通过</span><span style="font-family:
Calibri" lang="en-US">paintEvent</span><span style="font-family:SimSun" lang="zh-CN">来完成的。将上面这段代码放入</span><span style="font-family:Calibri" lang="en-US">paintEvent</span><span style="font-family:SimSun" lang="zh-CN">就可以统计出每秒的帧率。</span></p>
<p>那么怎么控制最大的帧率呢？</p>
<p><span style="font-family:SimSun" lang="zh-CN">其实也很简单，就是通过设置定时器的</span><span style="font-family: Calibri; " lang="en-US">interval</span><span style="font-family:SimSun" lang="zh-CN">来完成的，考虑到现在显示器的显示频率一般在</span><span style="font-family:Calibri" lang="en-US">60HZ</span><span style="font-family:
SimSun" lang="zh-CN">，所以</span><span style="font-family:Calibri" lang="en-US">interval</span><span style="font-family:SimSun" lang="zh-CN">一般设置为</span><span style="font-family:
Calibri" lang="en-US">1000/60ms </span><span style="font-family:SimSun" lang="zh-CN">比较好，即</span><span style="font-family:Calibri" lang="en-US">60FPS</span><span style="font-family: SimSun; " lang="zh-CN">是一个理论上最大的帧率。</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/02/04/简述FPS的计算方法/" data-id="cjs7p2ww7000png5mzx5c75fz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-QT中的View-Model模型系列一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/01/16/QT中的View-Model模型系列一/" class="article-date">
  <time datetime="2010-01-16T04:49:00.000Z" itemprop="datePublished">2010-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/01/16/QT中的View-Model模型系列一/">QT中的View Model模型系列一</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-size: 12pt; ">本讲主要介绍一下QT中ViewModel的基本结构，以及简单的使用方法。对于View Model的概念这里就不累述了，简单的了解可以参考：</span></p>
<p><a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank" rel="noopener"><span style="font-size: 12pt; ">http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller</span></a></p>
<p><span style="font-size: 12pt; ">下面进入正文：</span></p>
<p><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">Qt</span><span style="font-size: 12pt; ">中的</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">View</span><span style="font-size: 12pt; ">主要有三种</span><span lang="EN-US" style="font-family: Simsun, serif; color: black; font-size: 12pt; ">QListView</span><span style="font-size: 12pt; ">，</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QTreeView,<br>QTabelView</span></p>
<p><span style="font-size: 12pt; ">而对应的</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">Model</span><span style="font-size: 12pt; ">是：</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QStringListModel, </span><span lang="EN-US" style="font-family: Simsun, serif; color: black; font-size: 12pt; ">QAbstractItemModel</span><span lang="EN-US" style="font-size:10.0pt"> </span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">,<br>QStandardItemModel</span><span style="font-size: 12pt; ">。</span></p>
<p><span lang="EN-US" style="font-size:10.0pt">&nbsp;&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size: 12pt; ">基本的原理就是构造出</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">View</span><span style="font-size: 12pt; ">，和</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">Model</span><span style="font-size: 12pt; ">然后通过</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">View</span><span style="font-size: 12pt; ">的</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">setModel</span><span style="font-size: 12pt; ">方法，将两者结合起来。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size: 12pt; ">下面介绍每种</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">View-Model</span><span style="font-size: 12pt; ">的使用：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:10.0pt">&nbsp;&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><em><span lang="EN-US" style="font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Calibri"><span style="mso-spacerun:yes">&nbsp;</span></span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; "><strong><u>QListView</u></strong></span></em><strong><em><u><span style="font-size: 12pt; ">与</span></u></em>**</strong><em><u><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QStringListModel</span></u></em>**<em><span lang="EN-US" style="font-size:11.0pt">&lt;o:p&gt;&lt;/o:p&gt;</span></em></p>
<font class="Apple-style-span" color="#333333" face="'Courier New'" size="4"><span class="Apple-style-span" style="font-size: 16px;"></span></font><br><font class="Apple-style-span" color="#333333" face="'Courier New'" size="4"><div class="cnblogs_code" onclick="cnblogs_code_show('132f2318-0162-4e0f-8e29-23d64fd9c17a')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_132f2318-0162-4e0f-8e29-23d64fd9c17a" class="cnblogs_code_hide"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QApplication</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QStringList</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QAbstractItemModel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QStringListModel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QListView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>&nbsp;<br></span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;main(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;argc,&nbsp;</span><span style="color: #0000FF;">char</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">argv[])&nbsp;{<br>QApplication&nbsp;app(argc,&nbsp;argv);<br>&nbsp;<br>QStringList&nbsp;numbers;<br>numbers&nbsp;</span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar</span><span style="color: #800000;">“</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">momor</span><span style="color: #800000;">“</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">bush</span><span style="color: #800000;">“</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">&lt;&lt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">bee</span><span style="color: #800000;">“</span><span style="color: #000000;">;<br>QAbstractItemModel&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">model&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QStringListModel(numbers);<br>&nbsp;<br>QListView&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">view&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListView;<br>view</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setWindowTitle(</span><span style="color: #800000;">“</span><span style="color: #800000;">QListView&nbsp;&amp;&nbsp;Model</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>view</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setModel(model);<br>&nbsp;<br>view</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">show();<br>&nbsp;<br></span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;app.exec();<br>}</span></div></div></div><br><br>&nbsp;<br></font>

<p>&nbsp;</p>
<p><span lang="EN-US" style="font-size:10.0pt">&nbsp;&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><strong><em><u><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QTableView </span></u></em>**</strong><em><u><span style="font-size: 12pt; ">与</span></u></em><strong><strong><em><u><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; "> QStandardItemModel</span></u></em></strong></strong><em><u><span lang="EN-US" style="font-size:11.0pt">&lt;o:p&gt;&lt;/o:p&gt;</span></u></em>**</p>
<font class="Apple-style-span" color="#333333" face="'Courier New'" size="4"><span class="Apple-style-span" style="font-size: 16px;"></span></font><br><font class="Apple-style-span" color="#333333" face="'Courier New'" size="4"><div class="cnblogs_code" onclick="cnblogs_code_show('c7953d53-fd20-45b0-8524-21cb0aff2cde')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_c7953d53-fd20-45b0-8524-21cb0aff2cde" class="cnblogs_code_hide"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QApplication</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QStandardItemModel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QStandardItem</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QTableView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>&nbsp;<br></span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;main(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;argc,&nbsp;</span><span style="color: #0000FF;">char</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">argv[])&nbsp;{<br>QApplication&nbsp;app(argc,&nbsp;argv);<br>&nbsp;<br>QStandardItemModel&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">model&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QStandardItemModel;<br>model</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QStandardItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">January</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>model</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QStandardItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">February</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>model</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QStandardItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">10,000</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>model</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QStandardItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">20,000</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>&nbsp;<br>QTableView&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">view1&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableView;<br>view1</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setModel(model);<br>&nbsp;<br>QTableView&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">view2&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableView;<br>view2</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setModel(model);<br>&nbsp;<br>view1</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">show();<br>view2</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">show();<br>&nbsp;<br></span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;app.exec();<br>}</span></div></div></div><br><br>&nbsp;<br></font>

<p>&nbsp;</p>
<p><span class="Apple-style-span" style="font-size: 13px; ">&nbsp;</span></p>
<p><span style="font-size: 12pt; ">对于</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QTreeView</span><span style="font-size: 12pt; ">一般来说需要重载</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QAbstractItemModel</span><span style="font-size: 12pt; ">来实现自己的</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">Model，将在下一讲中介绍。</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 12pt; ">对于简单的应用，</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">Qt</span><span style="font-size: 12pt; ">还提供了</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">QListWidget, QTreeWidget, QTabelWidget </span><span style="font-size: 12pt; ">三个</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">widget</span><span style="font-size: 12pt; ">，分别继承自上面的</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">3</span><span style="font-size: 12pt; ">个</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">View</span><span style="font-size: 12pt; ">。它们将</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">View</span><span style="font-size: 12pt; ">，</span><span lang="EN-US" style="font-family: Calibri, sans-serif; font-size: 12pt; ">Model</span><span style="font-size: 12pt; ">整合了，可以方便的使用。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span class="Apple-style-span" style="font-size: 12pt; ">示例程序：</span>&nbsp;</p>
<p><strong><em><u>&nbsp;QListWidget</u></em></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('6c15dc67-24bc-4277-a5f2-11e6fcaa2873')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_6c15dc67-24bc-4277-a5f2-11e6fcaa2873" class="cnblogs_code_hide"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QApplication</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QHBoxLayout</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QLabel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QListWidget</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>&nbsp;<br></span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;main(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;argc,&nbsp;</span><span style="color: #0000FF;">char</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">argv[])&nbsp;{<br>QApplication&nbsp;app(argc,&nbsp;argv);<br>&nbsp;<br>QWidget&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">window&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QWidget;<br>window</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setWindowTitle(</span><span style="color: #800000;">“</span><span style="color: #800000;">QListWidget&nbsp;&amp;&nbsp;Item</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>&nbsp;<br>QLabel&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">label&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QLabel;<br>label</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setFixedWidth&nbsp;(</span><span style="color: #800080;">100</span><span style="color: #000000;">);<br>&nbsp;<br>QListWidget&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">listWidget&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListWidget;<br>listWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">insertItem(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListWidgetItem(<br>QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>listWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">insertItem(</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListWidgetItem(<br>QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">momor_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">momor</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>listWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">insertItem(</span><span style="color: #800080;">2</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListWidgetItem(<br>QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">bush_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">bush</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>listWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">insertItem(</span><span style="color: #800080;">3</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListWidgetItem(<br>QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">bee_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">bee</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>listWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">insertItem(</span><span style="color: #800080;">4</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QListWidgetItem(<br>QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">cat_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">cat</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>&nbsp;<br>QObject::connect(listWidget,&nbsp;SIGNAL(currentTextChanged&nbsp;(</span><span style="color: #0000FF;">const</span><span style="color: #000000;">&nbsp;QString&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">)),<br>label,&nbsp;SLOT(setText(</span><span style="color: #0000FF;">const</span><span style="color: #000000;">&nbsp;QString&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">)));<br>&nbsp;<br>QHBoxLayout&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">layout&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QHBoxLayout;<br>layout</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">addWidget(label);<br>layout</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">addWidget(listWidget);<br>&nbsp;<br>window</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setLayout(layout);&nbsp;<br>window</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">show();<br>&nbsp;<br></span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;app.exec();<br>}<br></span></div></div></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong><em><u>QTreeWidget</u></em></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('9619e79e-be50-41c8-b96b-3f9365b98909')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_9619e79e-be50-41c8-b96b-3f9365b98909" class="cnblogs_code_hide"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QApplication</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QTreeWidget</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QTreeWidgetItem</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QStringList</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QFile</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QFileInfo</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QDir</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>&nbsp;<br></span><span style="color: #0000FF;">void</span><span style="color: #000000;">&nbsp;listFile(QTreeWidgetItem&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">,&nbsp;QFileInfo&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">);<br>&nbsp;<br></span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;main(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;argc,&nbsp;</span><span style="color: #0000FF;">char</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">argv[])&nbsp;{<br>QApplication&nbsp;app(argc,&nbsp;argv);<br>&nbsp;<br>QTreeWidget&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">treeWidget&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTreeWidget;<br>treeWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setWindowTitle(</span><span style="color: #800000;">“</span><span style="color: #800000;">QTreeWidget&nbsp;&amp;&nbsp;Item</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>treeWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">resize(</span><span style="color: #800080;">400</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">250</span><span style="color: #000000;">);<br>&nbsp;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;設定欄位名稱&nbsp;</span><span style="color: #008000;"><br></span><span style="color: #000000;">QStringList&nbsp;columnTitle;<br>columnTitle.append(</span><span style="color: #800000;">“</span><span style="color: #800000;">Name</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>columnTitle.append(</span><span style="color: #800000;">“</span><span style="color: #800000;">Size</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>treeWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setHeaderLabels(columnTitle);<br>&nbsp;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;查詢的目錄&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;"><br></span><span style="color: #000000;">QFileInfo&nbsp;fileInfo(</span><span style="color: #800000;">“</span><span style="color: #800000;">D:\Temp</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>QStringList&nbsp;fileColumn;<br>fileColumn.append(fileInfo.fileName());<br>&nbsp;<br>QTreeWidgetItem&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">dir&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTreeWidgetItem(fileColumn);<br>dir</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setIcon(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>dir</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setCheckState(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;Qt::Checked);&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;設定可核取的方塊&nbsp;</span><span style="color: #008000;"><br></span><span style="color: #000000;">treeWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">addTopLevelItem(dir);<br>&nbsp;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;查詢目錄&nbsp;</span><span style="color: #008000;"><br></span><span style="color: #000000;">listFile(dir,&nbsp;fileInfo);<br>&nbsp;<br>treeWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">show();<br>&nbsp;<br></span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;app.exec();<br>}<br>&nbsp;<br></span><span style="color: #0000FF;">void</span><span style="color: #000000;">&nbsp;listFile(QTreeWidgetItem&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">parentWidgetItem,&nbsp;QFileInfo&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">parent)&nbsp;{<br>QDir&nbsp;dir;<br>dir.setPath(parent.filePath());<br>dir.setFilter(QDir::Files&nbsp;</span><span style="color: #000000;">|</span><span style="color: #000000;">&nbsp;QDir::Dirs&nbsp;</span><span style="color: #000000;">|</span><span style="color: #000000;">&nbsp;QDir::NoSymLinks);<br>dir.setSorting(QDir::DirsFirst&nbsp;</span><span style="color: #000000;">|</span><span style="color: #000000;">&nbsp;QDir::Name);&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;<br></span><span style="color: #0000FF;">const</span><span style="color: #000000;">&nbsp;QFileInfoList&nbsp;fileList&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;dir.entryInfoList();<br>&nbsp;<br></span><span style="color: #0000FF;">for</span><span style="color: #000000;">&nbsp;(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;i&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">;&nbsp;i&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">&nbsp;fileList.size();&nbsp;i</span><span style="color: #000000;">++</span><span style="color: #000000;">)&nbsp;{<br>QFileInfo&nbsp;fileInfo&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;fileList.at(i);<br>QStringList&nbsp;fileColumn;<br>fileColumn.append(fileInfo.fileName());<br></span><span style="color: #0000FF;">if</span><span style="color: #000000;">&nbsp;(fileInfo.fileName()&nbsp;</span><span style="color: #000000;">==</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">.</span><span style="color: #800000;">“</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">||</span><span style="color: #000000;">&nbsp;fileInfo.fileName()&nbsp;</span><span style="color: #000000;">==</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">..</span><span style="color: #800000;">“</span><span style="color: #000000;">&nbsp;);&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;nothing</span><span style="color: #008000;"><br></span><span style="color: #0000FF;">else</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">if</span><span style="color: #000000;">(fileInfo.isDir())&nbsp;{<br>QTreeWidgetItem&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">child&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTreeWidgetItem(fileColumn);<br>child</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setIcon(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>child</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setCheckState(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;Qt::Checked);<br>parentWidgetItem</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">addChild(child);<br></span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;查詢子目錄</span><span style="color: #008000;"><br></span><span style="color: #000000;">listFile(child,&nbsp;fileInfo);<br>}<br></span><span style="color: #0000FF;">else</span><span style="color: #000000;">&nbsp;{<br>fileColumn.append(QString::number(fileInfo.size()));<br>QTreeWidgetItem&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">child&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTreeWidgetItem(fileColumn);<br>child</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setIcon(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">momor_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>child</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setCheckState(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;Qt::Checked);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>parentWidgetItem</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">addChild(child);<br>}<br>}&nbsp;&nbsp;&nbsp;&nbsp;<br>}<br></span></div></div></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong><em><u>QTableWidget&nbsp;</u></em></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('5a602ea6-0fc3-4f76-a521-b19aba50a988')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_5a602ea6-0fc3-4f76-a521-b19aba50a988" class="cnblogs_code_hide"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #000000;">#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QApplication</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QTableWidget</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">QHBoxLayout</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>&nbsp;<br></span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;main(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;argc,&nbsp;</span><span style="color: #0000FF;">char</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"><em></em></span><span style="color: #000000;">argv[])&nbsp;{<br>QApplication&nbsp;app(argc,&nbsp;argv);<br>&nbsp;<br>QTableWidget&nbsp;</span><span style="color: #000000;"></span><span style="color: #000000;">tableWidget&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidget;<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setWindowTitle(</span><span style="color: #800000;">“</span><span style="color: #800000;">QTableWidget&nbsp;&amp;&nbsp;Item</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">resize(</span><span style="color: #800080;">350</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">200</span><span style="color: #000000;">);<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setRowCount(</span><span style="color: #800080;">10</span><span style="color: #000000;">);<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setColumnCount(</span><span style="color: #800080;">5</span><span style="color: #000000;">);<br>&nbsp;<br>QStringList&nbsp;header;<br>header.append(</span><span style="color: #800000;">“</span><span style="color: #800000;">Month</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>header.append(</span><span style="color: #800000;">“</span><span style="color: #800000;">Description</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setHorizontalHeaderLabels(header);<br>&nbsp;<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidgetItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">January</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidgetItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">February</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">2</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidgetItem(</span><span style="color: #800000;">“</span><span style="color: #800000;">March</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>&nbsp;<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;<br></span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidgetItem(QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">caterpillar’s&nbsp;month</span><span style="color: #800000;">“</span><span style="color: #000000;">));<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;<br></span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidgetItem(QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">momor_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">momor’s&nbsp;month</span><span style="color: #800000;">“</span><span style="color: #000000;">));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">setItem(</span><span style="color: #800080;">2</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;<br></span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;QTableWidgetItem(QIcon(</span><span style="color: #800000;">“</span><span style="color: #800000;">bush_head.jpg</span><span style="color: #800000;">“</span><span style="color: #000000;">),&nbsp;</span><span style="color: #800000;">“</span><span style="color: #800000;">bush’s&nbsp;month</span><span style="color: #800000;">“</span><span style="color: #000000;">));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;<br>tableWidget</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">show();<br>&nbsp;<br></span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;app.exec();<br>}<br></span></div></div></div>

<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2010/01/16/QT中的View-Model模型系列一/" data-id="cjs7p2wvb0003ng5mq1n9zdqr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-从农夫养牛问题推广到斐波那契数列" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/10/31/从农夫养牛问题推广到斐波那契数列/" class="article-date">
  <time datetime="2009-10-31T09:30:00.000Z" itemprop="datePublished">2009-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/31/从农夫养牛问题推广到斐波那契数列/">从农夫养牛问题推广到斐波那契数列</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">今天在<span lang="EN-US">CSDN</span>上看到一条题目：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><em><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt"><span style="mso-spacerun:yes">&nbsp;</span></span>__<span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">一个农夫养了一头牛，三年后，这头牛每年会生出<span lang="EN-US">1</span>头牛，生出来的牛三年后，又可以每年生出一头牛<span lang="EN-US">&#8230;&#8230;</span>问农夫<span lang="EN-US">10</span>年后有多少头牛<span lang="EN-US">?n</span>年呢？</span></em><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">这里主要谈一下解决这种问题的思想。首先可以联系斐波那契数列，设<span lang="EN-US">f(n)</span>为第<span lang="EN-US">n</span>年的牛，则<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">f(n) = f(n - 1) + f(n - 2)&#8212;&#8212;&#8212;&#8212;&gt;</span><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">表达式<span lang="EN-US">1-1&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即第<span lang="EN-US">n</span>年的牛为去年牛的个数<span lang="EN-US">f(n</span></span></p>
<ul>
<li>1)加上今年出生牛的个数<span lang="EN-US">,</span>那么今年有多少头牛能生呢？（不考虑死亡的牛）则为前年牛的个数即<span lang="EN-US">f(n - 2)</span>，因为前年的牛今年至少<span lang="EN-US">3</span>岁，即为表达式<span lang="EN-US">1-1</span>。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></li>
</ul>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p>&nbsp;</p>
<p><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">推广一下，将牛生育年龄设为<span lang="EN-US">m</span>，那么计算的表达式就变为<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">f(n) = f(n - 1) + f(n - m + 1)&#8212;&#8212;&#8212;&#8212;&gt;</span><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">表达式<span lang="EN-US">1-2&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即<span lang="EN-US">n-1</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数加上<span lang="EN-US">n-m+1</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年的牛生出的小牛。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;
mso-bidi-font-family:Arial;color:black;mso-font-kerning:0pt">那么下面讨论一个稍微复杂点的问题，如果增加一个条件，即牛会在第８年死去，那么第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;
mso-bidi-font-family:Arial;color:black;mso-font-kerning:0pt">年会有多少条牛呢？<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">为了便于推导，这里先设几个函数<span lang="EN-US">:&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:black;
mso-font-kerning:0pt"><span style="mso-list:Ignore">&#183;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span><span lang="EN-US" style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">f(n)</span><span style="font-size:12.0pt;font-family:
&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;mso-font-kerning:
0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;font-family:
&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;mso-font-kerning:
0pt">年牛的个数<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:black;
mso-font-kerning:0pt"><span style="mso-list:Ignore">&#183;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span><span lang="EN-US" style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">h(n)</span><span style="font-size:12.0pt;font-family:
&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;mso-font-kerning:
0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;font-family:
&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;mso-font-kerning:
0pt">年出生的牛的个数<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:black;
mso-font-kerning:0pt"><span style="mso-list:Ignore">&#183;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span><span lang="EN-US" style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">g(n)</span><span style="font-size:12.0pt;font-family:
&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;mso-font-kerning:
0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;font-family:
&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;mso-font-kerning:
0pt">年死亡的牛的个数<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">那么这里可以首先想到一个表达式<span lang="EN-US">:&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">(1)f(n) = f(n -1) + h(n) - g(n)&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数为第<span lang="EN-US">n-1</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数<span lang="EN-US">+</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年出生的牛的个数<span lang="EN-US">-</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年死亡的牛的个数<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">而第二个表达式即关于新增牛的个数<span lang="EN-US">h(n)</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">的：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">(2)h(n) = f(n - 2) - g(n - 1)&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年出生的牛的个数为第<span lang="EN-US">n-2</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数减去在第<span lang="EN-US">n-1</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年死亡的牛的个数<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">再看第三个表达式关于第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年死亡的牛的个数的：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">(3)g(n)=h(n - 7)&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年死亡的牛的个数为第<span lang="EN-US">n -<br>7</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年出生的牛的个数，这是一个对称的关系。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">推导的步骤如下，将<span lang="EN-US">(2)</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">代入<span lang="EN-US">(1)&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即<span lang="EN-US">f(n) = f(n - 1) + f(n - 2)- g(n - 1) -<br>g(n)—-&gt;</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">（<span lang="EN-US">4</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">）<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">再将<span lang="EN-US">(3)</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">式代入<span lang="EN-US">(4)&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即<span lang="EN-US">f(n) = f(n - 1) + f(n - 2) - h(n - 8) -<br>h(n - 7)—–&gt;(5)&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">再将（<span lang="EN-US">2</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">）式代入（<span lang="EN-US">5</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">）的<span lang="EN-US">h(n - 7)&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即<span lang="EN-US">f(n) = f(n - 1) + f(n - 2) - (h(n - 8)</span></span></p>
<ul>
<li>f(n - 9) - g(n - 8))&lt;o:p&gt;&lt;/o:p&gt;</li>
</ul>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">到了这里不难看出<span lang="EN-US">(h(n - 8) + f(n - 9) - g(n - 8))</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即为<span lang="EN-US">f(n - 8)</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">通过式<span lang="EN-US">(1)</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">。<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">则最终的表达式为<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">f(n) = f(n - 1) + f(n - 2) - f(n - 8)&lt;o:p&gt;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">即第<span lang="EN-US">n</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数为第<span lang="EN-US">n-1</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数<span lang="EN-US">+</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">第<span lang="EN-US">n-2</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数<span lang="EN-US">-</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">第<span lang="EN-US">n-8</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">年牛的个数<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">当牛的生育年龄用<span lang="EN-US">a</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">表示，死亡年龄用<span lang="EN-US">b</span></span><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">表示时，则表示为：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">f(n) = f(n - 1) + f(n &#8211; a +</span><span style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">　１<span lang="EN-US">) - f(n - b)&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<p><span lang="EN-US" style="font-size:12.0pt;font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:
Arial;color:black;mso-font-kerning:0pt">&lt;o:p&gt;&nbsp;&lt;/o:p&gt;</span></p>
<p><span style="font-size:12.0pt;
font-family:&quot;微软雅黑&quot;,&quot;sans-serif&quot;;mso-bidi-font-family:Arial;color:black;
mso-font-kerning:0pt">验证程序如下：<span lang="EN-US">&lt;o:p&gt;&lt;/o:p&gt;</span></span></p>
<font class="Apple-style-span" face="微软雅黑, sans-serif" size="4"><span class="Apple-style-span" style="font-size: 16px;"><br></span></font><br><font class="Apple-style-span" face="微软雅黑, sans-serif" size="4"><div class="cnblogs_code"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" alt><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" alt><span id="Code_Closed_Text_172312" class="cnblogs_code_Collapse">Code</span><span id="Code_Open_Text_172312" style="display: none"><br><br><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)

http://www.CodeHighlighter.com/

--><span style="color: #0000FF;">using</span><span style="color: #000000;">&nbsp;System;<br><br>&nbsp;<br><br></span><span style="color: #0000FF;">namespace</span><span style="color: #000000;">&nbsp;TopCoder<br><br></span><span style="color: #000000;"><br>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">class</span><span style="color: #000000;">&nbsp;Program<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">static</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">void</span><span style="color: #000000;">&nbsp;Main(</span><span style="color: #0000FF;">string</span><span style="color: #000000;">[]&nbsp;args)<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FeedCow&nbsp;feedCow&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">new</span><span style="color: #000000;">&nbsp;FeedCow();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">for</span><span style="color: #000000;">&nbsp;(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;i&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">;&nbsp;i&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">30</span><span style="color: #000000;">;&nbsp;</span><span style="color: #000000;">++</span><span style="color: #000000;">i)<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;sum&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;feedCow.Feed(i,&nbsp;</span><span style="color: #800080;">5</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800080;">7</span><span style="color: #000000;">);<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span><span style="color: #800000;">“</span><span style="color: #800000;">{0}:{1}</span><span style="color: #800000;">“</span><span style="color: #000000;">,&nbsp;i,&nbsp;sum);<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;">&nbsp;</span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;">&nbsp;</span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;">&nbsp;</span><span style="color: #808080;">&lt;param&nbsp;name=”year”&gt;</span><span style="color: #008000;">要计算的年限</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;">&nbsp;</span><span style="color: #808080;">&lt;param&nbsp;name=”age”&gt;</span><span style="color: #008000;">牛的生育年龄</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;">&nbsp;</span><span style="color: #808080;">&lt;param&nbsp;name=”deadAge”&gt;</span><span style="color: #008000;">牛的死亡年龄</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #808080;">///</span><span style="color: #008000;">&nbsp;</span><span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span><span style="color: #808080;"><br><br></span><span style="color: #000000;"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;Feed(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;year,&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;age,&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;deadAge)<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;sum&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;min&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;deadAge&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">&nbsp;year&nbsp;</span><span style="color: #000000;">?</span><span style="color: #000000;">&nbsp;deadAge&nbsp;:&nbsp;year;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">for</span><span style="color: #000000;">&nbsp;(</span><span style="color: #0000FF;">int</span><span style="color: #000000;">&nbsp;i&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;age;&nbsp;i&nbsp;</span><span style="color: #000000;">&lt;=</span><span style="color: #000000;">&nbsp;min;&nbsp;</span><span style="color: #000000;">++</span><span style="color: #000000;">i)<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum&nbsp;</span><span style="color: #000000;">+=</span><span style="color: #000000;">&nbsp;Feed(year&nbsp;</span><span style="color: #000000;">-</span><span style="color: #000000;">&nbsp;i&nbsp;</span><span style="color: #000000;">+</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">,&nbsp;age,&nbsp;deadAge);<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000FF;">return</span><span style="color: #000000;">&nbsp;sum;<br><br></span><span style="color: #000000;"><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span></span></div><br></font>

<p>&nbsp;</p>
<p>Over，欢迎大家拍砖~&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/10/31/从农夫养牛问题推广到斐波那契数列/" data-id="cjs7p2wvr000ing5mv59yxl92" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-NET-性能优化方法总结-转" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/10/27/NET-性能优化方法总结-转/" class="article-date">
  <time datetime="2009-10-27T03:26:00.000Z" itemprop="datePublished">2009-10-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/27/NET-性能优化方法总结-转/">NET 性能优化方法总结[转]</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span class="Apple-style-span" style="font-family: verdana, sans-serif; line-height: 21px; "></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p>&nbsp;转自：<a href="http://blog.csdn.net/bluedoctor/archive/2009/02/03/3859847.aspx" target="_blank" rel="noopener">http://blog.csdn.net/bluedoctor/archive/2009/02/03/3859847.aspx</a>，书签的链接有点问题。。。</p>
<p><span style="line-height: 31px; font-family: 'Times New Roman'; ">NET&nbsp;</span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">性能优化方法总结</span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">Ver 1.0</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; "><span style="line-height: 31px; ">&nbsp;</span></span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 19px; ">2009-1-20</span><span lang="EN-US" style="line-height: 19px; "></span></span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; font-family: 'Times New Roman'; "></span></p>
<p></p>
<p><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">目录</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297404" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1. C#</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">语言方面</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297405" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">垃圾回收</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297406" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免不必要的对象创建</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297407" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">不要使用空析构函数</span></span><span lang="EN-US" style="line-height: 19px; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">&#9733;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297408" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">实现</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;IDisposable&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">接口</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297409" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.2 String&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">操作</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297410" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.2.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;StringBuilder&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">做字符串连接</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297411" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.2.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免不必要的调用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ToUpper&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">或</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ToLower&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">方法</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297412" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.2.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">最快的空串比较方法</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297413" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">多线程</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297414" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">线程同步</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297415" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ThreadStatic&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">替代</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;NameDataSlot&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">&#9733;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297416" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">多线程编程技巧</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297417" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">类型系统</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297418" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.4.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免无意义的变量初始化动作</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297419" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.4.2 ValueType&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">和</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ReferenceType</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297420" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.4.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">尽可能使用最合适的类型</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297421" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">异常处理</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297422" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">不要吃掉异常&#9733;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297423" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">不要吃掉异常信息&#9733;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297424" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免不必要的抛出异常</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297425" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免不必要的重新抛出异常</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297426" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5.5&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">捕获指定的异常，不要使用通用的</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">System.Exception.</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297427" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.5.6&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">要在</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">finally</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">里释放占用的资源</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297428" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.6&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">反射</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297429" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.6.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">反射分类</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297430" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.6.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">动态创建对象</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297431" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.6.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">动态方法调用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297432" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.6.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">推荐的使用原则</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297433" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">基本<span lang="EN-US" style="line-height: 19px; ">代码技巧</span></span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297434" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">循环写法</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297435" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">拼装字符串</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297436" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免两次检索集合元素</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297437" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免两次类型转换</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297438" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.5</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">为字符串容器声明常量，不要直接把字符封装在双引号</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">“ “</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">里面。</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297439" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.6&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">StringBuilder</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">代替使用字符串连接符</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;&#8220;+&#8221;</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297440" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.7.7&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免在循环体里声明变量，</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297441" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.8 Hashtable</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297442" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.8.1 Hashtable</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">机理</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297443" target="_blank" rel="noopener"><strong><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 19px; font-size: small; ">1.8.2<span style="line-height: 19px; ">&nbsp;&nbsp;</span></span></span></strong><span style="line-height: 19px; font-size: small; "><strong><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">HashTale</span>**</strong><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">代替其他字典集合类型的情形</span></span>**<span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">：</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297444" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.9<span style="line-height: 19px; ">&nbsp;&nbsp;</span></span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">ArrayList</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">。</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297445" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.10</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">从</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">XML</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">对象读取数据</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297446" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.11&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免使用递归调用和嵌套循环，</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297447" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.12&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用适当的</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">Caching</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">策略来提高性能</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297448" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2. Ado.Net</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297449" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">应用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">Ado.net</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">的一些思考原则</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297450" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.2 Connection</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297451" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.2.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">在方法中打开和关闭连接</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297452" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.2.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">显式关闭连接</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297453" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.2.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">确保连接池启用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297454" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.2.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">不要缓存连接</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297455" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.3 Command</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297456" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.3.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteScalar</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">和</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteNonQuery</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297457" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.3.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">Prepare</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297458" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.3.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用绑定变量</span></span><span lang="EN-US" style="line-height: 19px; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">&#9733;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297459" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.4 DataReader</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297460" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.4.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">显式关闭</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297461" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.4.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">用索引号访问代替名称索引号访问属性</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297462" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.4.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用类型化方法访问属性</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297463" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.4.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用多数据集</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297464" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.5 DataSet</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297465" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.5.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">利用索引加快查找行的效率</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297466" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataView</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297467" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.ASP.NET</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297468" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.1&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">减少往返行程（</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">Reduce Round Trips</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">）</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297469" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.2&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">避免阻塞和长时间的作业</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297470" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.3&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">使用缓存</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297471" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">多线程</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297472" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.5&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">系统资源</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297473" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.6&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">页面处理</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297474" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.7 ViewState</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297475" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.JScript</span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297476" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.1 JScript</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">性能优化的基本原则</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297477" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.2 JScript</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">语言本身的优化</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297478" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.3 DOM</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">相关</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span class="MsoHyperlink" style="line-height: 21px; "><span lang="EN-US" style="line-height: 21px; "><a href="http://writeblog.csdn.net/#_Toc220297479" target="_blank" rel="noopener"><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.4&nbsp;</span><span lang="EN-US" style="line-height: 19px; font-family: 宋体; "><span lang="EN-US" style="line-height: 19px; ">其他</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></a></span></span><span lang="EN-US" style="line-height: 21px; "></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; font-family: 'Times New Roman'; "></span></p>
<p></p>
<p><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h1 id="1-C-语言方面"><a href="#1-C-语言方面" class="headerlink" title="1. C#语言方面"></a><a name="_Toc220297404" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: x-large; font-family: 'Times New Roman'; ">1. C#</span></span></a><span><span style="font-family: 宋体; "><span style="font-size: x-large; ">语言方面</span></span></span></h1><p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-1-nbsp-垃圾回收"><a href="#1-1-nbsp-垃圾回收" class="headerlink" title="1.1&nbsp;垃圾回收"></a><a name="_Toc220297405" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.1&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">垃圾回收</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　垃圾回收解放了手工管理对象的工作，提高了程序的健壮性，但副作用就是程序代码可能对于对象创建变得随意。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297406" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.1.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免不必要的对象创建</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　由于垃圾回收的代价较高，所以</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">程序开发要遵循的一个基本原则就是避免不必要的对象创建。以下列举一些常见的情形。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.1&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">避免循环创建对象</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">&#9733;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　如果对象并不会随每次循环而改变状态，那么在循环中反复创建对象将带来性能损耗。高效的做法是将对象提到循环外面创建。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.2&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">在需要逻辑分支中创建对象</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　如果对象只在某些逻辑分支中才被用到，那么应只在该逻辑分支中创建对象。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.3&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用常量避免创建对象</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　程序中不应出现如</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;new Decimal(0)&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">之类的代码，这会导致小对象频繁创建及回收，正确的做法是使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Decimal.Zero</span></span><span style="line-height: 19px; font-family: 宋体; ">常量。我们有设计自己的类时，也可以学习这个设计手法，应用到类似的场景中。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.1.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.4&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">StringBuilder</span></span><span style="line-height: 19px; font-family: 宋体; ">做字符串连接</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297407" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.1.2</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">不要使用空析构函数</span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">&#9733;</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果类包含析构函数，由创建对象时会在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Finalize&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">队列中添加对象的引用，以保证当对象无法可达时，仍然可以调用到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Finalize&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。垃圾回收器在运行期间，会启动一个低优先级的线程处理该队列。相比之下，没有析构函数的对象就没有这些消耗。如果析构函数为空，这个消耗就毫无意义，只会导致性能降低！因此，不要使用空的析构函数。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　在实际情况中，许多曾在析构函数中包含处理代码，但后来因为种种原因被注释掉或者删除掉了，只留下一个空壳，此时应注意把析构函数本身注释掉或删除掉。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297408" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.1.3</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">实现</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;IDisposable&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">接口</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　垃圾回收事实上只支持托管内在的回收，对于其他的非托管资源，例如</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Window GDI&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">句柄或数据库连接，在析构函数中释放这些资源有很大问题。原因是垃圾回收依赖于内在紧张的情况，虽然数据库连接可能已濒临耗尽，但如果内存还很充足的话，垃圾回收是不会运行的。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;IDisposable&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">接口是一种显式释放资源的机制。通过提供</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;using&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">语句，还简化了使用方式（编译器自动生成</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;try … finally&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">块，并在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;finally&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">块中调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Dispose&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法）。对于申请非托管资源对象，应为其实现</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;IDisposable&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">接口，以保证资源一旦超出</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;using&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">语句范围，即得到及时释放。这对于构造健壮且性能优良的程序非常有意义！</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">为防止对象的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Dispose&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法不被调用的情况发生，一般还要提供析构函数，两者调用一个处理资源释放的公共方法。同时，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Dispose&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法应调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;System.GC.SuppressFinalize(this)</span></span><span style="line-height: 19px; font-family: 宋体; ">，告诉垃圾回收器无需再处理</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Finalize&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法了。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-2-String-nbsp-操作"><a href="#1-2-String-nbsp-操作" class="headerlink" title="1.2 String&nbsp;操作"></a><a name="_Toc220297409" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.2 String&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">操作</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297410" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.2.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;StringBuilder&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">做字符串连接</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">是不变类，使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;+&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">操作连接字符串将会导致创建一个新的字符串。如果字符串连接次数不是固定的，例如在一个循环中，则应该使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;StringBuilder&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">类来做字符串连接工作。因为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;StringBuilder&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">内部有一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;StringBuffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">，连接操作不会每次分配新的字符串空间。只有当连接后的字符串超出</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">大小时，才会申请新的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">空间。典型代码如下：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">StringBuilder sb = new StringBuilder( 256 );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">for ( int i = 0 ; i &lt; Results.Count; i ++ )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">sb.Append (Results[i]);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">如果连接次数是固定的并且只有几次，此时应该直接用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;+&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">号连接，保持程序简洁易读。实际上，编译器已经做了优化，会依据加号次数调用不同参数个数的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;String.Concat&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。例如：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String str = str1 + str2 + str3 + str4;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　会被编译为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;String.Concat(str1, str2, str3, str4)</span></span><span style="line-height: 19px; font-family: 宋体; ">。该方法内部会计算总的</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;<span lang="EN-US" style="line-height: 19px; ">String&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">长度，仅分配一次，并不会如通常想象的那样分配三次。作为一个经验值，当字符串连接操作达到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;10&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">次以上时，则应该使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;StringBuilder</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　这里有一个细节应注意：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">StringBuilder&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">内部</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的缺省值为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;16&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">，这个值实在太小。按</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;StringBuilder&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的使用场景，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">肯定得重新分配。经验值一般用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;256&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">作为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的初值。当然，如果能计算出最终生成字符串长度的话，则应该按这个值来设定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的初值。使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;new StringBuilder(256)&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">就将</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Buffer&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的初始长度设为了</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">256</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297411" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.2.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免不必要的调用</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;ToUpper&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">或</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;ToLower&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">方法</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String</span></span><span style="line-height: 19px; font-family: 宋体; ">是不变类，调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ToUpper</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ToLower</span></span><span style="line-height: 19px; font-family: 宋体; ">方法都会导致创建一个新的字符串。如果被频繁调用，将导致频繁创建字符串对象。这违背了前面讲到的&#8220;避免频繁创建对象&#8221;这一基本原则。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　例如，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">bool.Parse</span></span><span style="line-height: 19px; font-family: 宋体; ">方法本身已经是忽略大小写的，调用时不要调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ToLower</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　另一个非常普遍的场景是字符串比较。高效的做法是使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Compare&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法，这个方法可以做大小写忽略的比较，并且不会创建新字符串。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　例：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;const string C_VALUE = “COMPARE”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">if (String.Compare(sVariable, C_VALUE, true) == 0)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Console.Write(“SAME”);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　还有一种情况是使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;HashTable&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的时候，有时候无法保证传递</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;key&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的大小写是否符合预期，往往会把</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;key&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">强制转换到大写或小写方法。实际上</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;HashTable&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">有不同的构造形式，完全支持采用忽略大小写的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;key: new HashTable(StringComparer.OrdinalIgnoreCase)</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297412" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.2.3</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">最快的空串比较方法</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　将</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String</span></span><span style="line-height: 19px; font-family: 宋体; ">对象的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Length</span></span><span style="line-height: 19px; font-family: 宋体; ">属性与</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">0</span></span><span style="line-height: 19px; font-family: 宋体; ">比较是最快的方法：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">if (str.Length == 0)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　其次是与</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String.Empty</span></span><span style="line-height: 19px; font-family: 宋体; ">常量或空串比较：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">if (str == String.Empty)</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">if (str == “”)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　注：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">在编译时会将程序集中声明的所有字符串常量放到保留池中（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">intern pool</span></span><span style="line-height: 19px; font-family: 宋体; ">），相同常量不会重复分配。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-3-nbsp-多线程"><a href="#1-3-nbsp-多线程" class="headerlink" title="1.3&nbsp;多线程"></a><a name="_Toc220297413" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.3&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">多线程</span></span></span></h2><p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297414" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.3.1</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">线程同步</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　线程同步是编写多线程程序需要首先考虑问题。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">为同步提供了</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Monitor</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Mutex</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">AutoResetEvent&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ManualResetEvent&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">对象来分别包装</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Win32&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的临界区、互斥对象和事件对象这几种基础的同步机制。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">还提供了一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">lock</span></span><span style="line-height: 19px; font-family: 宋体; ">语句，方便使用，编译器会自动生成适当的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Monitor.Enter&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Monitor.Exit&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">调用。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.1&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">同步粒度</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　同步粒度可以是整个方法，也可以是方法中某一段代码。为方法指定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;MethodImplOptions.Synchronized&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">属性将标记对整个方法同步。例如：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">[MethodImpl(MethodImplOptions.Synchronized)]</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public static SerialManager GetInstance()</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if (instance == null )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">instance = new SerialManager();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return instance;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">通常情况下，应减小同步的范围，使系统获得更好的性能。简单将整个方法标记为同步不是一个好主意，除非能确定方法中的每个代码都需要受同步保护。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.2&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">同步策略</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;lock&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">进行同步，同步对象可以选择</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Type</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">this&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">或为同步目的专门构造的成员变量。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　避免锁定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type</span></span><span style="line-height: 19px; font-family: 宋体; ">&#9733;</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　锁定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type</span></span><span style="line-height: 19px; font-family: 宋体; ">对象会影响同一进程中所有</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">AppDomain</span></span><span style="line-height: 19px; font-family: 宋体; ">该类型的所有实例，这不仅可能导致严重的性能问题，还可能导致一些无法预期的行为。这是一个很不好的习惯。即便对于一个只包含</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">static</span></span><span style="line-height: 19px; font-family: 宋体; ">方法的类型，也应额外构造一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">static</span></span><span style="line-height: 19px; font-family: 宋体; ">的成员变量，让此成员变量作为锁定对象。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　避免锁定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;this</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　锁定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;this&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">会影响该实例的所有方法。假设对象</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;<span lang="EN-US" style="line-height: 19px; ">obj&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">有</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;A&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;B&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">两个方法，其中</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;A&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;lock(this)&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">对方法中的某段代码设置同步保护。现在，因为某种原因，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">B&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法也开始使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;lock(this)&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">来设置同步保护了，并且可能为了完全不同的目的。这样，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">A&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法就被干扰了，其行为可能无法预知。所以，作为一种良好的习惯，建议避免使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;lock(this)&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">这种方式。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　使用为同步目的专门构造的成员变量</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　这是推荐的做法。方式就是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;new&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;object&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">对象，</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">该对象仅仅用于同步目的。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　如果有多个方法都需要同步，并且有不同的目的，那么就可以为些分别建立几个同步成员变量。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 19px; ">1.3.1</span><span lang="EN-US" style="line-height: 19px; ">.4&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">集合同步</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">为各种集合类型提供了两种方便的同步机制：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Synchronized&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">包装器和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;SyncRoot&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">属性。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">// Creates and initializes a new ArrayList</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">ArrayList myAL = new ArrayList();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">myAL.Add( “ The “ );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">myAL.Add( “ quick “ );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">myAL.Add( “ brown “ );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">myAL.Add( “ fox “ );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">// Creates a synchronized wrapper around the ArrayList</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">ArrayList mySyncdAL = ArrayList.Synchronized(myAL);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Synchronized&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法会返回一个可保证所有操作都是线程安全的相同集合对象。考虑</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;mySyncdAL[0] = mySyncdAL[0] + “test”&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">这一语句，读和写一共要用到两个锁。一般讲，效率不高。推荐使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;SyncRoot&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">属性，可以做比较精细的控制。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297415" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.3.2</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;ThreadStatic&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">替代</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;NameDataSlot&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">&#9733;</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　存取</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;NameDataSlot&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Thread.GetData&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Thread.SetData&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法需要线程同步，涉及两个锁：一个是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;LocalDataStore.SetData&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法需要在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;AppDomain&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">一级加锁，另一个是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ThreadNative.GetDomainLocalStore&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法需要在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Process&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">一级加锁。如果一些底层的基础服务使用了</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;NameDataSlot</span></span><span style="line-height: 19px; font-family: 宋体; ">，将导致系统出现严重的伸缩性问题。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　规避这个问题的方法是使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ThreadStatic&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">变量。示例如下：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public sealed class InvokeContext</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">[ThreadStatic]</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">private static InvokeContext current;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">private Hashtable maps = new Hashtable();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><a name="_Toc220297416" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.3.3</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">多线程编程技巧</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.3.3</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.1&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Double Check&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">技术创建对象</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">internal IDictionary KeyTable</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">get</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if ( this ._keyTable == null )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">lock ( base ._lock)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if ( this ._keyTable == null )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">this ._keyTable = new Hashtable();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return this ._keyTable;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">创建单例对象是很常见的一种编程情况。一般在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;lock&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">语句后就会直接创建对象了，但这不够安全。因为在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;lock&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">锁定对象之前，可能已经有多个线程进入到了第一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;if&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">语句中。如果不加第二个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;if&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">语句，则单例对象会被重复创建，新的实例替代掉旧的实例。如果单例对象中已有数据不允许被破坏或者别的什么原因，则应考虑使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Double Check&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">技术。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-4-nbsp-类型系统"><a href="#1-4-nbsp-类型系统" class="headerlink" title="1.4&nbsp;类型系统"></a><a name="_Toc220297417" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.4&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">类型系统</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297418" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.4.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免无意义的变量初始化动作</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CLR</span></span><span style="line-height: 19px; font-family: 宋体; ">保证所有对象在访问前已初始化，其做法是将分配的内存清零。因此，不需要将变量重新初始化为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">0</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">false</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">null</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　需要注意的是：方法中的局部变量不是从堆而是从栈上分配，所以</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">不会做清零工作。如果使用了未赋值的局部变量，编译期间即会报警。不要因为有这个印象而对所有类的成员变量也做赋值动作，两者的机理完全不同！</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297419" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.4.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;ValueType&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">和</span></span><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;ReferenceType</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 19px; ">1.4.2</span><span lang="EN-US" style="line-height: 19px; ">.1&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">以引用方式传递值类型参数</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　值类型从调用栈分配，引用类型从托管堆分配。当值类型用作方法参数时，默认会进行参数值复制，这抵消了值类型分配效率上的优势。作为一项基本技巧，以引用方式传递值类型参数可以提高性能。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.4.2</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.2&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ValueType&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">提供</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Equals&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.net&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">默认实现的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ValueType.Equals&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法使用了反射技术，依靠反射来获得所有成员变量值做比较，这个效率极低。如果我们编写的值对象其</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Equals&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法要被用到（例如将值对象放到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;HashTable&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">中），那么就应该重载</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Equals&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public struct Rectangle</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public double Length;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public double Breadth;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public override bool Equals ( object ob)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if (ob is Rectangle)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return Equels ((Rectangle)ob))</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">else</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return false ;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">private bool Equals (Rectangle rect)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return this .Length == rect.Length &amp;&amp; this .Breadth == rect.Breach;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 19px; ">1.4.2</span><span lang="EN-US" style="line-height: 19px; ">.3&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">避免装箱和拆箱</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">可以在值类型和引用类型之间自动转换，方法是装箱和拆箱。装箱需要从堆上分配对象并拷贝值，有一定性能消耗。如果这一过程发生在循环中或是作为底层方法被频繁调用，则应该警惕累计的效应。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　一种经常的情形出现在使用集合类型时。例如：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">ArrayList al = new ArrayList();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">for ( int i = 0 ; i &lt; 1000 ; i ++ )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">al.Add(i); // Implicitly boxed because Add() takes an object</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">int f = ( int )al[ 0 ]; // The element is unboxed</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">但是得当心！如果你像使用引用类型那么频繁的使用一个值类型的话，值类型的优势会很快被耗尽。比如，把一个值类型压到一个含有对象类型的群集。这叫做装箱，很耗用处理器周期，尤其是当你的代码在把它作为值（对它进行数学运算）和把它作为引用之间来回运行时。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297420" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.4.3</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">尽可能使用最合适的类型</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">&#8226;</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">尽可能使用最合适的类型来描述数据，从而减少类型转换。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">&#8226;</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">使用泛型来创建群集和其它的数据结构，这样，在运行时，它们就可以被实例化来存储刚好合适的类型。这节省了装箱</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">/</span></span><span style="line-height: 19px; font-family: 宋体; ">拆箱和类型转换的时间。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">&#8226;</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">中使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">as,</span></span><span style="line-height: 19px; font-family: 宋体; ">而不是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">is</span></span><span style="line-height: 19px; font-family: 宋体; ">。关键字</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">is</span></span><span style="line-height: 19px; font-family: 宋体; ">用来查看引用是否可以被作为某个具体的类型，但是并不返回转换到这个类型的引用。所以，通常当你从</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">is</span></span><span style="line-height: 19px; font-family: 宋体; ">获得一个正的结果时，你首先应该</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">cast</span></span><span style="line-height: 19px; font-family: 宋体; ">&#8212;&#8212;有效地执行两次</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">cast</span></span><span style="line-height: 19px; font-family: 宋体; ">。采用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">as</span></span><span style="line-height: 19px; font-family: 宋体; ">关键词时，如果可用，则返回</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">cast</span></span><span style="line-height: 19px; font-family: 宋体; ">为新类型的引用；否则返回</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">null</span></span><span style="line-height: 19px; font-family: 宋体; ">。你可以查看</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">null</span></span><span style="line-height: 19px; font-family: 宋体; ">然后做你喜欢做的事情。整体来说，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">As</span></span><span style="line-height: 19px; font-family: 宋体; ">方法要比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">is</span></span><span style="line-height: 19px; font-family: 宋体; ">方法快</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">50%</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<h2 id="1-5-nbsp-异常处理"><a href="#1-5-nbsp-异常处理" class="headerlink" title="1.5&nbsp;异常处理"></a><a name="_Toc220297421" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.5&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">异常处理</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　异常也是现代语言的典型特征。与传统检查错误码的方式相比，异常是强制性的（不依赖于是否忘记了编写检查错误码的代码）、强类型的、并带有丰富的异常信息（例如调用栈）。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297422" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.5.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">不要吃掉异常&#9733;</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　关于异常处理的最重要原则就是：不要吃掉异常。这个问题与性能无关，但对于编写健壮和易于排错的程序非常重要。这个原则换一种说法，就是不要捕获那些你不能处理的异常。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　吃掉异常是极不好的习惯，因为你消除了解决问题的线索。一旦出现错误，定位问题将非常困难。除了这种完全吃掉异常的方式外，只将异常信息写入日志文件但并不做更多处理的做法也同样不妥。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297423" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.5.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">不要吃掉异常信息&#9733;</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　有些代码虽然抛出了异常，但却把异常信息吃掉了。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　为异常披露详尽的信息是程序员的职责所在。如果不能在保留原始异常信息含义的前提下附加更丰富和更人性化的内容，那么让原始的异常信息直接展示也要强得多。千万不要吃掉异常。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297424" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.5.3</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免不必要的抛出异常</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　抛出异常和捕获异常属于消耗比较大的操作，在可能的情况下，应通过完善程序逻辑避免抛出不必要不必要的异常。与此相关的一个倾向是利用异常来控制处理逻辑。尽管对于极少数的情况，这可能获得更为优雅的解决方案，但通常而言应该避免。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297425" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.5.4</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免不必要的重新抛出异常</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　如果是为了包装异常的目的（即加入更多信息后包装成新异常），那么是合理的。但是有不少代码，捕获异常没有做任何处理就再次抛出，这将无谓地增加一次捕获异常和抛出异常的消耗，对性能有伤害。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297426" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.5.5</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">捕获指定的异常，不要使用通用的</span></span><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">System.Exception.</span></span></span><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span style="line-height: 19px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">避免</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">try</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">catch(Exception exc)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">推荐</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">try</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">catch(System.NullReferenceException exc)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">catch(System.ArgumentOutOfRangeException exc)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">catch(System.InvalidCastException exc)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297427" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">1.5.6</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">要在</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">finally</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">里释放占用的资源</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Try…catch…finally</span></span><span style="line-height: 19px; font-family: 宋体; ">时，</span><span style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">要在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">finally</span></span><span style="line-height: 19px; font-family: 宋体; ">里释放占用的资源如连接，文件流等，不然在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Catch</span></span><span style="line-height: 19px; font-family: 宋体; ">到错误后占用的资源不能释放。</span><span lang="EN-US" style="line-height: 19px; "></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">try</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">…</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">catch</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{…}</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">finally</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">conntion.close()</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-6-nbsp-反射"><a href="#1-6-nbsp-反射" class="headerlink" title="1.6&nbsp;反射"></a><a name="_Toc220297428" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.6&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">反射</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　反射是一项很基础的技术，它将编译期间的静态绑定转换为延迟到运行期间的动态绑定。在很多场景下（特别是类框架的设计），可以获得灵活易于扩展的架构。但带来的问题是与静态绑定相比，动态绑定会对性能造成较大的伤害。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297429" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.6.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">反射分类</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">type comparison&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">：类型判断，主要包括</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;is&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;typeof&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">两个操作符及对象实例上的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;GetType&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">调用。这是最轻型的消耗，可以无需考虑优化问题。注意</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;typeof&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">运算符比对象实例上的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;GetType&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">方法要快，只要可能则优先使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;typeof&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">运算符。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">member enumeration&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">：</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">成员枚举，用于访问反射相关的元数据信息，例如</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Assembly.GetModule</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Module.GetType</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type</span></span><span style="line-height: 19px; font-family: 宋体; ">对象上的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">IsInterface</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">IsPublic</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetMethod</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetMethods</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetProperty</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetProperties</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetConstructor</span></span><span style="line-height: 19px; font-family: 宋体; ">调用等。尽管元数据都会被</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CLR</span></span><span style="line-height: 19px; font-family: 宋体; ">缓存，但部分方法的调用消耗仍非常大，不过这类方法调用频度不会很高，所以总体看性能损失程度中等。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">member invocation</span></span><span style="line-height: 19px; font-family: 宋体; ">：成员调用，包括动态创建对象及动态调用对象方法，主要有</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Activator.CreateInstance</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type.InvokeMember</span></span><span style="line-height: 19px; font-family: 宋体; ">等。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297430" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.6.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">动态创建对象</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C#</span></span><span style="line-height: 19px; font-family: 宋体; ">主要支持</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;5&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">种动态创建对象的方式：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1. Type.InvokeMember</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2. ContructorInfo.Invoke</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3. Activator.CreateInstance(Type)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4. Activator.CreateInstance(assemblyName, typeName)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">5. Assembly.CreateInstance(typeName)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　最快的是方式</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;3&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">，与</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Direct Create&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">的差异在一个数量级之内，约慢</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;7&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">倍的水平。其他方式，至少在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;40&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">倍以上，最慢的是方式</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;4&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">，要慢三个数量级。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297431" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.6.3</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">动态方法调用</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　方法调用分为编译期的早期绑定和运行期的动态绑定两种，称为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Early-Bound Invocation</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Late-Bound Invocation</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Early-Bound Invocation</span></span><span style="line-height: 19px; font-family: 宋体; ">可细分为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Direct-call</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Interface-call</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Delegate-call</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Late-Bound Invocation</span></span><span style="line-height: 19px; font-family: 宋体; ">主要有</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type.InvokeMember</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">MethodBase.Invoke</span></span><span style="line-height: 19px; font-family: 宋体; ">，还可以通过使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">LCG</span></span><span style="line-height: 19px; font-family: 宋体; ">（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Lightweight Code Generation</span></span><span style="line-height: 19px; font-family: 宋体; ">）技术生成</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">IL</span></span><span style="line-height: 19px; font-family: 宋体; ">代码来实现动态调用。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　从测试结果看，相比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Direct Call</span></span><span style="line-height: 19px; font-family: 宋体; ">，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type.InvokeMember</span></span><span style="line-height: 19px; font-family: 宋体; ">要接近慢三个数量级；</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">MethodBase.Invoke</span></span><span style="line-height: 19px; font-family: 宋体; ">虽然比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type.InvokeMember</span></span><span style="line-height: 19px; font-family: 宋体; ">要快三倍，但比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Direct Call</span></span><span style="line-height: 19px; font-family: 宋体; ">仍慢</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">270</span></span><span style="line-height: 19px; font-family: 宋体; ">倍左右。可见动态方法调用的性能是非常低下的。我们的建议是：除非要满足特定的需求，否则不要使用！</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297432" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.6.4</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">推荐的使用原则</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　模式</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1</span></span><span style="line-height: 19px; font-family: 宋体; ">．</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">如果可能，则避免使用反射和动态绑定</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2</span></span><span style="line-height: 19px; font-family: 宋体; ">．</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">使用接口调用方式将动态绑定改造为早期绑定</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3</span></span><span style="line-height: 19px; font-family: 宋体; ">．</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Activator.CreateInstance(Type)</span></span><span style="line-height: 19px; font-family: 宋体; ">方式动态创建对象</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4</span></span><span style="line-height: 19px; font-family: 宋体; ">．</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">typeof</span></span><span style="line-height: 19px; font-family: 宋体; ">操作符代替</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetType</span></span><span style="line-height: 19px; font-family: 宋体; ">调用</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　反模式</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1</span></span><span style="line-height: 19px; font-family: 宋体; ">．</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">在已获得</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type</span></span><span style="line-height: 19px; font-family: 宋体; ">的情况下，却使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Assembly.CreateInstance(type.FullName)</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-7-nbsp-基本代码技巧"><a href="#1-7-nbsp-基本代码技巧" class="headerlink" title="1.7&nbsp;基本代码技巧"></a><a name="_Toc220297433" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.7&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">基本代码技巧</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　这里描述一些应用场景下，可以提高性能的基本代码技巧。对处于关键路径的代码，进行这类的优化还是很有意义的。普通代码可以不做要求，但养成一种好的习惯也是有意义的。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297434" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">循环写法</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　可以把循环的判断条件用局部变量记录下来。局部变量往往被编译器优化为直接使用寄存器，相对于普通从堆或栈中分配的变量速度快。如果访问的是复杂计算属性的话，提升效果将更明显。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for (int i = 0, j = collection.GetIndexOf(item); i &lt; j; i++)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　需要说明的是：这种写法对于</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CLR</span></span><span style="line-height: 19px; font-family: 宋体; ">集合类的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Count</span></span><span style="line-height: 19px; font-family: 宋体; ">属性没有意义，原因是编译器已经按这种方式做了特别的优化。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297435" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">拼装字符串</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　拼装好之后再删除是很低效的写法。有些方法其循环长度在大部分情况下为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1</span></span><span style="line-height: 19px; font-family: 宋体; ">，这种写法的低效就更为明显了：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public static string ToString(MetadataKey entityKey)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">string str = “” ;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">object [] vals = entityKey.values;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">for ( int i = 0 ; i &lt; vals.Length; i ++ )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">str += “ , “ + vals[i].ToString();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return str == “” ? “” : str.Remove( 0 , 1 );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">推荐下面的写法：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if (str.Length == 0 )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">str = vals[i].ToString();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">else</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">str += “ , “ + vals[i].ToString();</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">其实这种写法非常自然，而且效率很高，完全不需要用个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Remove</span></span><span style="line-height: 19px; font-family: 宋体; ">方法绕来绕去。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297436" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.3</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免两次检索集合元素</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　获取集合元素时，有时需要检查元素是否存在。通常的做法是先调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ContainsKey</span></span><span style="line-height: 19px; font-family: 宋体; ">（或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Contains</span></span><span style="line-height: 19px; font-family: 宋体; ">）方法，然后再获取集合元素。这种写法非常符合逻辑。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　但如果考虑效率，可以先直接获取对象，然后判断对象是否为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">null</span></span><span style="line-height: 19px; font-family: 宋体; ">来确定元素是否存在。对于</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">，这可以节省一次</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">调用和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">n</span></span><span style="line-height: 19px; font-family: 宋体; ">次</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Equals</span></span><span style="line-height: 19px; font-family: 宋体; ">比较。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">如下面的示例：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">public IData GetItemByID(Guid id)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">IData data1 = null ;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if ( this .idTable.ContainsKey(id.ToString())</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">data1 = this .idTable[id.ToString()] as IData;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">return data1;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">其实完全可用一行代码完成：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">return this.idTable[id] as IData;</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297437" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.4</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免两次类型转换</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　考虑如下示例，其中包含了两处类型转换：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if (obj is SomeType)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">SomeType st = (SomeType)obj;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">st.SomeTypeMethod();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">效率更高的做法如下：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">SomeType st = obj as SomeType;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">if (st != null )</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">st.SomeTypeMethod();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297438" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.5</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">为字符串容器声明常量，不要直接把字符封装在双引号</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">“ “</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">里面。</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span style="line-height: 19px; ">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">避免</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">MyObject obj = new MyObject();</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">obj.Status = “ACTIVE”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">推荐</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">const string C_STATUS = “ACTIVE”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">MyObject obj = new MyObject();</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">obj.Status = C_STATUS;</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span><a name="_Toc220297439" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.6</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">用</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">StringBuilder</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">代替使用字符串连接符</span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">&#8220;</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">+</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">&#8221;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">避免</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String sXML = “ “;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sXML += “”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sXML += “Data”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sXML += “”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sXML += “”;</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">推荐</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">StringBuilder sbXML = new StringBuilder();</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sbXML.Append(“ “);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sbXML.Append(“”);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sbXML.Append(“Data”);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sbXML.Append(“”);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sbXML.Append(“”);</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">　</span><a name="_Toc220297440" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">1.7.7</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">避免在循环体里声明变量，</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">应该在循环体外声明变量，在循环体里初始化。</span><span lang="EN-US" style="line-height: 19px; "></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span style="line-height: 19px; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">避免</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for(int i=0; i&lt;10; i++)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SomeClass objSC = new SomeClass();</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">推荐</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SomeClass objSC = null;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for(int i=0; i&lt;10; i++)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">objSC = new SomeClass();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span></p>
<h2 id="1-8-Hashtable"><a href="#1-8-Hashtable" class="headerlink" title="1.8 Hashtable"></a><a name="_Toc220297441" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.8 Hashtable</span></span></a></h2><h3 id="1-8-1-nbsp-Hashtable机理"><a href="#1-8-1-nbsp-Hashtable机理" class="headerlink" title="1.8.1&nbsp;Hashtable机理　"></a><a name="_Toc220297442" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="font-size: large; "><span style="font-family: 'Times New Roman'; "><span><span lang="EN-US">1.8.1</span></span><span><span lang="EN-US">&nbsp;Hashtable</span></span></span><span><span style="font-family: 宋体; ">机理</span></span><span style="font-family: 宋体; ">　</span></span></h3><p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">是一种使用非常频繁的基础集合类型。需要理解影响</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">的效率有两个因素：一是散列码（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">方法），二是等值比较（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Equals</span></span><span style="line-height: 19px; font-family: 宋体; ">方法）。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">首先使用键的散列码将对象分布到不同的存储桶中，随后在该特定的存储桶中使用键的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Equals</span></span><span style="line-height: 19px; font-family: 宋体; ">方法进行查找。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　良好的散列码是第一位的因素，最理想的情况是每个不同的键都有不同的散列码。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Equals</span></span><span style="line-height: 19px; font-family: 宋体; ">方法也很重要，因为散列只需要做一次，而存储桶中查找键可能需要做多次。从实际经验看，使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">时，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Equals</span></span><span style="line-height: 19px; font-family: 宋体; ">方法的消耗一般会占到一半以上。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">System.Object</span></span><span style="line-height: 19px; font-family: 宋体; ">类提供了默认的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">实现，使用对象在内存中的地址作为散列码。我们遇到过一个用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">来缓存对象的例子，每次根据传递的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">OQL</span></span><span style="line-height: 19px; font-family: 宋体; ">表达式构造出一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExpressionList</span></span><span style="line-height: 19px; font-family: 宋体; ">对象，再调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">QueryCompiler</span></span><span style="line-height: 19px; font-family: 宋体; ">的方法编译得到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CompiledQuery</span></span><span style="line-height: 19px; font-family: 宋体; ">对象。以</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExpressionList</span></span><span style="line-height: 19px; font-family: 宋体; ">对象和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CompiledQuery</span></span><span style="line-height: 19px; font-family: 宋体; ">对象作为键值对存储到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">中。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExpressionList</span></span><span style="line-height: 19px; font-family: 宋体; ">对象没有重载</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">实现，其超类</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ArrayList</span></span><span style="line-height: 19px; font-family: 宋体; ">也没有，这样最后用的就是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">System.Object</span></span><span style="line-height: 19px; font-family: 宋体; ">类的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">实现。由于</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExpressionList</span></span><span style="line-height: 19px; font-family: 宋体; ">对象会每次构造，因此它的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">HashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">每次都不同，所以这个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CompiledQueryCache</span></span><span style="line-height: 19px; font-family: 宋体; ">根本就没有起到预想的作用。这个小小的疏漏带来了重大的性能问题，由于解析</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">OQL</span></span><span style="line-height: 19px; font-family: 宋体; ">表达式频繁发生，导致</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CompiledQueryCache</span></span><span style="line-height: 19px; font-family: 宋体; ">不断增长，造成服务器内存泄漏！解决这个问题的最简单方法就是提供一个常量实现，例如让散列码为常量</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">0</span></span><span style="line-height: 19px; font-family: 宋体; ">。虽然这会导致所有对象汇聚到同一个存储桶中，效率不高，但至少可以解决掉内存泄漏问题。当然，最终还是会实现一个高效的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">方法的。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　以上介绍这些</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">机理，主要是希望大家理解：如果使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Hashtable</span></span><span style="line-height: 19px; font-family: 宋体; ">，你应该检查一下对象是否提供了适当的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetHashCode</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Equals</span></span><span style="line-height: 19px; font-family: 宋体; ">方法实现。否则，有可能出现效率不高或者与预期行为不符的情况。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297443" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><strong><span style="line-height: 21px; "><span class="3Char" style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; font-family: 'Times New Roman'; ">1.8.2</span></span></span><span style="line-height: 21px; "><span class="3Char" style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; font-family: 'Times New Roman'; "><span style="line-height: 31px; ">&nbsp;&nbsp;</span></span></span></span><span style="line-height: 21px; "><span class="3Char" style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 宋体; ">使用</span></span></span></span><span style="line-height: 21px; "><span class="3Char" style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; font-family: 'Times New Roman'; ">HashTale</span></span></span><span style="line-height: 21px; "><span class="3Char" style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 宋体; ">代替其他字典集合类型的情形</span></span></span></span></strong><span style="line-height: 21px; "><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">：</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">其他字典集合类型</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">(</span></span><span style="line-height: 19px; font-family: 宋体; ">如</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">StringDictionary,NameValueCollection,HybridCollection)</span></span><span style="line-height: 19px; font-family: 宋体; ">，存放少量数据的时候可以使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">HashTable</span></span><span style="line-height: 19px; font-family: 宋体; ">　。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">很多非泛型集合类都有对应的泛型集合类，下面是常用的非泛型集合类以及对应的泛型集合类：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">非泛型集合类</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">泛型集合类</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">ArrayList List&lt;T&gt;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">HashTable DIctionary&lt;T&gt;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">Queue Queue&lt;T&gt;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">Stack Stack&lt;T&gt;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">SortedList SortedList&lt;T&gt;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span style="line-height: 19px; font-family: 宋体; ">我们用的比较多的非泛型集合类主要有</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;ArrayList</span></span><span style="line-height: 19px; font-family: 宋体; ">类</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;HashTable</span></span><span style="line-height: 19px; font-family: 宋体; ">类。我们经常用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">HashTable&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">来存储将要写入到数据库或者返回的信息，在这之间要不断的进行类型的转化，增加了系统装箱和拆箱的负担，如果我们操纵的数据类型相对确定的化</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;&nbsp;</span></span></span><span style="line-height: 19px; font-family: 宋体; ">用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Dictionary&lt;TKey,TValue&gt;&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">集合类来存储数据就方便多了，例如我们需要在电子商务网站中存储用户的购物车信息</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">(&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">商品名，对应的商品个数</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">)</span></span><span style="line-height: 19px; font-family: 宋体; ">时，完全可以用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;Dictionary&lt;string, int&gt;&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">来存储购物车信息，而不需要任何的类型转化。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-9-nbsp-nbsp-避免使用ArrayList。"><a href="#1-9-nbsp-nbsp-避免使用ArrayList。" class="headerlink" title="1.9&nbsp;&nbsp;避免使用ArrayList。"></a><a name="_Toc220297444" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-family: Arial; "><span style="font-size: large; ">1.9<span>&nbsp;&nbsp;</span></span></span></span></a><span style="font-size: large; "><span><span style="font-family: 黑体; ">避免使用</span><span lang="EN-US"><span style="font-family: Arial; ">ArrayList</span></span></span><span><span style="font-family: 黑体; ">。</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　因为任何对象添加到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ArrayList</span></span><span style="line-height: 19px; font-family: 宋体; ">都要封箱为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">System.Object</span></span><span style="line-height: 19px; font-family: 宋体; ">类型，从</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ArrayList</span></span><span style="line-height: 19px; font-family: 宋体; ">取出数据时，要拆箱回实际的类型。建议使用自定义的集合类型代替</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ArrayList</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.net 2.0</span></span><span style="line-height: 19px; font-family: 宋体; ">提供了一个新的类型，叫泛型，这是一个强类型，使用泛型集合就可以避免了封箱和拆箱的发生，提高了性能。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　</span></span></p>
<h2 id="1-10从XML对象读取数据"><a href="#1-10从XML对象读取数据" class="headerlink" title="1.10从XML对象读取数据"></a><a name="_Toc220297445" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.10</span></span></a><span style="font-size: large; "><span><span style="font-family: 黑体; ">从</span><span lang="EN-US"><span style="font-family: Arial; ">XML</span></span></span><span><span style="font-family: 黑体; ">对象读取数据</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　如果只是从</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XML</span></span><span style="line-height: 19px; font-family: 宋体; ">对象读取数据，用只读的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XPathDocument</span></span><span style="line-height: 19px; font-family: 宋体; ">代替</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XMLDocument,</span></span><span style="line-height: 19px; font-family: 宋体; ">可以提高性能</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "><span style="line-height: 19px; ">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">避免</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XmlDocument xmld = new XmlDocument();</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">xmld.LoadXml(sXML);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">txtName.Text = xmld.SelectSingleNode(“/packet/child”).InnerText;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">//</span></span><span style="line-height: 19px; font-family: 宋体; ">推荐</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XPathDocument xmldContext = new XPathDocument(new StringReader(oContext.Value));</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XPathNavigator xnav = xmldContext.CreateNavigator();</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">XPathNodeIterator xpNodeIter = xnav.Select(“packet/child”);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">iCount = xpNodeIter.Count;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">xpNodeIter = xnav.SelectDescendants(XPathNodeType.Element, false);</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">while(xpNodeIter.MoveNext())</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">{</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">sCurrValues += xpNodeIter.Current.Value+”~”;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">}</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-11-nbsp-避免使用递归调用和嵌套循环，"><a href="#1-11-nbsp-避免使用递归调用和嵌套循环，" class="headerlink" title="　1.11&nbsp;避免使用递归调用和嵌套循环，"></a><span style="font-family: 黑体; "><span style="font-size: large; ">　</span></span><a name="_Toc220297446" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.11&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">避免使用递归调用和嵌套循环，</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">使用他们会严重影响性能，在不得不用的时候才使用。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="1-12-nbsp-使用适当的Caching策略来提高性能"><a href="#1-12-nbsp-使用适当的Caching策略来提高性能" class="headerlink" title="　1.12&nbsp;使用适当的Caching策略来提高性能"></a><span style="font-family: 黑体; "><span style="font-size: large; ">　</span></span><a name="_Toc220297447" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">1.12&nbsp;</span></span></a><span style="font-size: large; "><span><span style="font-family: 黑体; ">使用适当的</span><span lang="EN-US"><span style="font-family: Arial; ">Caching</span></span></span><span><span style="font-family: 黑体; ">策略来提高性能</span></span></span></h2><h1 id="2-Ado-Net"><a href="#2-Ado-Net" class="headerlink" title="　2. Ado.Net"></a><span style="font-family: 宋体; "><span style="font-size: x-large; ">　</span></span><a name="_Toc220297448" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: x-large; font-family: 'Times New Roman'; ">2. Ado.Net</span></span></a></h1><p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="2-1-nbsp-应用Ado-net的一些思考原则"><a href="#2-1-nbsp-应用Ado-net的一些思考原则" class="headerlink" title="2.1&nbsp;应用Ado.net的一些思考原则"></a><a name="_Toc220297449" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">2.1&nbsp;</span></span></a><span style="font-size: large; "><span><span style="font-family: 黑体; ">应用</span><span lang="EN-US"><span style="font-family: Arial; ">Ado.net</span></span></span><span><span style="font-family: 黑体; ">的一些思考原则</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">根据数据使用的方式来设计数据访问层</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">缓存数据，避免不必要的操作</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用服务帐户进行连接</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">必要时申请，尽早释放</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">5.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">关闭可关闭的资源</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">6.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">减少往返</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">7.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">仅返回需要的数据</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">8.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">选择适当的事务类型</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">9.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用存储过程</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="2-2-Connection"><a href="#2-2-Connection" class="headerlink" title="2.2 Connection"></a><a name="_Toc220297450" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">2.2 Connection</span></span></a></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　数据库连接是一种共享资源，并且打开和关闭的开销较大。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Ado.net</span></span><span style="line-height: 19px; font-family: 宋体; ">默认启用了连接池机制，关闭连接不会真的关闭物理连接，而只是把连接放回到连接池中。因为池中共享的连接资源始终是有限的，如果在使用连接后不尽快关闭连接，那么就有可能导致申请连接的线程被阻塞住，影响整个系统的性能表现。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297451" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.2.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">在方法中打开和关闭连接</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　这个原则有几层含义：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">主要目的是为了做到必要时申请和尽早释放</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">不要在类的构造函数中打开连接、在析构函数中释放连接。因为这将依赖于垃圾回收，而垃圾回收只受内存影响，回收时机不定</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">不要在方法之间传递连接，这往往导致连接保持打开的时间过长</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">这里强调一下在方法之间传递连接的危害：曾经在压力测试中遇到过一个测试案例，当增大用户数的时候，这个案例要比别的案例早很久就用掉连接池中的所有连接。经分析，就是因为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">A</span></span><span style="line-height: 19px; font-family: 宋体; ">方法把一个打开的连接传递到了</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">B</span></span><span style="line-height: 19px; font-family: 宋体; ">方法，而</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">B</span></span><span style="line-height: 19px; font-family: 宋体; ">方法又调用了一个自行打开和关闭连接的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">C</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">A</span></span><span style="line-height: 19px; font-family: 宋体; ">方法的整个运行期间，它至少需要占用两条连接才能够成功工作，并且其中的一条连接占用时间还特别长，所以造成连接池资源紧张，影响了整个系统的可伸缩性！</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297452" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">2.2.2</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">显式关闭连接</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Connection</span></span><span style="line-height: 19px; font-family: 宋体; ">对象本身在垃圾回收时可以被关闭，而依赖垃圾回收是很不好的策略。推荐使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">using</span></span><span style="line-height: 19px; font-family: 宋体; ">语句显式关闭连接，如下例：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">using (SqlConnection conn = new SqlConnection(connString))</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">conn.Open();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">} // Dispose is automatically called on the conn variable here</span></span></p>
<p><a name="_Toc220297453" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">2.2.3</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">确保连接池启用</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Ado.net</span></span><span style="line-height: 19px; font-family: 宋体; ">是为每个不同的连接串建立连接池，因此应该确保连接串不会出现与具体用户相关的信息。另外，要注意连接串是大小写敏感的。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297454" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.2.4</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">不要缓存连接</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　例如，把连接缓存到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Session</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Application</span></span><span style="line-height: 19px; font-family: 宋体; ">中。在启用连接池的情况下，这种做法没有任何意义。</span></span></p>
<h2 id="2-3-Command"><a href="#2-3-Command" class="headerlink" title="　2.3 Command"></a><span style="font-size: 22pt; line-height: 50px; font-family: 黑体; ">　</span><a name="_Toc220297455" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">2.3 Command</span></span></a></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297456" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.3.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">ExecuteScalar</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">和</span></span><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">ExecuteNonQuery</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果想返回像</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Count(*)</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Sum(Price)</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Avg(Quantity)</span></span><span style="line-height: 19px; font-family: 宋体; ">那样的单值，可以使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteScalar</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteScalar</span></span><span style="line-height: 19px; font-family: 宋体; ">返回第一行第一列的值，将结果集作为标量值返回。因为单独一步就能完成，所以</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteScalar</span></span><span style="line-height: 19px; font-family: 宋体; ">不仅简化了代码，还提高了性能。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用不返回行的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SQL</span></span><span style="line-height: 19px; font-family: 宋体; ">语句时，例如修改数据（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">INSERT</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">UPDATE</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DELETE</span></span><span style="line-height: 19px; font-family: 宋体; ">）或仅返回输出参数或返回值，请使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteNonQuery</span></span><span style="line-height: 19px; font-family: 宋体; ">。这避免了用于创建空</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">的任何不必要处理。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297457" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.3.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用</span></span><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">Prepare</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　当需要重复执行同一</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SQL</span></span><span style="line-height: 19px; font-family: 宋体; ">语句多次，可考虑使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Prepare</span></span><span style="line-height: 19px; font-family: 宋体; ">方法提升效率。需要注意的是，如果只是执行一次或两次，则完全没有必要。例如：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.CommandText = “insert into Table1 ( Col1, Col2 ) values ( @val1, @val2 )”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters.Add( “@val1”, SqlDbType.Int, 4, “Col1” );</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cms.Parameters.Add( “@val2”, SqlDbType.NChar, 50, “Col2”);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters[0].Value = 1;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters[1].Value = “XXX”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Prepare();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.ExecuteNonQuery();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters[0].Value = 2;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters[1].Value = “YYY”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.ExecuteNonQuery();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters[0].Value = 3;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.Parameters[1].Value = “ZZZ”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.ExecuteNonQuery();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297458" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">2.3.3</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用绑定变量</span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">&#9733;</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SQL</span></span><span style="line-height: 19px; font-family: 宋体; ">语句需要先被编译成执行计划，然后再执行。如果使用绑定变量的方式，那么这个执行计划就可以被后续执行的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SQL</span></span><span style="line-height: 19px; font-family: 宋体; ">语句所复用。而如果直接把参数合并到了</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SQL</span></span><span style="line-height: 19px; font-family: 宋体; ">语句中，由于参数值千变万化，执行计划就难以被复用了。例如上面</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Prepare</span></span><span style="line-height: 19px; font-family: 宋体; ">一节给出的示例，如果把参数值直接写到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">insert</span></span><span style="line-height: 19px; font-family: 宋体; ">语句中，那么上面的四次调用将需要编译四次执行计划。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　为避免这种情况造成性能损失，要求一律使用绑定变量方式。</span></span></p>
<h2 id="2-4-DataReader"><a href="#2-4-DataReader" class="headerlink" title="　2.4 DataReader"></a><span style="font-family: 黑体; "><span style="font-size: large; ">　</span></span><a name="_Toc220297459" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">2.4 DataReader</span></span></a></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">最适合于访问只读的单向数据集。与</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataSet</span></span><span style="line-height: 19px; font-family: 宋体; ">不同，数据集并不全部在内存中，而是随不断发出的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">read</span></span><span style="line-height: 19px; font-family: 宋体; ">请求，一旦发现数据缓冲区中的数据均被读取，则从数据源传输一个数据缓冲区大小的数据块过来。另外，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">保持连接，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataSet</span></span><span style="line-height: 19px; font-family: 宋体; ">则与连接断开。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297460" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.4.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">显式关闭</span></span><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">DataReader</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　与连接类似，也需要显式关闭</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">。另外，如果与</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">关联的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Connection</span></span><span style="line-height: 19px; font-family: 宋体; ">仅为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">服务的话，可考虑使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Command</span></span><span style="line-height: 19px; font-family: 宋体; ">对象的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ExecuteReader(CommandBehavior.CloseConnection)</span></span><span style="line-height: 19px; font-family: 宋体; ">方式。这可以保证当</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataReader</span></span><span style="line-height: 19px; font-family: 宋体; ">关闭时，同时自动关闭</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Connection</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297461" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.4.2</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">用索引号访问代替名称索引号访问属性</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　从</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Row</span></span><span style="line-height: 19px; font-family: 宋体; ">中访问某列属性，使用索引号的方式比使用名称方式有细微提高。如果会被频繁调用，例如在循环中，那么可考虑此类优化。示例如下：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.CommandText = “select Col1, Col2 from Table1” ;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">SqlDataReader dr = cmd.ExecuteReader();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">int col1 = dr.GetOrdinal(“Col1”);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">int col2 = dr.GetOrdinal(“Col2”);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">while (dr.Read())</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">Console.WriteLine( dr[col1] + “_” + dr[col2]);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><a name="_Toc220297462" style="text-decoration: none; color: #336699; width: 20px; height: 20px; text-indent: 20px; background-repeat: no-repeat; background-image: url(http://www.cnblogs.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=anchor.gif); "></a><span style="line-height: 21px; font-family: 'Times New Roman'; "><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">2.4.3</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用类型化方法访问属性</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　从</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Row</span></span><span style="line-height: 19px; font-family: 宋体; ">中访问某列属性，用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetString</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetInt32</span></span><span style="line-height: 19px; font-family: 宋体; ">这种显式指明类型的方法，其效率较通用的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">GetValue</span></span><span style="line-height: 19px; font-family: 宋体; ">方法有细微提高，因为不需要做类型转换。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297463" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.4.4</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用多数据集</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　部分场景可以考虑一次返回多数据集来降低网络交互次数，提升效率。示例如下：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">cmd.CommandText = “StoredProcedureName”; // The stored procedure returns multiple result sets.</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">SqlDataReader dr = cmd.ExecuteReader();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">while (dr.read())</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">// read first result set</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">dr.NextResult();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">while (dr.read())</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">//</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="2-5-DataSet"><a href="#2-5-DataSet" class="headerlink" title="2.5 DataSet"></a><a name="_Toc220297464" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">2.5 DataSet</span></span></a></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297465" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.5.1</span></span></a><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span></span><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">利用索引加快查找行的效率</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　如果需要反复查找行，建议增加索引。有两种方式：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">设置</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataTable</span></span><span style="line-height: 19px; font-family: 宋体; ">的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">PrimaryKey</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　适用于按</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">PrimaryKey</span></span><span style="line-height: 19px; font-family: 宋体; ">查找行的情况。注意此时应调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataTable.Rows.Find</span></span><span style="line-height: 19px; font-family: 宋体; ">方法，一般惯用的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Select</span></span><span style="line-height: 19px; font-family: 宋体; ">方法不能利用索引。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><a name="_Toc220297466" style="text-decoration: none; color: #336699; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span></a><span style="line-height: 21px; "><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">使用</span></span><span style="line-height: 21px; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">DataView</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　适用于按</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Non-PrimaryKey</span></span><span style="line-height: 19px; font-family: 宋体; ">查找行的情况。可为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataTable</span></span><span style="line-height: 19px; font-family: 宋体; ">创建一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DataView</span></span><span style="line-height: 19px; font-family: 宋体; ">，并通过</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">SortOrder</span></span><span style="line-height: 19px; font-family: 宋体; ">参数指示建立索引。此后使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Find</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">FindRows</span></span><span style="line-height: 19px; font-family: 宋体; ">查找行。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h1 id="3-ASP-NET"><a href="#3-ASP-NET" class="headerlink" title="3.ASP.NET"></a><a name="_Toc220297467" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: x-large; font-family: 'Times New Roman'; ">3.ASP.NET</span></span></a></h1><h2 id="3-1-nbsp-减少往返行程（Reduce-Round-Trips）"><a href="#3-1-nbsp-减少往返行程（Reduce-Round-Trips）" class="headerlink" title="3.1&nbsp;减少往返行程（Reduce Round Trips）"></a><a name="_Toc220297468" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.1&nbsp;</span></span></a><span style="font-size: large; "><span><span style="font-family: 黑体; ">减少往返行程（</span><span lang="EN-US"><span style="font-family: Arial; ">Reduce Round Trips</span></span></span><span><span style="font-family: 黑体; ">）</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用下面的方法可以减少</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">服务器和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Browser</span></span><span style="line-height: 19px; font-family: 宋体; ">之间的往返行程：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Browser</span></span><span style="line-height: 19px; font-family: 宋体; ">启用缓存</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果呈现的内容是静态的或变化周期较长，应启用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Browser</span></span><span style="line-height: 19px; font-family: 宋体; ">缓存，避免发出冗余的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">http</span></span><span style="line-height: 19px; font-family: 宋体; ">请求。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">缓冲页面输出</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果可能，则尽量缓冲页面输出，处理结束后再一次传送到客户端，这可以避免频繁传递小块内容所造成的多次网络交互。由于这种方式在页面处理结束之前客户端无法看到页面内容，因此如果一个页面的尺寸较大的话，可考虑使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Response.Flush</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。该方法强制输出迄今为止在缓冲区中的内容，你应当采用合理的算法控制调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Response.Flush</span></span><span style="line-height: 19px; font-family: 宋体; ">方法的次数。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Server.Transfer</span></span><span style="line-height: 19px; font-family: 宋体; ">重定向请求</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Server.Transfer</span></span><span style="line-height: 19px; font-family: 宋体; ">方法重定向请求优于</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Response.Redirect</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。原因是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Response.Redirect</span></span><span style="line-height: 19px; font-family: 宋体; ">会向</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Broswer</span></span><span style="line-height: 19px; font-family: 宋体; ">回送一个响应头，在响应头中指出重定向的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">URL</span></span><span style="line-height: 19px; font-family: 宋体; ">，之后</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Brower</span></span><span style="line-height: 19px; font-family: 宋体; ">使用新的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">URL</span></span><span style="line-height: 19px; font-family: 宋体; ">重新发出请求。而</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Server.Transfer</span></span><span style="line-height: 19px; font-family: 宋体; ">方法直接是一个简单的服务端调用，完全没有这些开销！</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　需要注意</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Server.Transfer</span></span><span style="line-height: 19px; font-family: 宋体; ">有局限性：第一，它会跳过安全检查；第二，只适用于在同一</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">应用内的页面间跳转。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="3-2-nbsp-避免阻塞和长时间的作业"><a href="#3-2-nbsp-避免阻塞和长时间的作业" class="headerlink" title="3.2&nbsp;避免阻塞和长时间的作业"></a><a name="_Toc220297469" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.2&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">避免阻塞和长时间的作业</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果需要运行阻塞或长时间运行的操作，可以考虑使用异步调用的机制，以便</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">服务器能够继续处理其它的请求。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用异步方式调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">服务和远程对象</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　只要有可能就要避免在请求的处理过程中对</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">服务和远程对象的同步调用，因为它占用的是的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ASP.NET&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">线程池中的工作线程，这将直接影响</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">服务器响应其它请求的能力。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">考虑给不需要返回值的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web</span></span><span style="line-height: 19px; font-family: 宋体; ">方法或远程对象的方法添加</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">OneWay</span></span><span style="line-height: 19px; font-family: 宋体; ">属性</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　这种模式能让</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web Server</span></span><span style="line-height: 19px; font-family: 宋体; ">调用之后就立即返回。可根据实际情况决定是否使用这种方法。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用工作队列</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　将作业提交到服务器上的工作队列中。客户端通过发送请求来轮询作业的执行结果。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="3-3-nbsp-使用缓存"><a href="#3-3-nbsp-使用缓存" class="headerlink" title="3.3&nbsp;使用缓存"></a><a name="_Toc220297470" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.3&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">使用缓存</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　缓存能在很大程度上决定</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ASP.NET</span></span><span style="line-height: 19px; font-family: 宋体; ">应用的最终性能。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Asp.net</span></span><span style="line-height: 19px; font-family: 宋体; ">支持页面输出缓存和页面部分缓存，并提供</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Cache API</span></span><span style="line-height: 19px; font-family: 宋体; ">，供应用程序缓存自己的数据。是否使用缓存可考虑下面的要点：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">识别创建与访问代价较大的数据</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">评估需要缓存数据的易变性</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">评估数据的使用频次</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">将要缓存数据中易变数据和不变数据分离，只缓存不变数据</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">5.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">选择合适的缓存机制（除</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Asp.net Cache</span></span><span style="line-height: 19px; font-family: 宋体; ">外，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Application state</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Session state</span></span><span style="line-height: 19px; font-family: 宋体; ">也可以作为缓存使用）</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="3-4-nbsp-多线程"><a href="#3-4-nbsp-多线程" class="headerlink" title="3.4&nbsp;多线程"></a><a name="_Toc220297471" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.4&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">多线程</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">避免在请求处理过程中创建线程</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　在执行请求的过程中创建线程是一种代价较大的操作，会严重影响</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web Server</span></span><span style="line-height: 19px; font-family: 宋体; ">的性能。如果后续的操作必须用线程完成，建议通过</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">thread pool</span></span><span style="line-height: 19px; font-family: 宋体; ">来创建</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">/</span></span><span style="line-height: 19px; font-family: 宋体; ">管理线程。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">不要依赖线程数据槽或线程静态变量</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　由于执行请求的线程是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ASP.NET thread pool</span></span><span style="line-height: 19px; font-family: 宋体; ">中的工作线程，同一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Client</span></span><span style="line-height: 19px; font-family: 宋体; ">的两次请求不一定由相同的线程来处理。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">避免阻塞处理请求的线程</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　参考</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“</span></span><span style="line-height: 19px; font-family: 宋体; ">避免阻塞和长时间的作业</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“</span></span><span style="line-height: 19px; font-family: 宋体; ">小节。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">避免异步调用</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　这和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1</span></span><span style="line-height: 19px; font-family: 宋体; ">的情况类似。异步调用会导致创建新的线程，增加服务器的负担。所以，如果没有并发的作业要执行，就不要执行异步调用。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="3-5-nbsp-系统资源"><a href="#3-5-nbsp-系统资源" class="headerlink" title="3.5&nbsp;系统资源"></a><a name="_Toc220297472" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.5&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">系统资源</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">考虑实现资源池以提升性能</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">明确地调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Dispose</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Close</span></span><span style="line-height: 19px; font-family: 宋体; ">释放系统资源</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">不要缓存或长时间占用资源池中的资源</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽可能晚的申请，尽可能早的释放</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="3-6-nbsp-页面处理"><a href="#3-6-nbsp-页面处理" class="headerlink" title="3.6&nbsp;页面处理"></a><a name="_Toc220297473" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.6&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">页面处理</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量减小</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Page</span></span><span style="line-height: 19px; font-family: 宋体; ">的尺寸</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　包括缩短控件的名称、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">CSS</span></span><span style="line-height: 19px; font-family: 宋体; ">的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">class</span></span><span style="line-height: 19px; font-family: 宋体; ">的名称、去掉无谓空行和空格、禁用不需要的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ViewState</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">启用页面输出的缓冲区（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Buffer</span></span><span style="line-height: 19px; font-family: 宋体; ">）</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Buffer</span></span><span style="line-height: 19px; font-family: 宋体; ">的机制被关闭，可以用下面的方法打开。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　使用程序打开页面输出缓存：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Response.BufferOutput = true;</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">@Page</span></span><span style="line-height: 19px; font-family: 宋体; ">开关打开页面输出缓冲机制：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&lt;%@ Page Buffer = “true” %&gt;</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Web.config</span></span><span style="line-height: 19px; font-family: 宋体; ">或</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Machine.config</span></span><span style="line-height: 19px; font-family: 宋体; ">配置文件的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&lt;pages&gt;</span></span><span style="line-height: 19px; font-family: 宋体; ">节点：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&lt;pages buffer=”true”&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">&#8230;</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&gt;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">利用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Page.IsPostBack</span></span><span style="line-height: 19px; font-family: 宋体; ">优化页面输出</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">通过分离页面的不同的内容，来提高缓存效率和减少呈现的时间</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">5.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">优化复杂和代价较大的循环</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; "></span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">6.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">合理利用客户端的计算资源，将一些操作转移到客户端进行</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="3-7-ViewState"><a href="#3-7-ViewState" class="headerlink" title="3.7 ViewState"></a><a name="_Toc220297474" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">3.7 ViewState</span></span></a></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ViewState</span></span><span style="line-height: 19px; font-family: 宋体; ">是</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Asp.net</span></span><span style="line-height: 19px; font-family: 宋体; ">为服务端控件在页面回传之间跟踪状态信息而设计的一种机制。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">关闭</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ViewState</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果不需要跟踪页面状态，例如页面不会</span><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span><span style="line-height: 19px; font-family: 宋体; ">回传（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">PostBack</span></span><span style="line-height: 19px; font-family: 宋体; ">）、不需要处理服务端控件事件或者每次页面刷新时都会重新计算控件内容，那么就不需要用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ViewState</span></span><span style="line-height: 19px; font-family: 宋体; ">来记录页面状态了。可以对特定的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">WebControl</span></span><span style="line-height: 19px; font-family: 宋体; ">设置</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">EnableViewState</span></span><span style="line-height: 19px; font-family: 宋体; ">属性，也可以在页面一级设置：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&lt;%@ Page EnableViewState=”false” %&gt;</span></span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">在恰当的时间点初始化控件属性</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ASP.NET</span></span><span style="line-height: 19px; font-family: 宋体; ">的控件在执行构造函数、初始化的期间设置的属性不会被跟踪变化；而在初始化阶段之后对属性的修改都会被跟踪，并最终记录到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">IE</span></span><span style="line-height: 19px; font-family: 宋体; ">页面的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">__VIEWSTATE</span></span><span style="line-height: 19px; font-family: 宋体; ">之中。所以，选择合理的初始化控件属性的执行点，能有效的减小页面尺寸。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">谨慎选择放到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ViewState</span></span><span style="line-height: 19px; font-family: 宋体; ">中的内容</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　放到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ViewState</span></span><span style="line-height: 19px; font-family: 宋体; ">中的内容会被序列化</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">/</span></span><span style="line-height: 19px; font-family: 宋体; ">反序列化，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Asp.net</span></span><span style="line-height: 19px; font-family: 宋体; ">为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Integer</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Boolean</span></span><span style="line-height: 19px; font-family: 宋体; ">等基本类型的序列化做了优化，如果</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Array</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">ArrayList</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">HashTable</span></span><span style="line-height: 19px; font-family: 宋体; ">存储的是基本类型效率也较高，但其它类型则需要提供类型转换器（</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Type Converter</span></span><span style="line-height: 19px; font-family: 宋体; ">），否则将使用代价昂贵的二进制序列化程序。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h1 id="4-JScript"><a href="#4-JScript" class="headerlink" title="4.JScript"></a><a name="_Toc220297475" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: x-large; font-family: 'Times New Roman'; ">4.JScript</span></span></a><span lang="EN-US"><span style="font-size: x-large; font-family: 'Times New Roman'; "></span></span></h1><h2 id="4-1-JScript性能优化的基本原则"><a href="#4-1-JScript性能优化的基本原则" class="headerlink" title="4.1 JScript性能优化的基本原则"></a><a name="_Toc220297476" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">4.1 JScript</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">性能优化的基本原则</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽可能少地减少执行次数。毕竟对解释语言来说，每一个执行步骤，都需要和解释引擎做一次交互。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽可能使用语言内置的功能，比如串链接。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽可能使用系统提供的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">API</span></span><span style="line-height: 19px; font-family: 宋体; ">来进行优化。因为这些</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">API</span></span><span style="line-height: 19px; font-family: 宋体; ">是编译好的二进制代码，执行效率很高。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">书写最正确的代码。容错功能是要付出性能代价的。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="4-2-JScript语言本身的优化"><a href="#4-2-JScript语言本身的优化" class="headerlink" title="4.2 JScript语言本身的优化"></a><a name="_Toc220297477" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">4.2 JScript</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">语言本身的优化</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.2.1</span></span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">变量</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量使用局部变量。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　因为全局变量其实是全局对象的成员，而局部变量在栈上定义，优先查找，性能相对于全局变量要高。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量在一个语句中做定义变量和赋值。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">省略不必要的变量定义。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　如果变量的定义可以被一个常量替代，就直接使用常量。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Object</span></span><span style="line-height: 19px; font-family: 宋体; ">语法对对象赋值。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Object</span></span><span style="line-height: 19px; font-family: 宋体; ">的赋值语法在操作复杂对象时效率更高。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　例如，可以将下面的代码：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car = new Object();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car.make = “Honda”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car.model = “Civic”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car.transmission = “manual”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car.miles = 100000;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car.condition = “needs work”;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">替换成：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">car = {</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">make: “Honda”,</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">model: “Civic”,</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">transmission: “manual”,</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">miles: 100000,</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">condition: “needs work”</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.2.2</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">对象缓存</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">缓存对象查找的中间结果。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　因为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JavaScript</span></span><span style="line-height: 19px; font-family: 宋体; ">的解释性，所以</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">a.b.c.d.e</span></span><span style="line-height: 19px; font-family: 宋体; ">，需要进行至少</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4</span></span><span style="line-height: 19px; font-family: 宋体; ">次查询操作，先检查</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">a</span></span><span style="line-height: 19px; font-family: 宋体; ">再检查</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">a</span></span><span style="line-height: 19px; font-family: 宋体; ">中的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">b</span></span><span style="line-height: 19px; font-family: 宋体; ">，再检查</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">b</span></span><span style="line-height: 19px; font-family: 宋体; ">中的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">c</span></span><span style="line-height: 19px; font-family: 宋体; ">，如此往下。所以如果这样的表达式重复出现，只要可能，应该尽量少出现这样的表达式，可以利用局部变量，把它放入一个临时的地方进行查询。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">缓存创建时间较长的对象。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　自定义高级对象和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Date</span></span><span style="line-height: 19px; font-family: 宋体; ">、</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">RegExp</span></span><span style="line-height: 19px; font-family: 宋体; ">对象在构造时都会消耗大量时间。如果可以复用，应采用缓存的方式。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.2.3</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">字符串操作</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“+=”&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">追加字符串，使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“+”</span></span><span style="line-height: 19px; font-family: 宋体; ">来连接字符串。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果是追加字符串，最好使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">s+=anotherStr</span></span><span style="line-height: 19px; font-family: 宋体; ">操作，而不是要使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">s=s+anotherStr</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果要连接多个字符串，应该使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“+”</span></span><span style="line-height: 19px; font-family: 宋体; ">，如：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">s+=a;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">s+=b;</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">s+=c;</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　　应该写成</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">s+=a + b + c</span></span><span style="line-height: 19px; font-family: 宋体; ">；</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">连接大量的字符串，应使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Array</span></span><span style="line-height: 19px; font-family: 宋体; ">的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">join</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果是收集字符串，最好使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JavaScript</span></span><span style="line-height: 19px; font-family: 宋体; ">数组缓存，最后使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">join</span></span><span style="line-height: 19px; font-family: 宋体; ">方法连接起来，如下：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">var buf = new Array();</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">for (var i = 0; i &lt; 100; i++)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">buf.push(i.toString());</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">var all = buf.join(“”);</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.2.4</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">类型转换</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Math.floor()</span></span><span style="line-height: 19px; font-family: 宋体; ">或者</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Math.round()</span></span><span style="line-height: 19px; font-family: 宋体; ">将浮点数转换成整型。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　浮点数转换成整型，这个更容易出错，很多人喜欢使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">parseInt()</span></span><span style="line-height: 19px; font-family: 宋体; ">，其实</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">parseInt()</span></span><span style="line-height: 19px; font-family: 宋体; ">是用于将字符串转换成数字，而不是浮点数和整型之间的转换，我们应该使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Math.floor()</span></span><span style="line-height: 19px; font-family: 宋体; ">或者</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Math.round()</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　对象查找中的问题不一样，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Math</span></span><span style="line-height: 19px; font-family: 宋体; ">是内部对象，所以</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Math.floor()</span></span><span style="line-height: 19px; font-family: 宋体; ">其实并没有多少查询方法和调用的时间，速度是最快的。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">自定义的对象，推荐定义和使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">toString()</span></span><span style="line-height: 19px; font-family: 宋体; ">方法来进行类型转换。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　对于自定义的对象，如果定义了</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">toString()</span></span><span style="line-height: 19px; font-family: 宋体; ">方法来进行类型转换的话，推荐显式调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">toString()</span></span><span style="line-height: 19px; font-family: 宋体; ">。因为内部的操作在尝试所有可能性之后，会尝试对象的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">toString()</span></span><span style="line-height: 19px; font-family: 宋体; ">方法尝试能否转化为</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">String</span></span><span style="line-height: 19px; font-family: 宋体; ">，所以直接调用这个方法效率会更高。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.2.5</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">循环的优化</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽可能少使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for(in)</span></span><span style="line-height: 19px; font-family: 宋体; ">循环。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JavaScript</span></span><span style="line-height: 19px; font-family: 宋体; ">中，我们可以使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for(;;),while(),for(in)</span></span><span style="line-height: 19px; font-family: 宋体; ">三种循环，事实上，这三种循环中</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for(in)</span></span><span style="line-height: 19px; font-family: 宋体; ">的效率极差，因为他需要查询散列键，只要可以就应该尽量少用。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">预先计算</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">collection</span></span><span style="line-height: 19px; font-family: 宋体; ">的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">length</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如：将</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for (var i = 0; i &lt; collection.length; i++)</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　替换成：</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">for (var i = 0, len = collection.length; i &lt; len; i++)</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　效果会更好，尤其是在大循环中。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量减少循环内的操作。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　循环内的每个操作，都会被放大为循环次数的倍数。所以，大循环内微小的改进，在性能的整体提升上都是可观的。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用循环替代递归。</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　相比循环，递归的效率更差一些。递归的优点是在形式上更自然一些。所以，在不影响代码的维护性的前提下，用循环替代递归。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.2.6</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">其它方面</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量使用语言内置的语法。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“var arr = [</span></span><span style="line-height: 19px; font-family: 宋体; ">&#8230;</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">];”</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“var arr = new Array(</span></span><span style="line-height: 19px; font-family: 宋体; ">&#8230;</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">);”</span></span><span style="line-height: 19px; font-family: 宋体; ">是等效的，但是前者的效能优于后者。同样，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“var foo = {};”</span></span><span style="line-height: 19px; font-family: 宋体; ">的方式也比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“var foo = new Object();”</span></span><span style="line-height: 19px; font-family: 宋体; ">快；</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“var reg = /../;”</span></span><span style="line-height: 19px; font-family: 宋体; ">要比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">“var reg=new RegExp()”</span></span><span style="line-height: 19px; font-family: 宋体; ">快。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量不要使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">eval</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">eval</span></span><span style="line-height: 19px; font-family: 宋体; ">，相当于在运行时再次调用解释引擎，对传入的内容解释运行，需要消耗大量时间。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">prototype</span></span><span style="line-height: 19px; font-family: 宋体; ">代替</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">closure</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">closure</span></span><span style="line-height: 19px; font-family: 宋体; ">在性能和内存消耗上都是不利的。如果</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">closure</span></span><span style="line-height: 19px; font-family: 宋体; ">使用量过大，这就会成为一个问题。所以，尽量将：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">this.methodFoo = function()</span></span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　替换成：</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">MyClass.protoype.methodFoo = function()</span></span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">closure</span></span><span style="line-height: 19px; font-family: 宋体; ">存在于对象实例之中不同，</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">prototype</span></span><span style="line-height: 19px; font-family: 宋体; ">存在于类中，被该类的所有的对象实例共享。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">避免使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">with</span></span><span style="line-height: 19px; font-family: 宋体; ">语句。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">With</span></span><span style="line-height: 19px; font-family: 宋体; ">语句临时扩展对象查找的范围，节省了文字的录入时间，但付出了更多的执行时间。因为每个给出的名称都要在全局范围查找。所以，可以将下面的代码：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">with (document.formname)</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">{</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">field1.value = “one”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">field2.value = “two”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">}</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">变更为：</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">var form = document.formname;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">form.field1.value = “one”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">form.field2.value = “two”;</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="4-3-DOM相关"><a href="#4-3-DOM相关" class="headerlink" title="4.3 DOM相关"></a><a name="_Toc220297478" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">4.3 DOM</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">相关</span></span></span></h2><p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">4.3.1</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">创建</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">DOM</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">节点</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　相比较通过</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">document.write</span></span><span style="line-height: 19px; font-family: 宋体; ">来给页面生成内容，找一个容器元素（比如指定一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">div</span></span><span style="line-height: 19px; font-family: 宋体; ">或者</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">span</span></span><span style="line-height: 19px; font-family: 宋体; ">）并设置他们的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">innerHTML</span></span><span style="line-height: 19px; font-family: 宋体; ">效率更高。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　而设置</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">innerHTML</span></span><span style="line-height: 19px; font-family: 宋体; ">的方式比通过</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">createElement</span></span><span style="line-height: 19px; font-family: 宋体; ">方法创建节点的效率更高。事实上，设置元素的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">innerHTML</span></span><span style="line-height: 19px; font-family: 宋体; ">是创建节点效率最高的一种方式。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果必须使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">createElement</span></span><span style="line-height: 19px; font-family: 宋体; ">方法，而如果文档中存在现成的样板节点，应该是用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">cloneNode()</span></span><span style="line-height: 19px; font-family: 宋体; ">方法。因为使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">createElement()</span></span><span style="line-height: 19px; font-family: 宋体; ">方法之后，你需要设置多次元素的属性，使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">cloneNode()</span></span><span style="line-height: 19px; font-family: 宋体; ">则可以减少属性的设置次数。同样，如果需要创建很多元素，应该先准备一个样板节点。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.3.2</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">离线操作大型的</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">DOM</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">树</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　在添加一个复杂的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DOM</span></span><span style="line-height: 19px; font-family: 宋体; ">树时，可以先构造，构造结束后再将其添加到</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DOM</span></span><span style="line-height: 19px; font-family: 宋体; ">数的适当节点。这能够节省界面刷新的时间。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">同样，在准备编辑一个复杂的树时，可以先将树从</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">DOM</span></span><span style="line-height: 19px; font-family: 宋体; ">树上删除，等编辑结束后再添加回来。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 宋体; "><span style="line-height: 19px; font-size: small; ">　</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">4.3.3</span></span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "><span style="line-height: 31px; font-family: 'Times New Roman'; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">对象查询</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">[“”]</span></span><span style="line-height: 19px; font-family: 宋体; ">查询要比</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.item()</span></span><span style="line-height: 19px; font-family: 宋体; ">更快。调用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">.item()</span></span><span style="line-height: 19px; font-family: 宋体; ">增加了一次查询和函数的调用。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<p><span style="line-height: 21px; font-family: 'Times New Roman'; "><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">4.3.4</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; ">&nbsp;</span></span><span style="line-height: 31px; font-size: 16pt; font-family: 宋体; ">定时器</span><span lang="EN-US" style="line-height: 31px; font-size: 16pt; "></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　如果针对的是不断运行的代码，不应该使用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">setTimeout</span></span><span style="line-height: 19px; font-family: 宋体; ">，而应该用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">setInterval</span></span><span style="line-height: 19px; font-family: 宋体; ">。</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">setTimeout</span></span><span style="line-height: 19px; font-family: 宋体; ">每次要重新设置一个定时器。</span></span></p>
<p><span lang="EN-US" style="line-height: 21px; "><span style="line-height: 19px; font-size: small; font-family: 'Times New Roman'; ">&nbsp;</span></span></p>
<h2 id="4-4-nbsp-其他"><a href="#4-4-nbsp-其他" class="headerlink" title="4.4&nbsp;其他"></a><a name="_Toc220297479" style="text-decoration: none; color: #336699; "><span lang="EN-US"><span style="font-size: large; font-family: Arial; ">4.4&nbsp;</span></span></a><span><span style="font-family: 黑体; "><span style="font-size: large; ">其他</span></span></span></h2><p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">1.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量减小文件尺寸。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　将</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JScript</span></span><span style="line-height: 19px; font-family: 宋体; ">文件中无关的空行、空格、注释去掉，有助于减小</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JS</span></span><span style="line-height: 19px; font-family: 宋体; ">文件的尺寸，提高下载的时间。（可以通过工具来支持代码发布）</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">2.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">尽量不要在同一个</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Page</span></span><span style="line-height: 19px; font-family: 宋体; ">内同时引用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JScript</span></span><span style="line-height: 19px; font-family: 宋体; ">和</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">VBScript</span></span><span style="line-height: 19px; font-family: 宋体; ">引擎</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">3.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">将</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Page</span></span><span style="line-height: 19px; font-family: 宋体; ">内的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JScript</span></span><span style="line-height: 19px; font-family: 宋体; ">移入到单独的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JS</span></span><span style="line-height: 19px; font-family: 宋体; ">文件中。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">4.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">将</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Page</span></span><span style="line-height: 19px; font-family: 宋体; ">内的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JScript</span></span><span style="line-height: 19px; font-family: 宋体; ">放置在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">Page</span></span><span style="line-height: 19px; font-family: 宋体; ">的最下面，有助于提高页面的响应速度。</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">5.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">利用</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">cache</span></span><span style="line-height: 19px; font-family: 宋体; ">，减少</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JScript</span></span><span style="line-height: 19px; font-family: 宋体; ">文件的下载次数</span></span></p>
<p><span style="line-height: 19px; font-size: small; "><span style="line-height: 19px; font-family: 宋体; ">　</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">6.&nbsp;</span></span><span style="line-height: 19px; font-family: 宋体; ">在</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">HTML</span></span><span style="line-height: 19px; font-family: 宋体; ">内书写</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">JScript</span></span><span style="line-height: 19px; font-family: 宋体; ">文件的</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">URL</span></span><span style="line-height: 19px; font-family: 宋体; ">时，注意统一大小写。这样可以利用前面</span><span lang="EN-US" style="line-height: 19px; "><span style="line-height: 19px; font-family: 'Times New Roman'; ">URL</span></span><span style="line-height: 19px; font-family: 宋体; ">缓存的文件。</span></span></p>
<p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2009/10/27/NET-性能优化方法总结-转/" data-id="cjs7p2wwr000rng5m1yyapl8i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">八月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">七月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">一月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">十二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">十月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">八月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">五月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">四月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">一月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">十月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">八月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">四月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">三月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">二月 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/04/">四月 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">一月 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/15/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/02/15/tutoial-of-hexo/">利用Hexo+Github搭建个人免费博客</a>
          </li>
        
          <li>
            <a href="/2016/05/30/QT项目性能调优小记/">QT项目性能调优小记</a>
          </li>
        
          <li>
            <a href="/2015/08/28/Windows下HG服务器的搭建/">Windows下HG服务器的搭建</a>
          </li>
        
          <li>
            <a href="/2011/08/10/svn-tp-link-花生壳搭建外网服务器/">svn+tp-link+花生壳搭建外网服务器</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 三闻鱼<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>